function collect_form(a){for(var b=$(a),c=b.serializeArray(),d={},e=0;e<c.length;e++)d[c[e].name]=c[e].value;return c=JSON.stringify(d)}function getFormData(a){var b=a.serializeArray(),c={};return _.map(b,function(a){c[a.name]=a.value}),c}function CreateLightBox(a,b){$("body").css("overflow-y","hidden"),$('<div id="overlay"></div>').css("opacity","0.1").animate({opacity:"0.9"},"slow").appendTo("body"),$('<div id="lightbox">'+a+"</div>").appendTo("body"),$(b).click(removeLightbox);var c=($(window).height()-$("#lightbox").height())/2,d=($(window).width()-$("#lightbox").width())/2;return $("#lightbox").css({top:c+$(document).scrollTop(),left:d}).fadeIn(),!1}function RemoveLightBox(){$("#overlay, #lightbox").fadeOut("slow",function(){$(this).remove(),$("body").css("overflow-y","auto")})}function getCookie(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function plural(a,b){var c=b.split(",");return a%100>=11&&a%100<=14?c[2]:a%10==1?c[0]:a%10>=2&&a%10<=5?c[1]:c[2]}function cartesianProductOf(){return _.reduce(arguments,function(a,b){return _.flatten(_.map(a,function(a){return _.map(b,function(b){return a.concat([b])})}))},[[]])}var AjaxRequestSender=function(a,b){var c="undefined";if(typeof a.url==c)throw new Error("url is not defined");typeof a.dataType==c&&(a.dataType="json"),typeof a.data==c&&(a.data={}),typeof b!=c&&""!=b&&null!=b&&(a.data.csrfmiddlewaretoken=b),this.options=a};AjaxRequestSender.prototype.Send=function(){return $.ajax(this.options)},String.prototype.format=function(a){var b=this;return b.replace(String.prototype.format.regex,function(b){var c=b.substring(1,b.length-1),d=a[c];return d})},String.prototype.format.regex=new RegExp("{\\w+}","g"),_.mixin({hasEqual:function(a,b){for(var c in a)if(_.isEqual(a[c],b))return!0;return!1},getDot:function(a,b){var c=b.indexOf(".");if(c==-1)return a[b];var d=b.substr(0,c),e=b.substr(c);return a[d]?a[d].get(e):void 0},pass:function(a,b){return b(a)},sum:_.partial(_.reduce,_,function(a,b){return a+b},0),negate:function(a){return function(){return!a.apply(this,arguments)}},get:function(a,b,c){try{return a[b]}catch(a){return c||null}},set:function(a,b,c){try{return a[b]=c}catch(a){return}},resize:function(a,b,c){if(b<a.length)return _.take(a,b);if(b>a.length){var d;return _.isFunction(c)?d=c:(_.isUndefined(c)&&(c=null),d=_.constant(c)),a.concat(_.times(b-a.length,d))}return a}}),Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}}),angular.module("Printler",["ui.bootstrap","ui.router","angular-lodash","ngSanitize","PrintlerUtils","PrintlerFilters","PrintlerNotifications","PrintlerDependencies","PrintlerCalculator","Clients","HttpAsyncQueue","PostMessageReceiver","blueimp.fileupload","ngCookies","ngAnimate","toastr","frapontillo.bootstrap-switch","angularModalService"]),angular.module("Widget2",["ui.bootstrap","ui.router","PrintlerUtils","PostMessageReceiver","PrintlerDependencies"]),angular.module("Widget2Maquettes",["Widget2","ui.sortable","restangular","PrintlerUtils","PrintlerFilters","blueimp.fileupload","toastr"]),angular.module("Widget2Login",["Widget2","PrintlerDependencies","Clients","CalculatorOrders"]),angular.module("Widget2Orders",["Widget2","Widget2Login","PrintlerCalculator","CalculatorOrders","angular-lodash","ngSanitize","PrintlerUtils","PrintlerFilters","PrintlerDependencies","duScroll","toastr","angularModalService","blueimp.fileupload","ngAnimate"]),angular.module("PrintlerUtils",["ui.bootstrap","ui.select2","GoogleGeoLocation","restangular"]),angular.module("PrintlerFilters",[]),angular.module("CalculatorOrders",["restangular","Clients","PrintlerDependencies"]),angular.module("PrintlerCalculator",["GoogleGeoLocation","PrintlerDependencies","toastr","angularModalService","CalculatorOrders"]),angular.module("PrintlerDependencies",["ngCookies","HttpAsyncQueue","restangular"]),angular.module("Clients",["restangular","xeditable"]),angular.module("PrintlerNotifications",["ngCookies"]),angular.module("GoogleGeoLocation",[]),angular.module("PostMessageReceiver",[]),angular.module("HttpAsyncQueue",[]),angular.module("Widget2").config(["$interpolateProvider","$httpProvider","$stateProvider","$urlRouterProvider",function(a,b,c,d){a.startSymbol("{["),a.endSymbol("]}"),b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",b.defaults.xsrfCookieName="csrftoken",b.defaults.xsrfHeaderName="X-CSRFToken",c.state("closed",{url:"/close"}).state("loaded",{url:"/loaded",onEnter:["$configuration",function(a){a.loaded()}]}),d.otherwise("/")}]),angular.module("Widget2").run(["$rootScope","$state","$stateParams","$configuration","$http",function(a,b,c,d,e){a.config=d,d.$state=b,d.$params=c,e.get("/widget/settings/?api_key="+API_KEY).then(function(b){d.widget2.apiSettings=b.data,a.$broadcast("apiSettingsLoaded",b.data)}),a.$on("$stateChangeStart",function(a,b,c,e,f){d.runCallbacks(b.name,e.name)}),a.$on("$stateChangeSuccess",function(a,b,c,e,f){d.stateChanged(b.name,"success")}),a.$on("$stateChangeError",function(a,b,c,e,f){d.stateChanged(b.name,"some_errors")}),a.$on("$stateNotFound",function(a,b,c,e,f){d.stateChanged(b.name,"api_not_found")}),d.registerModule("closed")}]),angular.module("Widget2").controller("Widget2WindowsController",["$scope","$configuration",function(a,b){a.closeOnOutClick=function(b){b.target==b.currentTarget&&a.config.close()},a.closeIframe=function(){a.config.close()},$(window).keydown(function(c){if(27===c.keyCode&&!b.widget2.modal)return a.config.close(),!1})}]),angular.module("Widget2").directive("frame",["$compile","$configuration","$timeout",function(a,b,c){return{restrict:"C",link:function(a,d,e){a.config=a.config&&b;var f=function(){b.widget2.fullscreen?(d.css("height",""),d.height(Math.max($(window).height(),d.height())),b.addFrameClass("fullscreen")):b.removeFrameClass("fullscreen")};$(window).on("resize",f),d.on("resize",f),$(window).on("scroll",f),a.$watch("config.widget2.fullscreen",f),a.$watch("config.widget2.fullheight",f),a.$watch("config.widget2.isOpen",function(a){a&&c(f,1e3)}),a.$root.$on("$stateChangeSuccess",function(a,b,d,e,g){c(f)}),f()}}}]),angular.module("Widget2").directive("widgetFooter",["$configuration","$timeout",function(a,b){return{restrict:"C",link:function(c,d,e){c.config=c.config&&a;var f=function(){if(a.widget2.fullheight){var b=$(".frame-content"),c=$(".widget-footer");b.offset().top+b.height()-$(window).scrollTop()<$(window).height()-("relative"==c.css("position")?0:60)?c.css("position","relative"):c.css("position","fixed")}};$(window).on("resize",f),d.find(".widget-footer-content").on("resize",f),$(window).on("scroll",f),c.$watch("config.widget2.fullheight",f),b(f,2e3)}}}]),angular.module("Widget2").factory("$postMessage",["$rootScope","$q",function(a,b){function c(b){if(!(_.isString(b.data)&&b.data.indexOf("iFrameSizer")>-1)){var c=b.data;if(_.isString(c)&&(c=JSON.parse(c)),c){var d=c.name,e=c.data;void 0!==f[d]&&_.each(f[d],function(a){a.notify(e)}),a.$apply()}}}function d(a){if(void 0!==a){void 0===f[a]&&(f[a]=[]);var c=b.defer();return f[a].push(c),c.promise.do=function(a){return c.promise.then(null,null,a)},c.promise}throw new Error("Trying to listen postMessage with undefined name")}function e(a,b,c){window.parent.postMessage(JSON.stringify({name:a,data:b}),c||"*")}var f={};return window.addEventListener?addEventListener("message",c,!1):attachEvent("onmessage",c),{on:d,send:e}}]),angular.module("Widget2").service("$configuration",["$postMessage","$state","$timeout","yesno",function(a,b,c,d){var e=this,f=[],g={};e.widget2={isOpen:!1,isFull:!1,frameClasses:"",fullscreen:!1,fullheight:!1,needConfirm:!1,modal:!1},e.registerModule=function(c,d,f){c=_.isArray(c)?c:[c],_.each(_.toArray(c),function(c){a.on(c).do(function(a){g={id:a.id,state:c},b.go(c,a.call)})}),d&&f&&e.moduleCallbacks(c,d,f)},e.stateChanged=function(b,c){g.state==b&&(a.send("callAPIfunc",{id:g.id,data:c}),g.state=void 0)},e.moduleCallbacks=function(a,b,c){f.push({states:a,inCallback:b,outCallback:c})},e.runCallbacks=function(a,b){_.each(f,function(d){_.contains(d.states,a)&&d.inCallback?c(function(){d.inCallback(a,b)}):_.contains(d.states,b)&&d.outCallback&&c(function(){d.outCallback(a,b)})})},e.close=function(){if(e.widget2.needConfirm){var a=e.widget2.customConfirm||d.confirmation;a({text:"Уверены, что хотите выйти?"}).then(function(){h()})}else h()},e.open=function(){a.send("iframeFull"),e.widget2.isOpen=!0,e.callEvent("open"),$(window).focus()},e.loaded=function(){a.send("loaded")},e.callEvent=function(b,c){a.send("event",{eventName:b,data:c})},e.addFrameClass=function(a){e.widget2.frameClasses.indexOf(a)>=0||(e.widget2.frameClasses+=" "+a)},e.removeFrameClass=function(a){e.widget2.frameClasses=e.widget2.frameClasses.replace(new RegExp(a,"g"),"")},e.get=function(a){for(var b=a.split("."),c=e,d=0;d<b.length;d++){if(!c[b[d]])return;c=c[b[d]]}return c},e.set=function(a,b,c){if("string"==typeof b&&(b=b.split(".")),b.length>1){var d=b.shift();e.set(a[d]="[object Object]"===Object.prototype.toString.call(a[d])?a[d]:{},b,c)}else a[b[0]]=c},a.on("configuration").do(function(b){var c=b.id,d=b.call;_.each(d,function(a,b){e.set(e,b,a)}),a.send("callAPIfunc",{id:c,data:"success"})});var h=function(){e.widget2.needConfirm=!1,e.widget2.isFull?a.send("headerOnly"):a.send("iframeClose"),e.widget2.isOpen&&e.callEvent("close"),e.widget2.isOpen=!1,b.go("closed")}}]),angular.module("Widget2Login").config(["$stateProvider",function(a){a.state("login",{url:"/login?previous&next",templateUrl:"views/widget2/login/new.html",controller:"WidgetLoginFormController"}).state("profile",{url:"/profile",templateUrl:"views/widget2/login/profile.html",controller:"ProfileController"}).state("profileMenu",{url:"/profile/menu",views:{login:{templateUrl:"views/widget2/login/menu.html",controller:["$configuration",function(a){a.open()}]}}}).state("profileOrders",{url:"/profile/orders",templateUrl:"views/widget2/login/orders.html",controller:"ProfileOrdersController"}).state("profileOrder",{url:"/profile/order/:id",templateUrl:"views/widget2/login/order.html",controller:"ProfileOrderController"}).state("loginCreate",{url:"/login/create?email,password",onEnter:["WidgetUserRestangular","$stateParams",function(a,b){a.login(b.email,b.password)}]}).state("loginDestroy",{url:"/login/destroy",onEnter:["WidgetUserRestangular","$configuration","$state",function(a,b,c){a.logout(),b.close()}]})}]),angular.module("Widget2").run(["$rootScope","$state","$stateParams","$configuration","WidgetUserRestangular",function(a,b,c,d,e){e.init(),a.session=e,d.$session=e,d.login={show:!1},d.moduleCallbacks(["profileMenu"],function(){d.login.show=!0},function(){d.login.show=!1}),d.registerModule(["login","profile","profileMenu","profileOrders","profileOrder","loginCreate","loginDestroy"])}]),angular.module("Widget2Login").controller("ProfileController",["$scope","WidgetUserRestangular","$state","$configuration","toastr",function(a,b,c,d,e){d.open(),a.date=new Date(1984,4,15),a.client=b.user,a.has_errors=function(a){return _.has(a,"errors")&&_.keys(a.errors).length>0},a.any_error=function(b){return _.some(b,function(b){return a.has_errors(b)})},a.password="",a.save=function(){return b.changeParams(_.pick(a.client,"email","name")).then(function(){e.success("Настройки клиента были сохранены.")})},a.toggleIsActive=function(){return a.client.is_active?a.client.post("enable"):a.client.post("disable")},a.session_set_password=function(a,c){return b.changePassword(a,c).then(function(){e.success("Пароль был изменён")})}}]),angular.module("Widget2Login").controller("ProfileOrderController",["$scope","$stateParams","WidgetUserRestangular","$configuration","delivery",function(a,b,c,d,e){a.order=_.find(c.user.multi_orders,function(a){return a.id==b.id}),a.apiSettings=d.widget2.apiSettings,a.delivery=_.findWhere(e.data,{id:a.order.delivery_option}),a.productPagesSum=function(a){return _.reduce(a.addition_detalization,function(a,b,c){return a+(b.pages||0)},0)}}]),angular.module("Widget2Login").controller("ProfileOrdersController",["$scope","WidgetUserRestangular","$configuration","$state","$timeout","$calculatorState",function(a,b,c,d,e,f){c.open(),a.client=b.user;var g=function(a){return _.reduce(a.orders,function(a,b){return a&&("READY"==b.status||"SHIPPING"==b.status)},!0)};a.filterReady=_.partialRight(_.filter,g),a.filterNotReady=_.partialRight(_.filter,_.negate(g)),a.stripId=function(a){return 0==a.indexOf("ID-")?a.substr(3):a},a.goToOrder=function(b){a.$root;d.go("orders.new"),f.go("summary.cart")}}]),angular.module("Widget2Login").controller("WidgetLoginFormController",["$scope","WidgetUserRestangular","$state","$configuration","inputmask","$q","toastr","$stateParams",function(a,b,c,d,e,f,g,h){a.inputmask=e,a.client=b,a.clientInfo={is_new_user:!1,general:{}},a.login=function(){return b.isLoggingIn?j():void i().then(j).catch(function(){g.error("Неверные данные")})};var i=function(){return a.clientInfo.is_new_user?b.register(a.clientInfo.general).then(function(){return b.login(a.clientInfo.general.email,a.clientInfo.general.password)}).catch(function(a){return a.non_field_errors&&g.error(a.non_field_errors.join(". ")),f.reject(a)}):b.login(a.clientInfo.general.email,a.clientInfo.general.password)},j=function(){h.next||h.previous?c.go(h.next||h.previous):d.close()};d.open()}]),angular.module("Widget2Login").directive("sameAs",function(){return{require:"ngModel",scope:{sameAs:"="},link:function(a,b,c,d){d.$parsers.push(function(b){return b===a.sameAs?(d.$setValidity("sameAs",!0),b):void d.$setValidity("sameAs",!1)})}}}),angular.module("Widget2Orders").config(["$stateProvider","toastrConfig",function(a,b){a.state("orders",{url:"/orders",template:"<div ui-view></div>",controller:"OrdersController"}).state("orders.product",{url:"/orders/product",templateUrl:"views/widget2/orders/product.html",controller:"ProductDescController"}).state("orders.new",{url:"/orders/new/:slug",templateUrl:"views/widget2/orders/cart.html"}).state("orders.wideprint",{url:"/orders/wideprint/:id",templateUrl:"views/widget2/orders/wideprint.html"}).state("orders.edit",{url:"/orders/edit/:id",templateUrl:"views/widget2/orders/cart.html"}).state("orders.summary",{url:"/orders/summary",templateUrl:"views/widget2/orders/summary.html",controller:"ShoppingCartController"}).state("orders.delivery",{url:"/orders/delivery",templateUrl:"views/widget2/orders/delivery.html",controller:"DeliveryController"}).state("orders.feedback",{url:"/orders/feedback",templateUrl:"views/widget2/orders/feedback.html",controller:"OrderFeedbackController"}),angular.extend(b,{positionClass:"toast-bottom-right"})}]),angular.module("Widget2Orders").run(["$configuration","$postMessage","$rootScope","$timeout","$shoppingCart","$calculators","Calculator",function(a,b,c,d,e,f,g){a.orders={},a.orders.isNowCreate=!1,a.orders.lastState=void 0,a.orders.cart=e,c.$on("apiSettingsLoaded",function(b,c){a.widget2.isFull=c.panel_visible,e.onlineOptions=c,a.close()}),b.on("order_choose_product").do(function(b){a.$state.go("orders.new",{slug:b.product})}),f.managerCalc=new g,f.managerCalc.getAll(),a.registerModule(["orders","orders.product","orders.new","orders.edit","orders.wideprint","orders.summary","orders.delivery","orders.feedback"],function(b,c){_.contains(["orders.product","orders.new","orders.edit","orders.summary","orders.delivery"],b)&&(a.widget2.fullheight=!0)},function(){a.widget2.fullheight=!1})}]),angular.module("Widget2Orders").controller("DeliveryController",["$scope","$configuration","$shoppingCart","terms","delivery","$q","SummaryTerms",function(a,b,c,d,e,f,g){a.deliveries=e.data,a.clientInfo={detail:{},general:{},address:""},a.cart=c,a.cart.contact=a.session.user.contacts.getDefault(),a.cart.contact=a.cart.contact?a.cart.contact.id:void 0,a.cart.detail=a.session.user.details.getDefault(),a.cart.detail=a.cart.detail?a.cart.detail.id:void 0,a.delivery=a.cart.initDelivery(),a.$watch("cart.delivery_option",function(b){a.delivery=_.find(a.deliveries,function(a){return a.id==b})}),a.$watch("cart.day",function(b){c.terms.setMargins(b),_.each(a.cart.products,function(a,b){a.Update("term_option",a.term_option)})}),a.deliveryCost=function(c){var d=c.cost;return"delivery"==c.delivery_type&&a.cart.totalWeight()>b.widget2.apiSettings.on_weight&&(d+=b.widget2.apiSettings.on_weight_increase_margin_to),d>0?"+ "+Math.round(d)+" р.":"Бесплатно"},a.create=function(){i().then(function(){return h()})};var h=function(){return a.cart.Create().then(function(){return a.cart.Clear(),b.orders.isNowCreate=!0,b.$state.go("orders.feedback"),f.all(a.session.user.load_details(),a.session.user.load_delivery_addresses(),a.session.user.load_multi_orders())})},i=function(){return"delivery"==a.delivery.delivery_type&&null==a.cart.delivery_address?a.session.user.delivery_addresses.post({address:a.clientInfo.address,client:a.session.user.id}).catch(function(a){toastr.error(a.data)}).then(function(b){return a.cart.delivery_address=b.id,a.session.user.delivery_addresses.push(b),b}):f.when(!0)}}]),angular.module("Widget2Orders").controller("OrderFeedbackController",["$scope","$http","$configuration","httpOptions",function(a,b,c,d){a.term=0,a.fb={feedbackMsg:"Комментарий к оценке поможет нам улучшить систему",feedbackRating:0},a.pristine=!0,a.clearDefaultMsg=function(){a.pristine&&(a.fb.feedbackMsg="",a.pristine=!1)},a.feedbackState="taking",a.sendFeedback=function(){a.feedbackState="sending",b.post("/widget/feedbacks/",{rating:a.fb.feedbackRating,feedback:a.fb.feedbackMsg},d).success(function(){a.feedbackState="finished"})}}]),angular.module("Widget2Orders").controller("OrdersController",["$scope","$configuration","$shoppingCart",function(a,b,c){b.open(),a.orders=c.products,a.$watch("orders",function(){b.orders.totalCost=_.reduce(a.orders,function(a,b){return a+(b.primary_cost||0)},0)},!0)}]),angular.module("Widget2Orders").controller("ProductDescController",["$scope","$calculators","$configuration",function(a,b,c){a.hoveredProduct=void 0,a.selectProduct=void 0,a.$products=[],c.orders.isNowCreate=!1,a.isLoad=!1,a.isError=!1,b.managerCalc.promise.then(function(){a.isLoad=!0,a.$products=b.managerCalc.$products}).catch(function(){a.isError=!0}),a.by=function(b,c){return _.filter(a.$products,function(a){return _.contains(c,a[b])})},a.setHoveredProduct=function(b){a.hoveredProduct=b||void 0},a.productIsHovered=function(){return!!a.hoveredProduct},a.productPossible=function(a){return a.possible},a.setProduct=function(b){a.selectProduct=b},a.complete=function(){a.isLoad=!1,c.$state.go("orders.new",{slug:a.selectProduct.slug})}}]),angular.module("Widget2Orders").controller("ShoppingCartController",["$scope","toastr","$shoppingCart","$configuration","$q","token","API_KEY",function(a,b,c,d,e,f,g){a.products=c.products,a.cart=c,a.delivery=a.cart.initDelivery(),a.uploadHeaders={"X-CSRFToken":f,"X-Api-Key":g,Authorization:"Token "+f},a.remove=function(d){a.products[d].watcher&&a.products[d].watcher(),c.Remove(a.products[d]).catch(function(){b.error("Не удалось удалить продукт")})},a.copy=function(a){var d=_.clone(a);c.Add(d).catch(function(a){var c="";_.each(a.data,function(a,b){c+=" "+b+"("+a.join(", ")+")."}),b.error(c)})},a.edit=function(a){d.$state.go("orders.edit",{id:a.id})},a.productPagesSum=function(a){return _.reduce(a.addition_detalization,function(a,b,c){return a+(b.pages||0)},0)},a.complete=function(){a.session.loggedIn?d.$state.go("orders.delivery"):d.$state.go("login",{previous:"orders.cart",next:"orders.delivery"})}}]),angular.module("Widget2Orders").controller("WidgetCalcController",["$scope","$rootScope","$http","$visualization","$timeout","$calculatorState","$configuration","toastr","$shoppingCart","$stateParams","$calculators","$q",function(a,b,c,d,e,f,g,h,i,j,k,l){a.$state=f,a.order={},b.activeIframeTab="",a.becameActive=function(a){b.activeIframeTab=(a||"general")+"OptionsContent"},a.$on("apiSettingsFetched",function(b,c){a.apiSettings=c}),b.iframeCorners={1:!1,2:!1,3:!1,4:!1},a.apiSettings={},a.iframeTabList=[{name:"changeProductContent",isActive:function(){return!0},isVisited:!1},{name:"generalOptionsContent",isActive:function(){return f.includes("working")},isVisited:!1},{name:"blockOptionsContent",isActive:function(){return f.includes("working")},isVisited:!1},{name:"coverOptionsContent",isActive:function(){return f.includes("working")&&a.currentProduct().is_cover&&a.secTabs.cover.enabled},isVisited:!1},{name:"padOptionsContent",isActive:function(){return f.includes("working")&&a.currentProduct().is_back_cover&&a.secTabs.pad.enabled},isVisited:!1}],b.iframeCalcOrders=[],b.ordersToAjax=[],b.totalPrice=0,b.orderStatus="",b.registerOrderAllowed=!0,b.flushCalculatorState=function(){b.activeIframeTab="changeProductContent",b.iframeCorners={1:!1,2:!1,3:!1,4:!1},a.$parent.currentProductId=null,f.go("reset")},f.on(function(c){if("init.ready"==c){if(b.flushCalculatorState(),"orders.edit"==g.$state.$current.name){var d=i.FindBy(j.id);a.setProductBySlug(d.slug)}else a.setProductBySlug(j.slug);e(p)}});var m=function(){var c=_.reduce(b.iframeCorners,function(a,b){return a+b},0);a.$parent.params.roundingCorners=0==c?"no":c,d.applyProductChanges()},n=function(){b.currentSide="front"},o=function(){b.currentSide="back"},p=function(){d.setScope(a),d.setRootScope(b),d.setCanvas("helpCanvas"),d.init(),a.$watch("activeIframeTab",function(a){b.currentSide="front",d.applyProductChanges()}),a.$watch("params.formatWidth",d.applyProductChanges),a.$watch("params.formatHeight",d.applyProductChanges),a.$watch("params['block'].print",d.applyProductChanges),a.$watch("params['cover'].print",d.applyProductChanges),a.$watch("params['pad'].print",d.applyProductChanges),a.$watchCollection("params['block']['back']",o),a.$watchCollection("params['block']['front']",n),a.$watchCollection("params['cover']['back']",o),a.$watchCollection("params['cover']['front']",n),a.$watchCollection("params['pad']['back']",o),a.$watchCollection("params['pad']['front']",n),a.$watchCollection("params['block']['back']['chromaticity']",d.applyProductChanges),a.$watchCollection("params['block']['front']['chromaticity']",d.applyProductChanges),a.$watchCollection("params['cover']['back']['chromaticity']",d.applyProductChanges),a.$watchCollection("params['cover']['front']['chromaticity']",d.applyProductChanges),a.$watchCollection("params['pad']['back']['chromaticity']",d.applyProductChanges),a.$watchCollection("params['pad']['front']['chromaticity']",d.applyProductChanges),a.$watchCollection("params['block']['back']['screenColors']",d.applyProductChanges),a.$watchCollection("params['block']['front']['screenColors']",d.applyProductChanges),a.$watchCollection("params['cover']['back']['screenColors']",d.applyProductChanges),a.$watchCollection("params['cover']['front']['screenColors']",d.applyProductChanges),a.$watchCollection("params['pad']['back']['screenColors']",d.applyProductChanges),a.$watchCollection("params['pad']['front']['screenColors']",d.applyProductChanges),a.$watchCollection("secTabs.cover",d.applyProductChanges),a.$watchCollection("secTabs.block",d.applyProductChanges),a.$watchCollection("secTabs.pad",d.applyProductChanges),a.$watch("currentSide",d.applyProductChanges),a.$watch("params.braceType",d.applyProductChanges),a.$watch("params.orientation",d.applyProductChanges),a.$watch("params.stampHeight",d.applyProductChanges),a.$watch("params.stampWidth",d.applyProductChanges),a.$watch("params.productsOnStamp",d.applyProductChanges),b.$watchCollection("iframeCorners",m),b.activeIframeTab="generalOptionsContent"};a.funcs={addOrder:function(){var b;if(a.order.params=a.params,a.order.secTabs=a.secTabs,a.order.pid=a.currentProduct().id,a.order.calcResult=a.calcResult,a.order.slug=k.managerCalc.$products[a.order.pid].slug,"orders.edit"==g.$state.$current.name){var c=i.FindBy(j.id);b=c.Update("calc_data",a.order.calculation_id,a.order)}else b=i.Add(a.order);return b.then(function(){g.$state.go("orders.summary")}).catch(function(a){var b="";_.each(a.data,function(a,c){b+=" "+c+"("+a.join(", ")+")."}),h.error(b)})}}}]),angular.module("Widget2Orders").controller("WidgetCalcFormController",["$scope","$httpQueue","$timeout","$filter","urls","$document","$calculatorState","toastr","$visualization",function(a,b,c,d,e,f,g,h,i){function j(a){var b=a.text.split("|");if("custom"==b[2])return d("i18n")("custom");var c=b[1]+" &times; "+b[0];return b[2]&&(c+="&nbsp;&nbsp;&nbsp;<strong>"+b[2]+"</strong>"),c}var k=null,l=300,m=0,n=["К сожалению, авторасчёт стоимости невозможен. Измените параметры или обратитесь к менеджеру."];g.on(function(d,e){var f=++m;if(k&&c.cancel(k),"working.pending.counting"!=d)return"working.pending.productInit"==d&&(a.params.additional={termOption:"common",termType:"singlepage",deliveryType:"takeaway",takeawayAddressIndex:0,deliveryOptionIndex:0}),!1;var h=_.filter(a.sections,function(b){return"block"==b||a.params.coverEnabled});for(var j in h){var o=h[j];if(0==a.options[o].material.length||0==a.options[o].density.length)return g.go("error",function(){a.calcResult.errors=n}),!1}return a.calcForm.$invalid?(g.go("error",function(){a.calcResult.errors=n}),!1):(a.calcResult.msg="counting",a.calcResult.price="",k=c(function(){var c=$("#calcform").serialize();b("calculations",{method:"POST",url:"/widget/calculate/",data:c}).success(function(b){m==f&&g.go("ok",function(){a.order.calculation_id=b.calc_data,_.merge(a.order,b),a.calcResult.errors=[],a.calcResult.msg="price_is",a.calcResult.price=b.total_cost,a.$emit("$gotCalcResult",a.calcResult),a.states.needCalc=!1,i.applyProductChanges()})}).error(function(b){g.go("error",function(){a.calcResult.errors=n,a.calcResult.msg="try_later",a.calcResult.price="",a.states.needCalc=!1})})},l),!0)},!0),a.sumCount=function(a,b){var c=0;return b=b||"cost",_.each(a,function(a,d){c+=a[b]}),c},a.calcformParams={},a.calcformParams.defaultSelectOptions={minimumResultsForSearch:-1},a.$watch("calcformParams.currentFormatIndex",function(b){a.currentProduct()&&(a.params.format=a.currentProduct().formats[b])}),a.$watch("params.format",function(b){a.currentProduct()&&b&&(a.calcformParams.currentFormatIndex=_.reduce(a.currentProduct().formats,function(a,c,d){return b.width==c.width&&b.height==c.height?d:a},null)||0)}),a.calcformParams.formatSelectOptions={minimumResultsForSearch:-1,formatResult:j,formatSelection:j,escapeMarkup:_.identity},a.calcformParams.currentChromTypeId=_.reduce(a.sections,function(b,c){return b[c]=_.reduce(a.sides,function(a,b){return a[b]=null,a},{}),b},{}),_.each(a.sections,function(b){_.each(a.sides,function(c){a.$watch("calcformParams.currentChromTypeId."+b+"."+c,function(d){a.params[b][c].chromOption=_.findWhere(a.options[b][c].chromOption,{0:d})}),a.$watch("params."+b+"."+c+".chromOption",function(d){d&&(a.calcformParams.currentChromTypeId[b][c]=d[0])})})}),a.sideIsPossible=function(b){return function(c){return"front"==c||a.params[b].printBackAllowed}},a.possibleSides=function(b){return _.filter(a.sides,a.sideIsPossible(b))},a.sidesAreDuplicates=function(b){return!!a.currentProductId&&("block"==b&&"multipage"==a.currentProduct().type&&!_.contains(["kubarik","notebook_spring"],a.currentProduct().slug))}}]),angular.module("Widget2Orders").controller("WidgetCartDetailsController",["$scope","$filter",function(a,b){function c(b){var c=[l(a.productLocal.params[b].material,"materials")];return a.productLocal.params[b].surface&&c.push(l(a.productLocal.params[b].surface).toLowerCase()),c.push(a.productLocal.params[b].density+" г/м<sup>2</sup>"),c.join(", ")}function d(b,c){if("screen"==a.productLocal.params[b].printingType){if(a.productLocal.params[b][c].screenColors.length>0){var d=_.map(a.productLocal.params[b][c].screenColors,function(a){var b=a.id.split("|");return b[0]}).join(", ");return d}return l("no")}var e=a.chromLiteral(b,c,a.productLocal.params[b][c].chromaticity);return e?e:l("no")}function e(a){return"K"==a?l("1","iframe_chromaticity"):"CMYK"==a?l("4","iframe_chromaticity"):a==l("no")?"":a}function f(b,c){return"no"==a.productLocal.params[b][c].varnishingType?"":l(a.productLocal.params[b][c].varnishingType,"varnishing")+", "+l(a.productLocal.params[b][c].varnishingSurface)}function g(b,c){return"no"==a.productLocal.params[b][c].laminationType?"":l(a.productLocal.params[b][c].laminationType,"lamination_detailed")}function h(a,b,c){return l(c)+": "+a(b,c)+"."}function i(a,b){var c=a(b,"front"),d=a(b,"back");return c==d?c:l("front","sides_short")+": "+c.toLowerCase()+", "+l("back","sides_short")+": "+d.toLowerCase()}function j(a,b){var c=_.map([m,f,g],function(c){var d=c(a,b);return void 0===d?void 0:d.toLowerCase()});return c=_.compact(c),c.length>0?l(b,"sides_short")+": "+c.join(", "):""}function k(a){try{return a.apply(null,Array.prototype.slice.call(arguments,1))}catch(a){return}}a.productLocal={params:{}},a.product||a.$watch("params",function(b){_.isObject(b)&&(a.productLocal.params=b)},!0);var l=b("i18n"),m=_.compose(e,d);a.printString=c,a.chromaticityPrintingMsg=_.partial(_.wrap(h,k),d),a.varnishingPrintingMsg=_.partial(_.wrap(h,k),f),a.laminationPrintingMsg=_.partial(_.wrap(h,k),g),a.chromaticityPrintingMsgBoth=_.partial(_.wrap(i,k),m),a.varnishingPrintingMsgBoth=_.partial(_.wrap(i,k),f),a.laminationPrintingMsgBoth=_.partial(_.wrap(i,k),g),a.frontAllData=_.partial(_.wrap(j,k),_,"front"),a.backAllData=_.partial(_.wrap(j,k),_,"back"),a.columnWidth=function(){return 6/_.reduce(a.productLocal.secTabs,function(a,b){return a+~~b.enabled},0)},a.isSinglepage=function(a){return _.keys(_.where(a,{enabled:!0})).length>1},a.init=function(b){a.productLocal.params=a.$eval(b),a.$watch(b,function(b){a.productLocal.params=b})}}]),angular.module("Widget2Orders").controller("WidgetWideprintController",["$scope","$rootScope","$http","$visualization","$timeout","$calculatorState","$configuration","toastr","$shoppingCart","$stateParams","$calculators",function(a,b,c,d,e,f,g,h,i,j,k){}]),angular.module("Widget2Orders").directive("btnClick",["$compile",function(a){return{scope:{btnClick:"="},link:function(a,b,c){var d=function(){a.isLoading||(a.isLoading=!0,b.addClass("button-loading"),a.btnClick().finally(function(){a.isLoading=!1,b.removeClass("button-loading")}))};b.on("click",d)}}}]),angular.module("Widget2Orders").directive("calcLoading",["$parse",function(a){return{templateUrl:"views/directives/calcLoading.html",scope:{isLoading:"&",isError:"&"}}}]),angular.module("Widget2Orders").directive("plusMinusInput",["$parse",function(a){return{templateUrl:"views/directives/plusMinusInput.html",scope:{model:"=",min:"@",step:"@",inputName:"@",measure:"@"},link:function(b,c,d){if(b.divider=1,void 0!=d.divider){var e=a(d.divider);b.$parent.$watch(e,function(a){b.divider=a},!0),b.$watch("divider",function(a){void 0!==e.assign&&e.assign(b.$parent,a)},!0)}b.incModel=function(){b.model+=parseInt(b.step)},b.decModel=function(){b.model-=parseInt(b.step)},b.isDecDisabled=function(){return b.model<parseInt(b.min)+parseInt(b.step)}}}}]),angular.module("Widget2Orders").directive("widgetSliderBlock",["$timeout",function(a){return{restrict:"C",scope:{visibleChange:"=ngShow",bottom:"@",resize:"@"},link:function(b,c){var d=c.prev(),e=$(b.bottom),f=c.parent(),g={},h=function(){g={offset:f.offset(),height:e.offset().top-f.offset().top},g.bounds={top:d.height(),bottom:g.height-c.height()-10}},i=function(){g.scrollTop=$(window).scrollTop()-g.offset.top,g.scrollTop=g.scrollTop<0?0:g.scrollTop+50},j=function(){g.scrollTop<=g.bounds.top?c.css({
top:g.bounds.top}):g.scrollTop>=g.bounds.bottom?c.css({top:g.bounds.bottom}):c.css({top:g.scrollTop})},k=function(){c.css({maxHeight:$(window).height()-65})},l=function(){k(),h(),i(),j()};l(),d.on("resize",l),$(window).on("resize",l),$(b.resize).on("click",function(){a(l,0)}),$(window).on("scroll",l),b.$watch("visibleChange",function(b){b&&a(l,0)})}}}]),angular.module("Clients").config(["$interpolateProvider","$httpProvider","ClientsRestangularProvider",function(a,b,c){a.startSymbol("{["),a.endSymbol("]}"),b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8",b.defaults.xsrfCookieName="csrftoken",b.defaults.xsrfHeaderName="X-CSRFToken",c.withConfig(function(a){a.setDefaultHeaders({Accept:"application/json; version=1.0","Content-Type":"application/json; charset=utf-8"}),a.setRequestSuffix("/")})}]).run(["editableOptions",function(a){a.theme="bs3"}]),angular.module("Clients").controller("ClientController",["$scope","$q","yesno","inputmask",function(a,b,c,d){a.organization_types=["ООО","ИП","ЗАО","ОАО","Другое"],a.communication_methods=["call","letter","skype","sms"],a.inputmask=d,a.client.id&&a.client.load_data(),a.activate=function(a,b){b.$visible||(b.$show(),b.$activate($(a.target).attr("e-name")))},a.add_contact=function(a){_.each(a.contacts,function(a){a.is_open=!1}),a.contacts.add(a,{is_open:!0,client:a.id,is_default:!1})},a.delete_contact=function(a,b){c.confirmation({text:"Уверены, что хотите удалить конакт "+(b.name||"")+"?",yesbtntext:"Да"}).then(function(){a.contacts.delete(b)})},a.union=function(){var a=_.filter(arguments,_.isArray);return _.flatten(a,!0)},a.communicationName=function(b){var c=a.shortName(a.clientName),d=a.shortName(a.user_name(b.responsible));return{in:b.is_incoming?d:c,out:b.is_incoming?c:d}},a.add_detail=function(a){_.each(a.details,function(a){a.is_open=!1}),a.details.add(a,{is_open:!0,client:a.id,is_default:!1})},a.delete_detail=function(a,b){c.confirmation({text:"Уверены что хотите удалить реквизиты "+(b.organization_name||"")+"?",yesbtntext:"Да"}).then(function(){a.details.delete(b)})},a.add_communication=function(a){_.each(a.communications,function(a){a.is_open=!1}),a.communications.add(a,{is_open:!0,client:a.id})},a.delete_communication=function(a,b){c.confirmation({text:"Уверены что хотите удалить общение ?",yesbtntext:"Да"}).then(function(){a.communications.delete(b)})},a.add_delivery_address=function(a){_.each(a.delivery_addresses,function(a){a.is_open=!1}),a.delivery_addresses.add(a,{is_open:!0,client:a.id})},a.delete_delivery_address=function(a,b){c.confirmation({text:"Уверены что хотите удалить "+b.address+" ?",yesbtntext:"Да"}).then(function(){a.delivery_addresses.delete(b)})},a.set_password=function(a,b){a.set_password(b).then(function(){toastr.success("Пароль был изменен")},function(){toastr.error("Не удалось изменить пароль, убедитесь что пароль состоит из латиниских символов и цифр, длина пароля не короче 6 символов.")})},a.toggle_is_active=function(a){a.toggle_is_active().then(function(){a.is_active=!a.is_active,toastr.success("Личный кабинет "+(a.is_active?"включен":"выключен"))})}}]),angular.module("Clients").factory("Client",["$q",function(a){return function(b){return b.load_data=function(){return a.all([b.load_contacts(),b.load_details(),b.load_delivery_addresses(),b.load_multi_orders(),b.load_communications()])},b.load_contacts=function(){return b.all("contacts").getList().then(function(a){return b.contacts=a,b})},b.load_details=function(){return b.all("details").getList().then(function(a){return b.details=a,b})},b.load_delivery_addresses=function(){return b.all("delivery_addresses").getList().then(function(a){return b.delivery_addresses=a,b})},b.load_multi_orders=function(){return b.all("multi_orders").getList().then(function(a){return b.multi_orders=a,_.each(b.multi_orders,function(a){a.load_data()}),b})},b.load_communications=function(){return b.all("communications").getList().then(function(a){return b.communications=a,b})},b.customSave=function(){return delete b.errors,b.id?b.put().catch(function(c){return b.errors=c.data,a.reject(b)}):b.post().then(function(a){return b.id=a.id,b.load_data()},function(c){return b.errors=c.data,a.reject(b)})},b.set_password=function(a){return b.one("set_password").post("",{password:a,password2:a})},b.toggle_is_active=function(){return b.post("toggle_is_active",{}).then(function(){return b.is_active=!b.is_active,b})},b}}]),angular.module("Clients").factory("ClientCommunication",["$q",function(a){return function(b){return b.get_contact_display=function(a){var c=_.find(a.contacts,function(a){return a.id==b.contact});return c?c.name:"---"},b.customSave=function(){return delete b.errors,(b.id?b.put():b.post()).then(function(a){return b.id=a.id,b},function(c){return b.errors=c.data,a.reject(b)})},b}}]),angular.module("Clients").factory("ClientCommunications",[function(){return function(a,b){return b.add=function(c,d){var d=d||{};b.push(a.restangularizeElement(c,d,"communications"))},b.delete=function(a){var c=_.indexOf(b,a);a.id&&a.remove(),b.splice(c,1)},b}}]),angular.module("Clients").factory("ClientContact",["$q",function(a){return function(b){return b.customSave=function(){return delete b.errors,(b.id?b.put():b.post()).then(function(a){return b.id=a.id,b},function(c){return b.errors=c.data,a.reject(b)})},b.set_default=function(a){return _.each(a.contacts,function(a){a.is_default=!1}),b.is_default=!0,b.put()},b}}]),angular.module("Clients").factory("ClientContacts",[function(){return function(a,b){return b.add=function(c,d){var d=d||{};b.push(a.restangularizeElement(c,d,"contacts"))},b.delete=function(a){var c=_.indexOf(b,a);a.id&&a.remove(),b.splice(c,1)},b.getDefault=function(){return _.first(_.where(b,{default:!0}))||_.first(b)},b}}]),angular.module("Clients").factory("ClientDeliveryAddress",["$q",function(a){return function(b){return b.customSave=function(){return delete b.errors,(b.id?b.put():b.post()).then(function(a){return b.id=a.id,b},function(c){return b.errors=c.data,a.reject(b)})},b}}]),angular.module("Clients").factory("ClientDeliveryAddresses",[function(){return function(a,b){return b.add=function(c,d){var d=d||{};b.push(a.restangularizeElement(c,d,"delivery_addresses"))},b.delete=function(a){var c=_.indexOf(b,a);a.id&&a.remove(),b.splice(c,1)},b}}]),angular.module("Clients").factory("ClientDetail",["$q",function(a){return function(b){return b.customSave=function(){return delete b.errors,(b.id?b.put():b.post()).then(function(a){return b.id=a.id,b},function(c){return b.errors=c.data,a.reject(b)})},b.set_default=function(a){return _.each(a.details,function(a){a.is_default=!1}),b.is_default=!0,b.put()},b}}]),angular.module("Clients").factory("ClientDetails",[function(){return function(a,b){return b.add=function(c,d){var d=d||{};b.push(a.restangularizeElement(c,d,"details"))},b.delete=function(a){var c=_.indexOf(b,a);a.id&&a.remove(),b.splice(c,1)},b.getDefault=function(){return _.first(_.where(b,{default:!0}))||_.first(b)},b}}]),angular.module("Clients").factory("ClientMultiOrderes",[function(){return function(a){return a.load_data=function(){a.all("orders").getList().then(function(b){return a.orders=b,a})},a}}]),angular.module("Clients").provider("ClientsRestangular",function(){var a,b={};return{withConfig:function(a){b=a},$get:["Restangular","Client","ClientContact","ClientContacts","ClientMultiOrderes","ClientDetails","ClientDetail","ClientCommunications","ClientCommunication","ClientDeliveryAddresses","ClientDeliveryAddress",function(c,d,e,f,g,h,i,j,k,l,m){return a||(a=c.withConfig(b),a.extendModel("clients",d),a.extendModel("contacts",e),a.extendCollection("contacts",_.partial(f,a)),a.extendModel("multi_orders",g),a.extendCollection("details",_.partial(h,a)),a.extendModel("details",i),a.extendCollection("communications",_.partial(j,a)),a.extendModel("communications",k),a.extendCollection("delivery_addresses",_.partial(l,a)),a.extendModel("delivery_addresses",m),a.load_clients=function(b){return a.all("clients").getList(b)},a.addResponseInterceptor(function(a,b,c,d,e){if("getList"==b&&"clients"==c){if(_.isArray(a))return a;var f=a.results;return f.count=a.count,f}return a})),a}]}}),angular.module("PrintlerCalculator").constant("DEFAULT_API_SETTINGS",{margin:0,panelActive:!0,public_offer:!1,showTipsByDefault:!0,maquettes_enabled:!1,terms:{hasFastOption:!1,hasRapidOption:!1,dependsOnCirculation:!1,dependsOnPostprint:!1,termTypes:{singlepage:_.extend({common:{term:0},fast:{term:0,margin:0},rapid:{term:0,margin:0}}),folded:_.extend({common:{term:0},fast:{term:0,margin:0},rapid:{term:0,margin:0}}),brace_binded:_.extend({common:{term:0},fast:{term:0,margin:0},rapid:{term:0,margin:0}}),spring_binded:_.extend({common:{term:0},fast:{term:0,margin:0},rapid:{term:0,margin:0}}),kubarik:_.extend({common:{term:0},fast:{term:0,margin:0},rapid:{term:0,margin:0}})},postprint:{lamination:0,uf_varnishing:0},circulation:{boundary:0,term:0}},delivery:{type:"takeaway"}}).constant("FULL_TABS_SET",{block:{enabled:!0,optional:!1,possible:!0},cover:{enabled:!1,optional:!0,possible:!1},pad:{enabled:!1,optional:!0,possible:!1}}),angular.module("PrintlerCalculator").controller("CalcFormController",["$scope","$http","$timeout","$filter","$calculatorState","$calculators","Calculator",function(a,b,c,d,e,f,g){var h=null,i=650,j=0;e.on(function(f,g){var k=++j;if("working.pending.counting"!=f)return!1;h&&c.cancel(h);var n=_.filter(a.sections,function(b){return a.secTabs[b].enabled});for(var o in n){var p=n[o],q="block"==p?"Ошибка в блоке: ":"Ошибка в обложке: ";if(0==a.options[p].material.length)return e.go("error",function(){a.calcResult.errors=[q+"Не заполнено ни одного материала, подходящего для выпуска продукта"]}),!1;if(0==a.options[p].density.length)return e.go("error",function(){a.calcResult.errors=[q+"Не заполнены плотности материала: "+d("i18n")(a.params[p].material,"materials")]}),!1}return a.calcForm.$invalid?(e.go("error",function(){a.calcResult.errors=["Невалидные данные в форме. Проверьте правильность набора данных"]}),!1):(a.calcResult.msg="counting",a.calcResult.price="",h=c(function(){var c=$("#calcform").serialize();a.calcResult.tech_info=$("#calcform").serializeArray(),a.calcResult.calc_params=a.params,b({method:"GET",url:"/calculator/ajax/calculate/?"+c}).success(function(b){k==j&&("ok"==b.result?e.go("ok",function(){a.calcResult.errors=[],a.calcResult.msg="price_is",a.calcResult.price=Math.round(b.total_cost),a.calcResult.detailed=b.detalization,"singlepage"==a.currentProduct().type?a.calcResult.detailed.detalization.parts.block.postprint=$.extend(a.calcResult.detailed.detalization.postprint,a.calcResult.detailed.detalization.parts.block.postprint):m(),l(),a.$emit("$gotCalcResult",a.calcResult),a.states.needCalc=!1}):e.go("error",function(){a.calcResult.errors=b.errors,a.calcResult.msg="try_later",a.calcResult.price="",a.states.needCalc=!1}))})},i,!1),!0)},!0),a.sumCount=function(a,b){return b=b||"cost",_.reduce(a,function(a,c){return a+c[b]},0)},a.postprintSumIsNotNull=function(){if(a.calcResult.detailed.detalization)return a.postprintSum=k("common"==a.states.activeTab?a.calcResult.detailed.detalization.postprint:a.calcResult.detailed.detalization.parts[a.states.activeTab].postprint),0!==a.postprintSum};var k=function(a,b){return b=b||"cost",_.reduce(a,function(a,c){return a+c[Object.keys(c)[0]][b]},0)},l=function(){$.isScrollToFixed("#scroll_fixed_head")||$("#scroll_fixed_head").scrollToFixed({marginTop:function(){return"fixed"===$(".page-header").css("position")?47:0},fixed:function(){"fixed"===$(".page-header").css("position")&&($("#scroll_fixed_head").css("width","50%"),$("#scroll_fixed_head.calc-scroll-head.scroll-to-fixed-fixed .calc-thumbnail-block").removeClass("col-xs-2"),$("#scroll_fixed_head.calc-scroll-head.scroll-to-fixed-fixed .calc-counting-block").removeClass("col-xs-10"),$("#scroll_fixed_head.calc-scroll-head.scroll-to-fixed-fixed .calc-thumbnail-block").addClass("col-xs-4"),$("#scroll_fixed_head.calc-scroll-head.scroll-to-fixed-fixed .calc-counting-block").addClass("col-xs-8"))},unfixed:function(){$("#scroll_fixed_head.calc-scroll-head .calc-thumbnail-block").removeClass("col-xs-4"),$("#scroll_fixed_head.calc-scroll-head .calc-counting-block").removeClass("col-xs-8"),$("#scroll_fixed_head.calc-scroll-head .calc-thumbnail-block").addClass("col-xs-2"),$("#scroll_fixed_head.calc-scroll-head .calc-counting-block").addClass("col-xs-10")}})},m=function(){$.isScrollToFixed("#calcform .nav.nav-tabs")||$("#calcform .nav.nav-tabs").scrollToFixed({marginTop:function(){var a=$("#scroll_fixed_head").outerHeight(!0);return"fixed"===$(".page-header").css("position")?a+47:a},fixed:function(){$(this).css("margin-left","-10px"),$(this).css("padding-left","10px"),$(this).width($(this).width()+30)},unfixed:function(){$(this).css("margin-left","0px"),$(this).css("padding-left","0px"),$(this).css("width","auto")}})}}]),angular.module("PrintlerCalculator").controller("CalculatorController",["$scope","$httpQueue","$timeout","$filter","$q","urls","$calculation","$promiseUtils","ModalService","$calculatorState","Calculator","$calculators","FULL_TABS_SET",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.isLoad=!1,a.currentProductId=null,a.$products=[],a.product=void 0,a.machines=[],a.apiSettings={},a.states={activeTab:"common",needCalc:!1,init:!0},a.showDetalization=!1,a.urls=f,a.tooltips=!0,a.is_files_reload=!1,a.secTabs={},a.sections={},a.sides=[],a.calcResult={},a.params={},a.options={},a.getlaminationThickness=function(b){return b&&"no"!=b?a.printeryData[b+"_laminate_microns"]:["no"]},a.allSections=function(){return["common"].concat(_.keys(d("filterValue")(a.secTabs,{possible:!0})))},a.sectionIsEnabled=function(b){return a.secTabs[b].enabled},a.sectionIsPossible=function(b){return a.secTabs[b].possible},a.formatString=function(a){if(!a)return!1;if("custom"===a.title)return d("i18n")("custom");var b;return b=a.width+" x "+a.height,a.title&&(b=a.title+" ("+b+")"),b},a.chromCount=function(a){var b=0;for(var c in a)b+=~~a[c];return b},a.chromLiteral=function(b,c,d){var e="";return!!(d=d||a.params[b][c].chromaticity)&&(_.each(["C","M","Y","K"],function(a){d[a]&&(e+=a)}),e)},a.singleChromObject=function(a){return{C:"C"==a,M:"M"==a,Y:"Y"==a,K:"K"==a}},a.oneOf=function(a){return function(b){return _.contains(a.split(","),b)}},a.productPossible=function(a){return a.possible},a.currentProduct=function(){return a.product},a.by=function(b,c){return _.filter(a.$products,function(a){return _.contains(c,a[b])})},a.setProduct=function(b){b.possible&&(a.product=b,a.states.init=!0,j.go("recount"))},a.setProductBySlug=function(b){a.product=_.findWhere(a.$products,{slug:b}),a.states.init=!0,j.go("recount")},a.recount=function(){j.go("counting")},a.densityMinFilter=function(b,c){c=c||a.sec;var d=a.params[c].minDensity;return b>=d||0==d||0==b},a.densityMaxFilter=function(b,c){c=c||a.sec;var d=a.params[c].maxDensity;return b<=d||0==d||0==b},a.densityFilter=function(b,c){return a.densityMaxFilter(b,c)&&a.densityMinFilter(b,c)},a.getDensities=function(b){var c=a.params[b].material,d=a.params[b].surface||"no",e=a.params[b].glueType||"permanent";g.getDensities(c,d,e).then(function(c){a.options[b].density=_.filter(c,function(c){return a.densityFilter(c,b)}),a.$depsDriver.finishParamResolving("params."+b+".material"),a.$depsDriver.finishParamResolving("params."+b+".surface"),a.$depsDriver.finishParamResolving("params."+b+".glueType")})},a.updateOrientation=function(b){return a.$depsDriver.finishParamResolving("params.formatWidth"),a.$depsDriver.finishParamResolving("params.formatHeight"),a.$depsDriver.finishParamResolving("params.orientation"),!0},a.updateSingleChrom=function(b,c){var d=a.params[b][c].chromaticity;a.params[b][c].singleChromColor=_.first(_.find(_.pairs(d),function(a){return a[1]})),a.$depsDriver.finishParamResolving("params."+b+"."+c+".chromaticity")},j.extendConfig({"init.loading":{_onEnter:function(){a.states.loadingMessage="Получение настроек технопарка",l.managerCalc||(l.managerCalc=new k,l.managerCalc.getAll()),l.managerCalc.promise.then(function(){return l.managerCalc.init(a)}).then(function(){o(),j.go("ready")}).catch(function(){j.go("error")})}},"working.pending.productInit":{_onEnter:function(){a.params=angular.copy(l.managerCalc.blankParamObject),a.options=angular.copy(l.managerCalc.blankParamObject),c(function(){var b=a.currentProduct();if(b.custom){a.params=_.cloneDeep(b.custom.params),a.options=_.cloneDeep(b.custom.options),a.secTabs=_.cloneDeep(b.custom.secTabs),a.is_files_reload=!a.is_files_reload;var d=b.custom.params.orientation;c(function(){a.params.orientation=d})}else{a.params.block.pagesDiv=b.pages_on_spread||b.pages_on_spread_block,$.extend(!0,a.options,b.calc_settings.options),$.extend(!0,a.params,b.calc_settings.defaults),a.states.activeTab="singlepage"==b.type?"block":"common";var e=b.calc_settings.defaults.format;a.params.format=_.find(b.formats,function(a){return e.width==a.width&&e.height==a.height})||b.formats[0],a.secTabs=angular.copy(m),a.secTabs.cover.enabled=a.params.coverEnabled&&b.is_cover,a.secTabs.pad.enabled=a.params.padEnabled&&b.is_back_cover,a.secTabs.cover.optional=a.params.coverOptional,a.secTabs.pad.optional=a.params.padOptional,a.secTabs.cover.possible=b.is_cover,a.secTabs.pad.possible=b.is_back_cover,b.is_cover&&(a.params.cover.pagesDiv=b.pages_on_spread_cover),b.is_back_cover&&(a.params.pad.pagesDiv=b.pages_on_spread_cover)}j.go("deps")})}},"working.pending.depsResolving":{counting:"working.pending.counting",_onEnter:function(){a.$depsDriver.apply(a.currentProduct().dependencies),a.$depsDriver.onResolveFinish(function(){a.apiSettings.autoCalc?j.go("counting"):(a.states.needCalc=!0,a.states.init?(j.go("counting"),a.states.init=!1):j.go("ok"))})}}});var n=function(b){switch(b){case"working.pending.productInit":a.showDetalization=!1;break;case"working.finished.ok":a.showDetalization=!0;break;case"working.finished.error":a.showDetalization=!1}},o=function(){a.$watch("params",function(){a.apiSettings.autoCalc?a.recount():a.states.needCalc=!0},!0),a.$watch("secTabs",function(){a.apiSettings.autoCalc?a.recount():a.states.needCalc=!0},!0),a.$watch("secTabs.pad.enabled",function(b){a.secTabs.pad.possible&&(a.params.cover.pagesNumber=a.params.cover.pagesDiv,b?a.secTabs.cover.enabled=!0:a.params.cover.pagesNumber*=2,a.secTabs.cover.optional=!b)})};a.calcstate=j,a.saveOrderModal=function(){i.showModal({templateUrl:"views/saveOrderModal.html",controller:"SaveOrderController",controllerAs:"sc",inputs:{orderParams:{params:a.params,options:a.options,secTabs:a.secTabs,calcResult:a.calcResult},currentProduct:a.currentProduct()}}).then(function(a){a.element.modal(),a.close.then(function(a){})})},j.newState(),j.on(function(a,b){n(a)})}]),angular.module("PrintlerCalculator").controller("SaveOrderController",["$scope","orderParams","currentProduct","toastr","$q","terms","delivery","$shoppingCart","ClientsRestangular","MultiOrdersRestangular","WidgetUserRestangular","httpOptions","$http","Product",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.form={state:"loading",clientInfo:{name:"",phone:"",email:""},isNewOrder:!0,isNewClient:!1,client_id:void 0,multi_order_id:void 0,clients:[],multi_orders:[],client:void 0,multi_order:void 0},a.clientInfo={address:""},a.session=k,a.cart=h,a.deliveries=g.data,a.$watch("form.multi_order_id",function(b){a.form.multi_order=_.find(a.form.multi_orders,function(a){return a.id==b})}),a.$watch("form.client_id",function(a){p(a)}),a.$watch("cart.delivery_option",function(b){a.delivery=_.find(a.deliveries,function(a){return a.id==b})}),a.$watch("cart.day",function(a){h.terms.setMargins(a),_.each(h.products,function(a,b){a.Update("term_option",a.term_option)})}),a.loadMultiOrder=function(){var b=_.find(a.form.clients,function(b){return b.id==a.form.multi_order.client});o(b.auth_token)},a.clientCheck=function(){var b=e.when(!0);a.form.client||(b=k.register(a.form.clientInfo).then(function(b){a.form.client_id=b.id}).then(q).then(function(){p(a.form.client_id)})),b.then(function(){o(a.form.client.auth_token)})},a.deliveryCost=function(b){var c=b.cost;return"delivery"==b.delivery_type&&a.cart.totalWeight()>a.onlineOptions.on_weight&&(c+=a.onlineOptions.on_weight_increase_margin_to),c>0?"+ "+Math.round(c)+" р.":"Бесплатно"},a.create=function(){v().then(function(){return h.Create()}).then(function(b){a.CreatedMultiOrder=b.data,a.form.state="final"})};var o=function(b){return k.checkAuth(b).then(t).then(u).then(function(){a.form.state="delivery"})},p=function(b){a.form.client=_.find(a.form.clients,function(a){return a.id==b})},q=function(){return i.load_clients().then(function(b){a.form.clients=b})},r=function(){return j.load_multi_orders({}).then(function(b){a.form.multi_orders=b})},s=function(){return m.get("/online/").then(function(b){a.onlineOptions=b.data,h.onlineOptions=b.data})},t=function(){var a=_.extend({},l.headers);return a["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",a.Accept="application/json, text/plain, */*",m.post("/widget/calculate/",$("#calcform").serialize(),{headers:a})},u=function(b){return h.Clear(),a.form.multi_order&&_.each(a.form.multi_order.orders,function(a){h.products.push(new n(a.plain()))}),a.cart.contact=k.user.contacts.getDefault(),a.cart.contact&&(a.cart.contact=a.cart.contact.id),h.Add({calculation_id:b.data.calc_data,slug:c.slug}).then(function(){a.delivery=a.cart.initDelivery()})},v=function(){return"delivery"==a.delivery.delivery_type&&null==h.delivery_address?k.user.delivery_addresses.post({address:a.clientInfo.address,client:k.user.id}).catch(function(a){d.error(a.data)}).then(function(b){return a.cart.delivery_address=b.id,k.user.delivery_addresses.push(b),b}):e.when(!0)};e.all([q(),r(),s()]).then(function(){a.form.state="order"})}]),angular.module("PrintlerCalculator").controller("TechCartTaskController",["$scope",function(a){a.tech_info=a.tech_info||{},a.calc_params=a.calc_params||{},a.$root.$on("$gotCalcResult",function(b,c){a.tech_info={},_.each(c.tech_info,function(b){a.tech_info[b.name]=b.value}),a.calc_params.params=c.calc_params}),a.screenColors=function(a){return _.map(a,function(a){return a.text}).join(",")},a.chromaticity=function(a){return a?(a.C?"C":"")+(a.M?"M":"")+(a.Y?"Y":"")+(a.K?"K":""):""}}]),angular.module("PrintlerCalculator").controller("WideprintController",["$scope","$depsFetcher","$depsDriver","$wideprint","Machina","$timeout","select2Printler",function(a,b,c,d,e,f,g){function h(b,d){var e=_.drop(arguments,2);return function(){var f=_.map(e,_.bind(a.$eval,a));b.apply(null,f).then(function(a){_.each(e,c.finishParamResolving),d(a)})}}function i(){return d.calculateWideprint({circulation:a.params.circulation,product:_.omit(a.params,"circulation")}).then(function(a){k.success(a)}).catch(function(a){k.fail(a.errors)})}var j=c("wideprint");a.defaults={},a.params=null,a.options=null,a.resolutionMap={},a.calcResult={},a.states={activeTab:"block"},a.errors=null;var k=new e({initialState:"init",startResolving:function(){this.transition("resolving")},endResolving:function(){this.handle("endResolving")},calculate:function(){this.handle("calculate")},success:function(b){try{a.calcResult.totalCost=b.total_cost,a.calcResult.detailed=b.detalization,a.calcResult.detailed.detalization.parts.block.postprint=$.extend(a.calcResult.detailed.detalization.postprint,a.calcResult.detailed.detalization.parts.block.postprint),a.$root.$broadcast("$gotCalcResult",a.calcResult)}catch(a){}this.transition("ok")},fail:function(b){a.errors=b,this.transition("fail")},states:{init:{ready:"ready"},ready:{calculate:"calculating"},resolving:{endResolving:"calculating"},calculating:{_onEnter:_.debounce(i,400)},ok:{calculate:"calculating"},fail:{calculate:"calculating"}}});a.getLightTransmission=h(d.getLightTransmission,function(b){a.options.block.material.lightType=b},"params.block.material.type"),a.getSurfaces=h(d.getSurfaces,function(b){a.options.block.material.surface=b},"params.block.material.type","params.block.material.lightType"),a.getDensities=h(d.getDensities,function(b){a.options.block.material.density=b},"params.block.material.type","params.block.material.lightType","params.block.material.surface"),a.isInitialState=function(){return"init"===k.state||"ready"===k.state},a.isPending=function(){return"resolving"===k.state||"calculating"===k.state},a.isOkState=function(){return"ok"===k.state},a.isErrorState=function(){return"fail"===k.state},a.isGluing=function(){return!!a.calcResult.detailed&&_.some(a.calcResult.detailed.detalization.postprint,function(a){return a.Gluing})},a.sumCount=function(a,b){return b=b||"cost",_.reduce(a,function(a,c){return a+c[b]},0)},a.postprintSumIsNotNull=function(){return!(!a.calcResult.detailed||!a.calcResult.detailed.detalization)&&(a.postprintSum=l("common"==a.states.activeTab?a.calcResult.detailed.detalization.postprint:a.calcResult.detailed.detalization.parts[a.states.activeTab].postprint),!0)},a.getSelectOptions=function(a){return new g($(a)).options};var l=function(a,b){return b=b||"cost",_.reduce(a,function(a,c){return a+c[Object.keys(c)[0]][b]},0)};d.getWideprintDefaults("wideprint").then(function(b){a.defaults.defaults=_.cloneDeep(b.params),a.defaults.options=_.cloneDeep(b.options),a.params=b.params,a.options=b.options,a.constraints=b.constraints,j.setScope(a),j.setDefaultPrefix("defaults")}),d.getMaterialTypes("wideprint").then(function(b){a.options.block.material.type=b}),d.getResolutions("wideprint").then(function(b){a.options.block.printing.purpose=b.purposes,a.resolutionMap=b.resolutions}),b.getWideprintDeps("wideprint").then(function(a){j.apply(a),k.handle("ready")}),j.onResolveStart(_.bind(k.startResolving,k)),j.onResolveFinish(_.bind(k.endResolving,k));var m=_.bind(k.calculate,k);a.$watch("params",m,!0),a.$watch("params",m,!0)}]),angular.module("PrintlerCalculator").directive("cringlesPockets",["$timeout",function(a){return{restrict:"A",templateUrl:"views/directives/cringlesPockets.html",scope:{cringles:"=",pockets:"=",options:"=",constraints:"="},link:function(a,b,c){var d=document.getElementById("cringles-pockets-img"),e=d.getContext("2d"),f=d.width,g=d.height;a.locations={};var h=function(b,c){a[c]&&("cringles"==c?(a.cringles.customLocation.location=_.union(a.cringles.customLocation.location,[b]),a.pockets.location=_.filter(a.pockets.location,function(a){return a!=b})):(a.pockets.location=_.union(a.pockets.location,[b]),a.cringles.customLocation.location=_.filter(a.cringles.customLocation.location,function(a){return a!=b})),i())},i=function(){if(a.cringles)switch(e.clearRect(0,0,f,g),e.strokeStyle="#000",e.fillStyle="#fff",a.cringles.type){case"corners":k();break;case"corner_and_center":k(),l();break;case"custom":j()}},j=function(){"cringles"==a.locations.up&&p(),"cringles"==a.locations.down&&q(),"cringles"==a.locations.sides&&o(),"pockets"==a.locations.up&&s(),"pockets"==a.locations.down&&t(),"pockets"==a.locations.sides&&r()},k=function(){m(10,10),m(10,g-10),m(f-10,g-10),m(f-10,10)},l=function(){m(10,g/2),m(f/2,10),m(f-10,g/2),m(f/2,g-10)},m=function(a,b){e.beginPath(),e.arc(a,b,4,0,2*Math.PI,!1),e.closePath(),e.stroke(),e.fill()},n=function(a,b,c,d){e.beginPath(),e.moveTo(a,b),e.lineTo(c,d,1),e.closePath(),e.stroke()},o=function(){n(5,5,5,g-5);for(var a=25;a<=g-15;a+=20)m(15,a);n(f-5,5,f-5,g-5);for(var a=25;a<=g-15;a+=20)m(f-15,a)},p=function(){n(5,5,f-5,5);for(var a=20;a<=f-20;a+=20)m(a,15)},q=function(){n(5,g-5,f-5,g-5);for(var a=20;a<=f-20;a+=20)m(a,g-15)},r=function(){n(1,5,1,g-5),n(9,5,9,g-5),m(5,5),m(5,g-5),n(f-9,5,f-9,g-5),n(f-1,5,f-1,g-5),m(f-5,5),m(f-5,g-5)},s=function(){n(5,1,f-5,1),n(5,9,f-5,9),m(5,5),m(f-5,5)},t=function(){n(5,g-9,f-5,g-9),n(5,g-1,f-5,g-1),m(5,g-5),m(f-5,g-5)};a.$watch("locations.up",function(a){h("up",a)}),a.$watch("locations.down",function(a){h("down",a)}),a.$watch("locations.sides",function(a){h("sides",a)}),a.$watch("cringles.type",i),a.locations.up=_.contains(a.cringles.customLocation.location,"up")?"cringles":"pockets",a.locations.down=_.contains(a.cringles.customLocation.location,"down")?"cringles":"pockets",a.locations.sides=_.contains(a.cringles.customLocation.location,"sides")?"cringles":"pockets"}}}]),angular.module("PrintlerCalculator").directive("pantoneList",["$http","urls",function(a,b){return{templateUrl:"views/directives/pantoneList.html",scope:{side:"@",sec:"@",colors:"="},link:function(a,c,d){function e(a){var b=a.id.split("|"),c=b[0],d=b[1];return'<span class="pantone-color" style="background-color: '+d+';">&nbsp;</span> '+c}a.colors=a.colors||[{id:"100|#ffff7d",text:"100"}],a.pantoneSelectSettings={ajax:{url:b["get-pantones-ajax"],dataType:"json",quietMillis:150,cache:!0,data:function(a,b){return{query:a,page:b}},results:_.identity},formatResult:e,formatSelection:e,formatSearching:"Поиск...",formatNoMatches:"Цвета не найдены",formatLoadMore:"Загрузка...",escapeMarkup:_.identity,multiple:!0,maximumSelectionSize:6,formatSelectionTooBig:function(a){return"Вы можете выбрать не более "+a+" цветов."}}}}}]),angular.module("PrintlerCalculator").factory("Calculator",["$http","$q","DEFAULT_API_SETTINGS","urls","$depsDriver","$depsFetcher","$imagePreloader","FULL_TABS_SET",function(a,b,c,d,e,f,g,h){function i(a){_.each(this.sections,function(b){a.call(this,b)}.bind(this))}function j(a){_.each(this.sides,function(b){a.call(this,b)}.bind(this))}function k(a){i.call(this,function(b){j.call(this,function(c){a.call(this,b,c)})})}function l(a,b){angular.copy(_.filter(a,b),a)}function m(a){if(a.possible=!0,"multipage"!=a.type||_.contains(["kubarik","notebook_spring"],a.slug)||this.printeryData.pickup_machine_or_hand_selection?_.contains(["kubarik","notebook_spring"],a.slug)&&!this.printeryData.sheet_counting?(a.possible=!1,a.impossibilityReason="Не указана стоимость подсчета листов"):a.is_folded&&!this.printeryData.folding_machine_or_hand_folding?(a.possible=!1,a.impossibilityReason="Нет фальцовщика и не указана стоимость ручной фальцовки"):"hotmelt_binding"!=a.binding_type||this.printeryData.hotmelt_machine_any?"stamping_product"==a.slug?this.printeryData.shapecutter?this.printeryData.blade_cost||(a.possible=!1,a.impossibilityReason="Не указана стоимость лезвий (см. вкладку Прочее в настройках машин)"):(a.possible=!1,a.impossibilityReason="Нет оборудования для вырубки"):"spring_binding"==a.binding_type?this.printeryData.spring_binding?this.printeryData.spring_metal||this.printeryData.spring_plastic||(a.possible=!1,a.impossibilityReason="Не найдено ни одной пружины в списке материалов"):(a.possible=!1,a.impossibilityReason="Не указаны стоимости скрепления на пружину"):"pva_binding"!=a.binding_type||this.printeryData.pva_binding?"sticker"==a.slug&&0==this.printeryData.self_adhesive_glue_types.length&&(a.possible=!1,a.impossibilityReason="Не найдено самоклейки с надсечкой в списке материалов"):(a.possible=!1,a.impossibilityReason="Не указана стоимость скрепления на клей ПВА"):(a.possible=!1,a.impossibilityReason="Нет оборудования для скрепления на термоклей"):(a.possible=!1,a.impossibilityReason="Нет листоподборщика и не указана стоимость ручного подбора"),a.possible)return"brace_binding"!=a.binding_type||this.printeryData.pickup_machine_file_bracket?"spring_binding"==a.binding_type&&(l(a.calc_settings.options.springMaterial,function(a){return"metal"==a&&this.printeryData.spring_metal&&this.printeryData.spring_colors.metal.length>0||"plastic"==a&&this.printeryData.spring_plastic&&this.printeryData.spring_colors.plastic.length>0}.bind(this)),a.calc_settings.options.springColorOptions=this.printeryData.spring_colors):l(a.calc_settings.options.braceType,function(a){return"file"!=a}),k.call(this,function(b,c){l(a.calc_settings.options[b][c].varnishingType,function(a){return"no"==a||"of"==a&&this.printeryData.printing_offset||"vd"==a&&this.printeryData.printing_offset_vd||"uff"==a&&this.printeryData.uf_machine_any||"ufp"==a&&this.printeryData.uf_machine_stencil}.bind(this)),l(a.calc_settings.options[b][c].laminationType,function(a){return"no"==a||this.printeryData.laminator_any;
}.bind(this))}),i.call(this,function(b){l(a.calc_settings.options[b].printingType,function(a){return"auto"==a||"digital"==a&&this.printeryData.printing_digital||"offset"==a&&this.printeryData.printing_offset||"screen"==a&&this.printeryData.is_screen_printing_available}.bind(this)),a.calc_settings.options[b].material=_.intersection(a.calc_settings.options[b].material,this.materials)}),0==_.size(a.calc_settings.options.block.material)?(a.possible=!1,void(a.impossibilityReason="Нет необходимых материалов для изготовления изделия.")):void 0}var n=function(a){this.blankParamObject=_.reduce(h,function(a,b,c){return a[c]={front:{},back:{}},a},{});var c={initErrorMsg:"",apiSettings:{},printeryData:{},materials:[],materialSurfaces:{},machines:[],$products:[],defaultDependencies:{},secTabs:angular.copy(h),sections:_.keys(angular.copy(h)),sides:["front","back"],calcResult:{msg:"",price:"",detailed:{},errors:[]},params:angular.copy(this.blankParamObject),options:angular.copy(this.blankParamObject),$depsDriver:void 0};_.merge(this,c),this.paramsNames=_.keys(c),this.scope=a,this.promise=b.when(!0)};n.prototype.init=function(a){return a?(this.scope=a,_.each(this.paramsNames,function(a){this.scope[a]=this[a]}.bind(this)),this.scope.isLoad=!0,this.scope.$depsDriver=e(),this.scope.$depsDriver.setScope(a),this.scope.$depsDriver.setDefaultPrefix("currentProduct().calc_settings"),this.$depsDriver=this.scope.$depsDriver,this.promise=this.getDefaultDependencies().then(function(){return this.prepareProducts()}.bind(this)).finally(function(){this.promise=b.when(!0)}.bind(this))):b.reject("no scope")},n.prototype.getAll=function(){return this.isGetAll=!0,this.promise=b.all([this.getTotalSettings(),this.getMaterials(),this.getMachines()]).then(function(){return this.getProducts()}.bind(this)).finally(function(){this.promise=b.when(!0)}.bind(this))},n.prototype.getTotalSettings=function(){return a.get(d["get-total-settings-ajax"]).then(function(a){var c=o(a.data);return c.valid?_.merge(this.printeryData,a.data):(this.initErrorMsg=c.msg,b.reject(this.initErrorMsg))}.bind(this))},n.prototype.getMaterials=function(){return a.get(d["get-materials-ajax"]).then(function(a){return this.materials=_.keys(a.data),this.materialSurfaces=a.data,{materials:this.materials,surfaces:this.materialSurfaces}}.bind(this))},n.prototype.getMachines=function(){return a.get("/calculator/ajax/get_machines/").then(function(a){return this.machines=a.data}.bind(this))},n.prototype.getProducts=function(){return a.get(d["get-products-ajax"]).then(function(a){return this.$products=a.data,_.each(this.$products,function(a){m.call(this,a)}.bind(this)),this.$products}.bind(this))},n.prototype.getDefaultDependencies=function(){return a.get(d["get-default-dependencies-ajax"]).then(function(a){this.defaultDependencies=this.$depsDriver.preparse(a.data)}.bind(this))},n.prototype.getWideprintDeps=function(){return a.get("/wideprint/dependencies")},n.prototype.prepareProducts=function(){_.each(this.$products,function(a){a.dependencies=_.merge({},this.defaultDependencies,this.$depsDriver.preparse(a.dependencies)),"undefined"!=typeof PRINTLER_MANAGER_CALC&&k.call(this,function(b,c){l(a.calc_settings.options[b][c].chromOption,function(a){return"no"!==a[0]})})}.bind(this));var a=_.map(this.$products,function(a){return d.product_image_url+a.image_name+".png"});return g.preloadImages(a)};var o=function(a){return a.cutter?a.printing_any?{valid:!0}:{valid:!1,msg:"В технопарке отсутствуют печатные машины."}:{valid:!1,msg:"В технопарке отсутствуют резчики."}};return n}]),angular.module("PrintlerCalculator").filter("calcStateInclude",["$calculatorState",function(a){var b=function(b){var c=a.includes(b);return c};return b.$stateful=!0,b}]).filter("calcIsState",["$calculatorState",function(a){var b=function(b){var c=a.is(b);return c};return b.$stateful=!0,b}]),angular.module("PrintlerCalculator").filter("productSort",function(){return function(a){return _.sortBy(_.where(a,{possible:!0}),function(a){return a.calc_settings.defaults.sortingOrder})}}),angular.module("PrintlerCalculator").service("$calculation",["$httpQueue","$promiseUtils","urls",function(a,b,c){var d=new b.OncePromise(function(a){return{materials:_.keys(a.data),surfaces:a.data}});this.getMaterials=function(b){return a.getOnce(d,b,c["get-materials-ajax"])},this.materials=function(){return _.result(d.result(),"materials")},this.surfaces=function(){return _.result(d.result(),"surfaces")},this.getDensities=function(d,e,f){if(!d)return b.result([]);var g=a("densities",{method:"GET",url:c["get-densities-ajax"],params:{material:d,surface:e,glueType:f},cache:!0});return b.bind(g,function(a){return b.result(a.data)})},this.getMachines=function(){var c=a("machines",{method:"GET",url:"/calculator/ajax/get_machines/",cache:!0});return b.bind(c,function(a){return b.result(a.data)})}}]),angular.module("PrintlerCalculator").service("$calculatorState",["Machina",function(a){var b=this;this.machina=void 0;var c={initialState:"init.loading",states:{"init.loading":{error:"init.loading.error",ready:"init.ready"},"init.loading.error":{reset:"init.ready"},"init.ready":{working:"working",recount:"working"},working:{_onEnter:function(){this.handle("pending")},pending:"working.pending",recount:"working",reset:"init.ready"},"working.pending":{_onEnter:function(){this.handle("init")},init:"working.pending.productInit",recount:"working",reset:"init.ready"},"working.pending.productInit":{deps:"working.pending.depsResolving",recount:"working",reset:"init.ready"},"working.pending.depsResolving":{counting:"working.pending.counting",recount:"working",reset:"init.ready",ok:"working.finished.ok"},"working.pending.counting":{ok:"working.finished.ok",error:"working.finished.error",recount:"working",reset:"init.ready"},"working.finished.ok":{recount:"working",counting:"working.pending.counting",reset:"init.ready","summary.cart":"summary.cart"},"working.finished.error":{recount:"working",counting:"working.pending.counting",reset:"init.ready"}}};this.extendConfig=function(a){_.each(a,function(a,b){_.extend(c.states[b],a)})},this.newState=function(){b.machina=new a(c)},this.go=function(a,c){if(c)var d=b.machina.states[b.machina.state][a],e=b.machina.on("transition",function(a){e.off(),a.toState==d&&c(a)});b.machina.handle(a)},this.on=function(a){return b.machina.on("transition",function(b){a(b.toState,b.fromState)})},this.is=function(a){var c=_.isArray(a)?a:[a];return _.contains(c,b.machina.state)},this.includes=function(a){if("init.ready"==a);return b.machina.state.indexOf(a)>=0}}]),angular.module("PrintlerCalculator").service("$orders",["$httpQueue","$promiseUtils","urls",function(a,b,c){function d(a){return{api_key:a.apiKey,client_email:a.clientInfo.email,client_info:_.omit(a.clientInfo,"email","passwordRepeat"),orderParams:{params:a.orderParams,results:a.termResults},orderComment:a.orderComment||"",tech_data:_.map(a.products,function(b){return{title:b.title||a.productList[b.id].title,format:""+b.custom.params.formatWidth+" x "+b.custom.params.formatHeight,circulation:b.custom.params.circulation,price:b.custom.calcResult.price,form_data:b.custom.formData,calcParams:b.custom}}),files:_.map(a.products,function(a){return{files:a.custom.files}})}}function e(b){var c=d(b),e=_.omit(c,"files"),f=_.pick(c,"files");return a("orders",{url:"/ajax-order/create-order-bulk/",method:"POST",headers:{"Content-Type":void 0},transformRequest:function(a){var b=new FormData;b.append("model",angular.toJson(a.model));for(var c=0;c<a.files.files.length&&a.files.files[c].files;c++)for(var d=0;d<a.files.files[c].files.length;d++)b.append("file_product_"+c+"_file_"+d,a.files.files[c].files[d]);return b},data:{model:e,files:f}})}function f(b,c){var e=d(c),f=_.omit(e,"files"),g=_.pick(e,"files");return a("orders",{url:"/multi_orders/update/"+b+"/",method:"POST",headers:{"Content-Type":void 0},transformRequest:function(a){var b=new FormData;b.append("model",angular.toJson(a.model));for(var c=0;c<a.files.files.length&&a.files.files[c].files;c++)for(var d=0;d<a.files.files[c].files.length;d++)b.append("file_product_"+c+"_file_"+d,a.files.files[c].files[d]);return b},data:{model:f,files:g}})}function g(a,b){return{order_params:a,products:JSON.stringify(_.map(b,function(a){var b=_.pick(a,"slug","type","is_folded","binding_type");return b.total_cost=a.custom.calcResult.price,b.circulation=a.custom.params.circulation,b.operations=a.custom.calcResult.operations,b}))}}function h(b,d){return a.get("main",c["terms-margins-ajax"],{params:g(b,d)})}this.register=b.throttle(e),this.update=b.throttle(f),this.getTermsResults=h}]),angular.module("PrintlerCalculator").service("$visualization",["$http",function(a){var b=null,c=null,d=null,e=!1;this.applyProductChanges=function(){};var f=function(a,c,d){var e=a.getBounds(),f=b.visualizationDownloadQueue.getResult("blackhole"),g=new createjs.Container,h=.2*f.width;if("top"==c.position)for(var i=e.width/h/2-2,j=0;j<i;j++){var k=new createjs.Shape;k.graphics.setStrokeStyle(1),k.graphics.beginStroke("black"),k.graphics.beginFill("white"),k.graphics.drawCircle(0,0,2),k.graphics.endFill(),k.graphics.endStroke(),k.x=j*h*2+(e.width-h*i*2)/2,k.y=h,g.addChild(k)}else if("bottom"==c.position)var i=e.width/h/2-2;else if("left"==c.position)for(var i=e.height/h/2-2,j=0;j<i;j++){var k=new createjs.Shape;k.graphics.setStrokeStyle(1),k.graphics.beginStroke("black"),k.graphics.beginFill("white"),k.graphics.drawCircle(0,0,2),k.graphics.endFill(),k.graphics.endStroke(),k.x=e.x+h,k.y=j*h*2+(e.height-h*i*2)/2,g.addChild(k)}else if("right"==c.position)for(var i=e.height/h/2-2,j=0;j<i;j++){var k=new createjs.Shape;k.graphics.setStrokeStyle(1),k.graphics.beginStroke("black"),k.graphics.beginFill("white"),k.graphics.drawCircle(0,0,2),k.graphics.endFill(),k.graphics.endStroke(),k.x=e.x+e.width-2*h,k.y=j*h*2+(e.height-h*i*2)/2,g.addChild(k)}return g},g=function(){for(var a=new createjs.Container,c=0;c<10;c++){var d=new createjs.Bitmap(b.visualizationDownloadQueue.getResult("spring"));d.x=5*c,d.y=0,d.scaleX=.1,d.scaleY=.1,a.addChild(d)}return a.x=130,a.y=5,a},h=function(){var a=null;"file"==b.$parent.params.braceType?a=b.visualizationDownloadQueue.getResult("filebrace"):"simple"==b.$parent.params.braceType&&(a=b.visualizationDownloadQueue.getResult("simplebrace"));var c=new createjs.Container,d=new createjs.Bitmap(a);d.x=10,d.y=65;var e=new createjs.Bitmap(a);return e.x=10,e.y=115,c.addChild(d),c.addChild(e),c},i=function(){var a=null;"blockOptionsContent"==d.activeIframeTab?a="block":"coverOptionsContent"==d.activeIframeTab?a="cover":"padOptionsContent"==d.activeIframeTab&&(a="pad");var c=new createjs.Container,e=null;"uff"==b.$parent.params[a][d.currentSide].varnishingType||"ufp"==b.$parent.params[a][d.currentSide].varnishingType?e=b.visualizationDownloadQueue.getResult("varnishing_uf"):"vd"==b.$parent.params[a][d.currentSide].varnishingType?e=b.visualizationDownloadQueue.getResult("varnishing_vd"):"of"==b.$parent.params[a][d.currentSide].varnishingType&&(e=b.visualizationDownloadQueue.getResult("varnishing_of"));var f=new createjs.Bitmap(e);f.x=240,f.y=30,c.addChild(f);var g=null;"yes"==b.$parent.params[a][d.currentSide].laminationType&&"glossy"==b.$parent.params[a][d.currentSide].laminationSurface?g=b.visualizationDownloadQueue.getResult("lamination_g"):"yes"==b.$parent.params[a][d.currentSide].laminationType&&"matted"==b.$parent.params[a][d.currentSide].laminationSurface&&(g=b.visualizationDownloadQueue.getResult("lamination_m"));var h=new createjs.Bitmap(g);return h.x=240,h.y=60,c.addChild(h),c},j=function(a){var b=new createjs.Text(a,"italic 10px Arial","black");return b.x=10,b.y=10,b},k=function(a,b,c){var d=0;"bottom"==c&&(d=30);var e=a.getBounds(),f=Math.cos((90-Math.abs(b))*Math.PI/180)*(e.width-d);a.y=a.y-2*f},l=function(a,b){var c=a.getBounds(),d=Math.cos(Math.abs(b)*Math.PI/180)*c.width,e=a.x+c.width-d,f=Math.cos((90-Math.abs(b))*Math.PI/180)*c.width,g=a.y+f;a.x=e,a.y=g},m=function(a,b){var c=a.getBounds(),d=Math.cos(Math.abs(b)*Math.PI/180)*c.width,e=a.x+d,f=Math.cos((90-Math.abs(b))*Math.PI/180)*c.width,g=a.y-f;a.x=e,a.y=g},n=function(a,b){var c=a.getBounds(),d=Math.cos(Math.abs(b)*Math.PI/180)*c.width,e=a.x-d,f=Math.cos((90-Math.abs(b))*Math.PI/180)*c.width,g=a.y+f;a.x=e,a.y=g},o=function(a,b){var c=new createjs.Text("","italic 14px Arial","black");return"front"==b?(c.x=10,c.y=10):(c.x=a.getBounds().width,c.y=10),c},p=function(a,c,d,e){var f=function(b){return"front"==d?a.getBounds().width-20-5*b:5*b+15},g=function(b,c){var d=new createjs.Shape;return d.graphics.beginFill(b).drawRect(f(c),0,5,a.getBounds().height),d},h=new createjs.Container,i=0;return"screen"!=b.$parent.params.block.printingType?(c.K&&(i+=1,h.addChild(g("black",i))),c.Y&&(i+=1,h.addChild(g("yellow",i))),c.M&&(i+=1,h.addChild(g("magenta",i))),c.C&&(i+=1,h.addChild(g("cyan",i)))):e.forEach(function(a){i+=1;var b=a.id.split("|");h.addChild(g(b[1],i))}),h},q=function(a,b,c,d,e){var f=new createjs.Shape,g="#d9d9d9";return"front"!=c&&(g="#a9a9a9"),null!=e&&(g=e),f.graphics.beginStroke("black").beginFill(g).drawRoundRectComplex(0,0,a,b,"front"==c?d[1]?15:0:d[2]?15:0,"front"==c?d[2]?15:0:d[1]?15:0,"front"==c?d[3]?15:0:d[4]?15:0,"front"==c?d[4]?15:0:d[3]?15:0),f.setBounds(0,0,a,b),f},r=function(a,c,d){var e=a.getBounds(),f=new createjs.Container;if("top"==c){f.x=e.x,f.y=e.y-10;var g=e.width}else if("right"==c){f.x=e.x+e.width+20,f.y=e.y+e.height,f.rotation=-90;var g=e.height}else if("bottom"==c){f.x=e.x,f.y=e.y+e.height+20;var g=e.width}else if("left"==c){f.x=e.x-10,f.y=e.y+e.height,f.rotation=-90;var g=e.height}if(d){var h=new createjs.Text(d.toString(),"italic 14px Arial","black");h.x=g/2-4*d.toString().length,h.y=-20}var i=new createjs.Shape;i.graphics.beginStroke("black").setStrokeStyle(.5).beginFill("black").drawRect(0,0,g,0),i.alpha=1;var j=new createjs.Bitmap(b.visualizationDownloadQueue.getResult("arrow"));j.scaleX=.5,j.scaleY=.5,j.regX=j.image.width/2,j.regY=j.image.width/2,j.x=g,j.y=0,j.rotation=-90;var k=new createjs.Bitmap(b.visualizationDownloadQueue.getResult("arrow"));return k.scaleX=.5,k.scaleY=.5,k.regX=k.image.width/2,k.regY=k.image.width/2,k.rotation=90,k.x=0,k.y=0,g<=k.image.width&&(k.x=g+k.image.width/4,j.x=-j.image.width/4),f.addChild(h),f.addChild(i),f.addChild(k),f.addChild(j),f},s=function(a,b,c,d,e,g,h,i,k,l,m,n,s,t,u,v){var w=new createjs.Container;w.x=d,w.y=e,w.skewX=g,w.skewY=h;var x=q(a*c,b*c,n,k,t);if(w.addChild(x),i.forEach(function(c){var d=r(x,c,"top"==c||"bottom"==c?a:b);w.addChild(d)}),null!=l){var y=p(x,l,n,m);w.addChild(y)}if(null!=u){var z=j(u);w.addChild(z)}if(2==s){var A=o(x,n);w.addChild(A)}if(null!=v){var B=f(x,v,c);w.addChild(B)}return w},t=function(){var a=b.$parent.params.formatWidth,c=b.$parent.params.formatHeight,f=new createjs.Container,j=function(){b.helpCanvasStage.removeAllChildren(),b.helpCanvasStage.update()},o=function(){if(e){var j=!0;if(null!=b.$parent.currentProduct()&&null!=b.helpCanvasStage.canvas){if("singlepage"==b.$parent.currentProduct().type)if(j&&"booklet_1"==b.$parent.currentProduct().slug){var o=90/Math.max(c,a),p=90,q=70,r=5,t=20,u=s(a,c,o,p,q,0,"front"==b.currentSide?t:-t,["bottom","left"],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),v=s(a,c,o,p,q,0,"front"==b.currentSide?-t:t,[],b.iframeCorners,"front"==b.currentSide?b.$parent.params.block[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.block[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.block.print);m(v,t),"front"==b.currentSide&&k(u,t,"bottom"),f.addChild(u),f.addChild(v)}else if(!j||"eurobooklet"!=b.$parent.currentProduct().slug||"changeProductContent"!=d.activeIframeTab&&"generalOptionsContent"!=d.activeIframeTab){if(j&&"eurobooklet"==b.$parent.currentProduct().slug&&"blockOptionsContent"==d.activeIframeTab){var w=90/Math.max(c,a),x=30,y=s(a,c,w,b.helpCanvasStage.canvas.width/2-a*w/2,x,0,-20,[],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print);n(y,-20);var z=s(a,c,w,b.helpCanvasStage.canvas.width/2-a*w/2,x,0,0,["top"],{1:b.iframeCorners[2],2:b.iframeCorners[1],3:b.iframeCorners[4],4:b.iframeCorners[3]},null,null,b.currentSide,b.$parent.params.block.print),A=s(a,c,w,b.helpCanvasStage.canvas.width/2-a*w/2+a*w,x,0,20,["right"],b.iframeCorners,"front"==b.currentSide?b.$parent.params.block[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.block[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.block.print);f.addChild(y),f.addChild(z),f.addChild(A)}else if(j&&("changeProductContent"==d.activeIframeTab||"generalOptionsContent"==d.activeIframeTab||"blockOptionsContent"==d.activeIframeTab)){var B=150/Math.max(c,a),C=s(a,c,B,b.helpCanvasStage.canvas.width/2-a*B/2,b.helpCanvasStage.canvas.height/2-c*B/2,0,0,["top","left"],b.iframeCorners,"changeProductContent"==d.activeIframeTab||"generalOptionsContent"==d.activeIframeTab?null:b.$parent.params.block[b.currentSide].chromaticity,"changeProductContent"==d.activeIframeTab||"generalOptionsContent"==d.activeIframeTab?null:b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print);f.addChild(C)}}else{var w=130/Math.max(c,a),x=30,z=s(a,c,w,b.helpCanvasStage.canvas.width/2-a*w/2,x,0,0,["top","left"],{1:b.iframeCorners[2],2:b.iframeCorners[1],3:b.iframeCorners[4],4:b.iframeCorners[3]},null,null,"front"==b.currentSide?"back":"front",b.$parent.params.block.print),y=s(a,c,w,b.helpCanvasStage.canvas.width/2-a*w/2,x,0,65,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),A=s(a,c,w,b.helpCanvasStage.canvas.width/2-a*w/2,x,0,-65,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print);l(A,-65),"front"==b.currentSide?(f.addChild(z),f.addChild(y),f.addChild(A)):(f.addChild(A),f.addChild(y),f.addChild(z))}else if("multipage"==b.$parent.currentProduct().type)if(j&&("booklet_spring"==b.$parent.currentProduct().slug||j&&"notebook_spring"==b.$parent.currentProduct().slug)&&("coverOptionsContent"==d.activeIframeTab||"padOptionsContent"==d.activeIframeTab)){var o=130/Math.max(c,a),p=110,q=50,t=20;if("coverOptionsContent"==d.activeIframeTab){var u=s(a,c,o,p-5,q,0,0,["top","left"],b.iframeCorners,b.$parent.params.cover[b.currentSide].chromaticity,b.$parent.params.cover[b.currentSide].screenColors,b.currentSide,b.$parent.params.cover.print,null,null,{position:"front"==b.currentSide?"right":"left",value:5});f.addChild(u)}if("padOptionsContent"==d.activeIframeTab){var v=s(a,c,o,p+5,q,0,0,["top","left"],b.iframeCorners,b.$parent.params.pad[b.currentSide].chromaticity,b.$parent.params.pad[b.currentSide].screenColors,b.currentSide,b.$parent.params.pad.print,null,null,{position:"front"==b.currentSide?"left":"right",value:5});f.addChild(v)}}else if(j&&("booklet_spring"==b.$parent.currentProduct().slug||j&&"notebook_spring"==b.$parent.currentProduct().slug)&&"blockOptionsContent"==d.activeIframeTab){var D=130/Math.max(c,a),E=100,F=10,G=s(a,c,D,"front"==b.currentSide?E-10:E+20,F+80,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print,null,null,{position:"front"==b.currentSide?"left":"right",value:7}),H=s(a,c,D,"front"==b.currentSide?E:E+10,F+70,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),I=s(a,c,D,"front"==b.currentSide?E+10:E,F+60,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),J=s(a,c,D,"front"==b.currentSide?E+20:E-10,F+50,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print);f.addChild(J),f.addChild(I),f.addChild(H),f.addChild(G)}else if(j&&("booklet_spring"==b.$parent.currentProduct().slug||j&&"notebook_spring"==b.$parent.currentProduct().slug)&&("changeProductContent"==d.activeIframeTab||"generalOptionsContent"==d.activeIframeTab)&&"portrait"==b.$parent.params.orientation){var D=90/Math.max(c,a),K=110,L=60,E=180,F=0;if(b.secTabs.cover.enabled)var M=s(a,c,D,K-10,L+20,0,20,b.secTabs.pad.enabled?["left"]:["left","top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Обложка",{position:"left",value:5});if(b.secTabs.pad.enabled)var N=s(a,c,D,K,L,0,-20,b.secTabs.cover.enabled?["top"]:["top","left"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Подложка",{position:"left",value:5});var G=s(a,c,D,E-5,F+75,0,0,b.secTabs.cover.enabled?[]:b.secTabs.pad.enabled?[]:["left"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,null,"Блок",{position:"left",value:5}),H=s(a,c,D,E,F+70,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),I=s(a,c,D,E+5,F+65,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),J=s(a,c,D,E+10,F+60,0,0,b.secTabs.pad.enabled||b.secTabs.cover.enabled?[]:["top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print);b.secTabs.pad.enabled&&f.addChild(N),f.addChild(J),f.addChild(I),f.addChild(H),f.addChild(G),b.secTabs.cover.enabled&&f.addChild(M);var O=g();O.rotation=90,O.x=b.secTabs.cover.enabled?70:b.secTabs.pad.enabled?75:135,O.y=90,f.addChild(O)}else if(j&&("booklet_spring"==b.$parent.currentProduct().slug||j&&"notebook_spring"==b.$parent.currentProduct().slug)&&("changeProductContent"==d.activeIframeTab||"generalOptionsContent"==d.activeIframeTab)&&"landscape"==b.$parent.params.orientation){var D=90/Math.max(c,a),K=130,L=40,F=60;if(b.secTabs.cover.enabled)var M=s(a,c,D,K-10,L+20,20,0,b.secTabs.pad.enabled?["left"]:["left","top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Обложка",{position:"top",value:5});if(b.secTabs.pad.enabled)var N=s(a,c,D,K,L,-20,0,b.secTabs.cover.enabled?["top"]:["right","top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Подложка",{position:"top",value:5});var G=s(a,c,D,K-5,F+75,0,0,b.secTabs.cover.enabled||b.secTabs.pad.enabled?[]:["left"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,null,"Блок",{position:"top",value:5}),H=s(a,c,D,K,F+70,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),I=s(a,c,D,K+5,F+65,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),J=s(a,c,D,K+10,F+60,0,0,b.secTabs.cover.enabled||b.secTabs.pad.enabled?[]:["top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print);b.secTabs.pad.enabled&&f.addChild(N),f.addChild(J),f.addChild(I),f.addChild(H),f.addChild(G),b.secTabs.cover.enabled&&f.addChild(M);var O=g();O.y=b.secTabs.pad.enabled?0:b.secTabs.cover.enabled?15:70,f.addChild(O)}else if(!j||"changeProductContent"!=d.activeIframeTab&&"generalOptionsContent"!=d.activeIframeTab||"booklet_brace"!=b.$parent.currentProduct().slug&&"copybook"!=b.$parent.currentProduct().slug||"landscape"!=b.$parent.params.orientation)if(!j||"coverOptionsContent"!=d.activeIframeTab||"booklet_brace"!=b.$parent.currentProduct().slug&&"copybook"!=b.$parent.currentProduct().slug)if(!j||"blockOptionsContent"!=d.activeIframeTab||"booklet_brace"!=b.$parent.currentProduct().slug&&"copybook"!=b.$parent.currentProduct().slug)if(!j||"changeProductContent"!=d.activeIframeTab&&"generalOptionsContent"!=d.activeIframeTab||"booklet_brace"!=b.$parent.currentProduct().slug&&"copybook"!=b.$parent.currentProduct().slug||"portrait"!=b.$parent.params.orientation)if(j&&"booklet_hotmelt"==b.$parent.currentProduct().slug&&"blockOptionsContent"==d.activeIframeTab){var D=130/Math.max(c,a),E=100,F=10,G=s(a,c,D,"front"==b.currentSide?E-10:E+20,F+80,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),H=s(a,c,D,"front"==b.currentSide?E:E+10,F+70,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),I=s(a,c,D,"front"==b.currentSide?E+10:E,F+60,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),J=s(a,c,D,"front"==b.currentSide?E+20:E-10,F+50,0,0,[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print);f.addChild(J),f.addChild(I),f.addChild(H),f.addChild(G)}else if(!j||"booklet_hotmelt"!=b.$parent.currentProduct().slug||"changeProductContent"!=d.activeIframeTab&&"generalOptionsContent"!=d.activeIframeTab||"landscape"!=b.$parent.params.orientation)if(!j||"booklet_hotmelt"!=b.$parent.currentProduct().slug||"changeProductContent"!=d.activeIframeTab&&"generalOptionsContent"!=d.activeIframeTab||"portrait"!=b.$parent.params.orientation){if(j&&"booklet_hotmelt"==b.$parent.currentProduct().slug&&"coverOptionsContent"==d.activeIframeTab){var o=90/Math.max(c,a),p=90,q=70,t=20,u=s(a,c,o,p-5,q,0,"front"==b.currentSide?t:-t,["bottom","left"],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.cover[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.cover[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),v=s(a,c,o,p+5,q,0,"front"==b.currentSide?-t:t,[],b.iframeCorners,"front"==b.currentSide?b.$parent.params.cover[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.cover[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.block.print);m(v,t),"front"==b.currentSide&&k(u,t,"bottom");var z=s(30,c,o,v.x-30*o,v.y,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"front"==b.currentSide?null:"#efd334");f.addChild(u),f.addChild(v),f.addChild(z)}else if(j&&"kubarik"==b.$parent.currentProduct().slug){var P=100/Math.max(c,a),Q=130,R=100;if("landscape"==b.$parent.params.orientation){var S=s(c,50/P,P,Q-Math.cos(60*Math.PI/180)*c*P-3,R+Math.cos(30*Math.PI/180)*c*P-50,0,-60,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#efd334");f.addChild(S)}else{var S=s(a,50/P,P,Q+5,R-50,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#efd334");f.addChild(S)}for(var T=0;T<10;T++){var S=s(a,c,P,Q,R-5*T,30,0,9==T?["top","left"]:[],b.iframeCorners,b.$parent.params.block[b.currentSide].chromaticity,b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print);f.addChild(S)}}}else{var D=90/Math.max(c,a),K=110,L=60,E=180,F=0,M=s(a,c,D,K-10,L+20,0,20,["left"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Обложка"),U=new createjs.Shape;U.graphics.setStrokeStyle(1),U.graphics.beginStroke("black"),U.graphics.beginFill("black"),U.graphics.lineTo(-10,20),U.graphics.lineTo(0,40),U.graphics.lineTo(0,0),U.graphics.endFill(),U.graphics.endStroke(),U.alpha=.9,U.x=K,U.y=L;var N=s(a,c,D,K,L,0,-20,["top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9"),G=s(a,c,D,E-5,F+75,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,null,"Блок"),H=s(a,c,D,E,F+70,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),I=s(a,c,D,E+5,F+65,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),J=s(a,c,D,E+10,F+60,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print);f.addChild(N),f.addChild(U),f.addChild(J),f.addChild(I),f.addChild(H),f.addChild(G),f.addChild(M)}else{var D=90/Math.max(c,a),K=130,L=40,F=60,M=s(a,c,D,K-10,L+20,20,0,["top","left"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Обложка"),N=s(a,c,D,K,L+30,-20,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9"),G=s(a,c,D,K-5,F+75,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,null,"Блок"),H=s(a,c,D,K,F+70,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),I=s(a,c,D,K+5,F+65,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),J=s(a,c,D,K+10,F+60,0,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),U=new createjs.Shape;U.graphics.moveTo(0,30),U.graphics.setStrokeStyle(1),U.graphics.beginStroke("black"),U.graphics.beginFill("black"),U.graphics.lineTo(-10,20),U.graphics.lineTo(-30,30),U.graphics.lineTo(0,30),U.graphics.endFill(),U.graphics.endStroke(),U.alpha=.9,U.x=K+a*D,U.y=L,f.addChild(U),f.addChild(N),f.addChild(J),f.addChild(I),f.addChild(H),f.addChild(G),f.addChild(M)}else{var V=100/Math.max(c,a),W=50,X=-25,Y=10,K=70,Z=130,$=140,_=150,aa=160;if(b.secTabs.cover.enabled)var ba=s(a,c,V,K,W,0,X,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9"),ca=s(a,c,V,K,W,0,Y,["left","bottom"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Обложка");var da=s(a,c,V,Z,W,0,X,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ea=s(a,c,V,Z,W,0,Y,b.secTabs.cover.enabled?[]:["left","bottom"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,null,"Блок"),fa=s(a,c,V,$,W,0,X,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ga=s(a,c,V,$,W,0,Y,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ha=s(a,c,V,_,W,0,X,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ia=s(a,c,V,_,W,0,Y,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ja=s(a,c,V,aa,W,0,X,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ka=s(a,c,V,aa,W,0,Y,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print);b.secTabs.cover.enabled&&f.addChild(ba),f.addChild(da),f.addChild(fa),f.addChild(ha),f.addChild(ja),f.addChild(ka),f.addChild(ia),f.addChild(ga),f.addChild(ea),b.secTabs.cover.enabled&&f.addChild(ca);var la=h();b.secTabs.cover.enabled||(la.x=60),f.addChild(la)}else{var o=90/Math.max(c,a),p=90,q=70,r=5,t=20,u=s(a,c,o,p,q,0,"front"==b.currentSide?t:-t,["bottom","left"],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),v=s(a,c,o,p,q,0,"front"==b.currentSide?-t:t,[],b.iframeCorners,"front"==b.currentSide?b.$parent.params.block[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.block[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.block.print);m(v,t),"front"==b.currentSide&&k(u,t,"bottom");var ma=s(a,c,o,p+r,q-r,0,"front"==b.currentSide?t:-t,[],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),na=s(a,c,o,p+r,q-r,0,"front"==b.currentSide?-t:t,[],b.iframeCorners,"front"==b.currentSide?b.$parent.params.block[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.block[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.block.print);m(na,t),"front"==b.currentSide&&k(ma,t);var oa=s(a,c,o,p+2*r,q-2*r,0,"front"==b.currentSide?t:-t,[],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),pa=s(a,c,o,p+2*r,q-2*r,0,"front"==b.currentSide?-t:t,[],b.iframeCorners,"front"==b.currentSide?b.$parent.params.block[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.block[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.block.print);
m(pa,t),"front"==b.currentSide&&k(oa,t);var qa=s(a,c,o,p+3*r,q-3*r,0,"front"==b.currentSide?t:-t,[],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.block[b.currentSide].screenColors,b.currentSide,b.$parent.params.block.print),ra=s(a,c,o,p+3*r,q-3*r,0,"front"==b.currentSide?-t:t,[],b.iframeCorners,"front"==b.currentSide?b.$parent.params.block[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.block[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.block.print);m(ra,t),"front"==b.currentSide&&k(qa,t),f.addChild(qa),f.addChild(ra),f.addChild(oa),f.addChild(pa),f.addChild(ma),f.addChild(na),f.addChild(u),f.addChild(v)}else{var o=90/Math.max(c,a),p=90,q=70,r=5,t=20,u=s(a,c,o,p,q,0,"front"==b.currentSide?t:-t,["bottom","left"],b.iframeCorners,"front"==b.currentSide?null:b.$parent.params.cover[b.currentSide].chromaticity,"front"==b.currentSide?null:b.$parent.params.cover[b.currentSide].screenColors,b.currentSide,b.$parent.params.cover.print),v=s(a,c,o,p,q,0,"front"==b.currentSide?-t:t,[],b.iframeCorners,"front"==b.currentSide?b.$parent.params.cover[b.currentSide].chromaticity:null,"front"==b.currentSide?b.$parent.params.cover[b.currentSide].screenColors:null,b.currentSide,b.$parent.params.cover.print);m(v,t),"front"==b.currentSide&&k(u,t,"bottom"),f.addChild(u),f.addChild(v)}else{var V=100/Math.max(c,a),W=120,X=-25,Y=10,K=50,E=90,Z=E+10,$=E+20,_=E+30,aa=E+40;if(b.secTabs.cover.enabled)var ba=s(a,c,V,W,K,X,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9"),ca=s(a,c,V,W,K,Y,0,["left","top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,"#f9f9f9","Обложка");var da=s(a,c,V,W,Z,X,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ea=s(a,c,V,W,Z,Y,0,b.secTabs.cover.enabled?[]:["left","top"],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print,null,"Блок"),fa=s(a,c,V,W,$,X,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ga=s(a,c,V,W,$,Y,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ha=s(a,c,V,W,_,X,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ia=s(a,c,V,W,_,Y,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ja=s(a,c,V,W,aa,X,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print),ka=s(a,c,V,W,aa,Y,0,[],b.iframeCorners,null,null,b.currentSide,b.$parent.params.block.print);b.secTabs.cover.enabled&&f.addChild(ba),f.addChild(da),f.addChild(fa),f.addChild(ha),f.addChild(ja),f.addChild(ka),f.addChild(ia),f.addChild(ga),f.addChild(ea),b.secTabs.cover.enabled&&f.addChild(ca);var la=h();la.rotation=90,la.x=255,la.y=b.secTabs.cover.enabled?-10:40,f.addChild(la)}if(j&&("blockOptionsContent"==d.activeIframeTab||"coverOptionsContent"==d.activeIframeTab||"padOptionsContent"==d.activeIframeTab)){var sa=i();b.helpCanvasStage.addChild(sa)}}var ta=function(a,c){c.x=(b.helpCanvasStage.canvas.width-a.width)/2-a.x,c.y=(b.helpCanvasStage.canvas.height-a.height)/2-a.y,c.scaleX=.95*c.scaleX,c.scaleY=.95*c.scaleY},ua=function(a){var c=a.getBounds();return c.x+c.width>=b.helpCanvasStage.canvas.width||c.x<=0||c.y+c.height>=b.helpCanvasStage.canvas.height||c.y<=0};null!=f.getBounds()&&ua(f)&&ta(f.getBounds(),f),b.helpCanvasStage.addChild(f),b.helpCanvasStage.update()}};j(),o()},u=function(a){e=!0},v=function(a){};this.init=function(){e=!1,d.iframeDataCache={},b.helpCanvasStage=new createjs.Stage(c),b.visualizationDownloadQueue=new createjs.LoadQueue(!0),b.visualizationDownloadManifest=[{src:"blackhole.png",id:"blackhole"},{src:"whitehole.png",id:"whitehole"},{src:"corner.png",id:"corner"},{src:"arrow.png",id:"arrow"},{src:"varnish_uf.png",id:"varnish_uf"},{src:"varnish_vd.png",id:"varnish_vd"},{src:"varnish_of.png",id:"varnish_of"},{src:"lamination_m.png",id:"lamination_m"},{src:"lamination_g.png",id:"lamination_g"},{src:"simplebrace.png",id:"simplebrace"},{src:"filebrace.png",id:"filebrace"},{src:"spring.png",id:"spring"}],b.visualizationDownloadQueue.on("complete",u),b.visualizationDownloadQueue.on("progress",v),b.visualizationDownloadQueue.loadManifest(b.visualizationDownloadManifest,!0,"/static/img/calculator/"),this.applyProductChanges=t,d.currentSide="front"},this.setScope=function(a){b=a},this.setCanvas=function(a){c=a},this.setRootScope=function(a){d=a}}]),angular.module("PrintlerCalculator").service("$wideprint",["$promiseUtils","$httpQueue","urls",function(a,b,c){function d(a){var b=_.cloneDeep(a);return b.product.block.cringles.customLocation.step&&(b.product.block.cringles.customLocation.step=parseInt(b.product.block.cringles.customLocation.step)),"custom"!==a.product.block.cringles.type&&(b.product.block=_.omit(b.product.block,"pockets"),b.product.block.cringles=_.omit(b.product.block.cringles,"customLocation")),"custom"===a.product.block.cringles.type&&_.isEmpty(a.product.block.pockets.location)&&(b.product.block=_.omit(b.product.block,"pockets")),"custom"===a.product.block.cringles.type&&_.isEmpty(a.product.block.cringles.customLocation.location)&&(b.product.block=_.omit(b.product.block,"cringles")),"no"===a.product.block.cringles.type&&(b.product.block=_.omit(b.product.block,"pockets"),b.product.block=_.omit(b.product.block,"cringles")),b}var e=new a.OncePromise("http"),f=new a.OncePromise("http"),g=new a.OncePromise(function(a){return{purposes:_.keys(a.data),resolutions:a.data}}),h=function(a){return a.data};this.getWideprintDefaults=function(a){return b.getOnce(e,a,"/wideprint/settings")},this.calculateWideprint=function(e){return b.get("wideprint",c["wide-calculate-ajax"],{params:{order:d(e)}}).then(function(b){return _.has(b.data,"total_cost")?b.data:a.fail(b.data)},function(b){return a.fail({data:["Ошибка сервера"],status:b.status})})},this.getMaterialTypes=function(a){return b.getOnce(f,a,c.wide_get_material_types)},this.getResolutions=function(a){return b.getOnce(g,a,c.wide_get_resolutions)},this.purposes=function(){return _.result(g.result(),"purposes")},this.resolutions=function(){return _.result(g.result(),"resolutions")},this.getLightTransmission=function(a){return b.get("ltrans",c.wide_get_light_transmission,{params:{material_type:a},cached:!0}).then(h)},this.getSurfaces=function(a,d){return b.get("wsurfaces",c.wide_get_surface,{params:{material_type:a,light_transmission:d},cached:!0}).then(h)},this.getDensities=function(d,e,f){return d?b.get("wide-densities",c.wide_get_densities,{params:{material_type:d,surface:f,light_transmission:e},cached:!0}).then(h):a.result([])}}]),angular.module("PrintlerCalculator").value("$calculators",{}),angular.module("CalculatorOrders").config(["WidgetUserRestangularProvider",function(a){a.withConfig(function(a){a.setBaseUrl("/widget"),a.setDefaultHeaders({Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-Api-Key":API_KEY}),a.setRequestSuffix("/")})}]),angular.module("CalculatorOrders").run(["WidgetUserRestangular","terms","delivery","$shoppingCart",function(a,b,c,d){a.one("term_options").get("").then(function(a){b.data=a.plain()}).catch(function(){b.data=[]}),a.one("delivery_options").get("").then(function(a){c.data=a.plain()}).catch(function(){c.data=[]})}]),angular.module("CalculatorOrders").factory("Product",["$http","httpOptions",function(a,b){var c=function(a){return this.calculation_id=void 0,this.params={},this.secTabs={},this.pid=void 0,this.calcResult={},this.files=[],this.slug=void 0,this.isLoading=!1,this.watcher=void 0,a&&_.merge(this,a),this};c.prototype.Create=function(c){return a.post("/widget/orders/",{calc_data:c||this.calculation_id,term_option:this.term_option},b).then(d.bind(this))},c.prototype.Update=function(c,e,f){var g={};return g[c]=e,this.isLoading=!0,a.patch("/widget/orders/"+this.id+"/",g,b).then(function(a){d.call(this,a,f)}.bind(this))},c.prototype.Remove=function(){return a.delete("/widget/orders/"+this.id+"/",b)},c.prototype.DeleteFile=function(c){var d,e;return d=_.map(this.files,function(a){return a.id}),d&&(e=_.indexOf(d,c.id)),this.files.splice(e,1),a.post("/widget/orders/"+this.id+"/delete_maquette/",{id:c.id},b)},c.prototype.Term=function(){return _.find(this.terms,function(a){return this.term_option==a.id}.bind(this))};var d=function(a,b){return _.merge(this,b||{},a.data),this.isLoading=!1,this};return c}]),angular.module("CalculatorOrders").factory("SummaryTerms",["terms","$filter",function(a,b){var c=function(a,b){this.init=d.bind(this),this.init(a,b)};c.prototype.setMargins=function(a){_.each(this.products,function(b,c){a?b.term_option=this.term_array[a]?this.term_array[a][c]:void 0:b.term_option=k(b.terms,this.max)}.bind(this))},c.prototype.create=function(){this.term_array={},_.each(this.days,function(a){this.term_array[a]=[],_.each(this.products,function(b){var c=_.findWhere(b.terms,{term:a});this.term_array[a].push(c?c.id:k(b.terms,a))}.bind(this))}.bind(this))},c.prototype.getTermByID=function(b){return _.find(a.data,function(a){return a.id==b})},c.prototype.getProductTermByDay=function(a,b){for(var c=0;this.products[c].id!=a.id;)c++;return this.getTermByID(this.term_array[b][c])},c.prototype.getMargin=function(){var a=_.chain(this.products).map(function(a){return this.getTermByID(a.term_option)}.bind(this)).compact().max(function(a){return a.term}).value();return a?a.term:void 0};var d=function(a,b){this.options=_.extend({if_lamination:0,if_uf:0,on_circulation:0,on_circulation_incrase_term_to:0,on_weight:0,on_weight_increase_margin_to:0},b||{}),this.products=a,this.days=[],this.term_array={},_.each(a,f.bind(this)),this.min=j.call(this,"min"),this.max=j.call(this,"max"),e.call(this),this.create()},e=function(){this.days=_.chain(this.products).map(function(a){return a.terms}).flatten().map(function(a){return a.term>=this.min?a.term:void 0}.bind(this)).compact().uniq(!1).sortBy().value()},f=function(c){c.terms=_.cloneDeep(b("termsbyslug")(a.data,c.slug||c.calc_data.form_data.product_slug)),c.terms=_.chain(c.terms).groupBy("term").map(function(a){return _.min(a,function(a){return a.margin})}).each(function(a){a.term+=g.call(this,c)+h.call(this,c)+i.call(this,c)}.bind(this)).value()},g=function(a){var b=_.chain(a.calc_data.form_data).keys().filter(function(a){return 0==a.indexOf("varnishing")}).some(function(b){return"uff"==a.calc_data.form_data[b]}).value();return b?this.options.if_uf:0},h=function(a){var b=_.chain(a.calc_data.form_data).keys().filter(function(a){return 0==a.indexOf("lamination")}).some(function(b){return""!=a.calc_data.form_data[b]&&"no"!=a.calc_data.form_data[b]}).value();return b?this.options.if_lamination:0},i=function(a){return a.calc_data.tech_card.circulation>this.options.on_circulation?this.options.on_circulation_incrase_term_to:0},j=function(a){return _.chain(this.products).map(function(b){return _[a](b.terms,function(a){return a.term}).term}).max().value()},k=function(a,b){return _.chain(a).filter(function(a){return a.term<=b}).max(function(a){return a.term}).value().id};return c}]),angular.module("CalculatorOrders").filter("termsbyslug",function(){var a={singlepage:["blank","visiting_card","stamping_product","leaflet","sticker","postcard","print_sheet","poster","flyer","label"],folded:["booklet_1","eurobooklet","booklet_3"],hotmelt:["booklet_hotmelt"],spring_binded:["notebook_spring","booklet_spring"],brace_binded:["booklet_brace","copybook"],kubarik:["kubarik"]};return function(b,c){return _.filter(b,function(b){var d=a[b.product_type];return d&&_.contains(d,c)})}}),function(){var a,b={},c=function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(!a){p.headers["X-Api-Key"]=API_KEY,a=c.withConfig(b),a.addElementTransformer("client",!1,d),a.addElementTransformer("contacts",e),a.addElementTransformer("contacts",_.partial(f,a)),a.addElementTransformer("multi_orders",g),a.addElementTransformer("details",_.partial(h,a)),a.addElementTransformer("details",i),a.addElementTransformer("communications",_.partial(j,a)),a.addElementTransformer("communications",k),a.addElementTransformer("delivery_addresses",_.partial(l,a)),a.addElementTransformer("delivery_addresses",m),a.setParentless(["contacts","multi_orders","details","communications","delivery_addresses","client"]),a.addElementTransformer("orders",n),a.login=function(b,c){return a.isLoggingIn=!0,a.one("login").post("",{email:b,password:c}).then(function(b){var c=b.plain();return p.headers.Authorization="Token "+c.Token,a.setDefaultHeaders(p.headers),$.cookie("client_id",a.user.id),$.cookie("client_token",a.user.token),r(c)}).catch(s).finally(function(){a.isLoggingIn=!1})},a.logout=function(){return a.one("logout").get().then(function(a){return delete p.headers.Authorization,a}).finally(t)},a.register=function(b){return a.isLoggingIn=!0,a.one("client").post("register",b).catch(s).finally(function(){a.isLoggingIn=!1})},a.checkAuth=function(b){return a.isLoggingIn=!0,p.headers.Authorization="Token "+(b||$.cookie("client_token")),a.setDefaultHeaders(p.headers),a.one("client").get().then(r,t).finally(function(){a.isLoggingIn=!1})},a.apiKey=null,a.loggedIn=!1,a.isLoggingIn=!1,a.loginHasFailed=!1,a.user={},a.errors={},a.init=function(){return a.apiKey=API_KEY,a.checkAuth()},a.changeParams=function(b){return self.errors={},a.one("client").patch(b).catch(function(b){return a.errors=b.data,q.reject()})},a.changePassword=function(b,c){return a.one("set_password").post("",{password:b,password2:c})},a.defaultDetail=function(){if(a.user.details&&0!=a.user.details.length){var b=_.findWhere(a.user.details,{is_default:!0});return b?b:_.first(a.user.details)}};var r=function(b){return a.user=a.restangularizeElement("",b,"client"),a.errors={},q.all([a.user.load_contacts(),a.user.load_details(),a.user.load_delivery_addresses(),a.user.load_multi_orders()]).then(function(){return a.user}).catch(function(b){return a.errors.loadData="Не удалось загрузить все данные",q.reject(b)}).finally(function(){a.loggedIn=!0})},s=function(b){return a.loginHasFailed=!0,a.errors=b.data,q.reject(b.data)},t=function(){a.apiKey=null,a.loggedIn=!1,a.isLoggingIn=!1,a.loginHasFailed=!1,a.user={},a.errors={},$.removeCookie("client_id"),$.removeCookie("client_token")}}return a};angular.module("CalculatorOrders").provider("WidgetUserRestangular",function(){return{withConfig:function(a){b=a},$get:["Restangular","Client","ClientContact","ClientContacts","ClientMultiOrderes","ClientDetails","ClientDetail","ClientCommunications","ClientCommunication","ClientDeliveryAddresses","ClientDeliveryAddress","Order","$http","httpOptions","$q",c]}})}(),angular.module("CalculatorOrders").service("$shoppingCart",["$http","terms","delivery","$filter","$q","WidgetUserRestangular","Product","httpOptions","SummaryTerms",function(a,b,c,d,e,f,g,h,i){this.products=[],this.delivery_option=c.data.length>0?_.first(c.data):void 0,this.delivery_address=null,this.client_comment="",this.client=f,this.detail=void 0,this.contact=void 0,this.terms=new i(this.products),this.onlineOptions={},this.Add=function(a){var b=new g(a);return this.products.push(b),b.Create().then(function(){return this.terms.init(this.products,this.onlineOptions),k.call(this),e.all(_.map(this.products,function(a){return a.Update("term_option",a.term_option)}))}.bind(this)).catch(function(a){return this.products.splice(this.products.length-1,1),e.reject(a)}.bind(this))},this.Remove=function(a){var a="number"==typeof a?this.products[a].id:a;return a.Remove().then(function(){this.products.splice(_.indexOf(this.products,function(b){return b.id==a.id}),1)}.bind(this))},this.FindBy=function(a){return _.find(this.products,function(b){return b.id==a})},this.Create=function(){return a.post("/widget/multi_orders/",j.call(this),h)},this.createClient=function(a){return f.register(a).then(function(){return f.login(a)})},this.Clear=function(){this.products.splice(0,this.products.length)},this.initDelivery=function(){if(this.delivery_option)return _.find(c.data,function(a){return a.id==this.delivery_option}.bind(this));var a=_.first(c.data);return this.delivery_option=a?a.id:void 0,a},this.date=function(){var a=_.max(_.map(this.products,function(a){return new Date(a.date_ready)}));return this.products.length>0?a.toLocaleDateString():""},this.productsCost=function(){var a=_.reduce(this.products,function(a,b){return a+b.total_cost},0)||0;return Math.round(a||0)},this.totalCost=function(a){var b=0,d=_.findWhere(c.data,{id:this.delivery_option});return b+=this.productsCost(),b=b*(100-(this.client.user.discount||0))/100,b+=d?d.cost:0,d&&"delivery"==d.delivery_type&&this.totalWeight()>a.on_weight&&(b+=a.on_weight_increase_margin_to),Math.round(b||0)},this.totalTermCost=function(){return _.reduce(this.products,function(a,b){return a+b.primary_cost*b.Term().margin/100},0)},this.termCostBy=function(a){return _.reduce(this.products,function(b,c){return this.terms.getProductTermByDay(c,a).margin*c.primary_cost/100+b}.bind(this),0)},this.totalWeight=function(){return _.reduce(this.products,function(a,b){return a+b.calc_data.tech_card.weight_circulation},0)},this.contactStr=function(a){var b=_.pick(a,"name","email","phone","skype","other");return _.reduce(b,function(a,b,c){return a+(b&&""!=b?b+" ":"")},"")},this.setContact=function(){if(this.client.loggedIn&&0!=this.client.user.contacts.length){var a=_.findWhere(this.client.user.contacts,{is_default:!0});a?this.contact=a.id:this.contact=_.first(this.client.user.contacts).id}else this.contact=void 0},this.deliveryAddress=function(){var a=this.initDelivery();if("take_away"==a.delivery_type)return" ("+a.to+")";var b=_.find(f.user.delivery_addresses,function(a){return this.delivery_address==a.id}.bind(this));return b?" ("+a.to+". "+b.address+")":""};var j=function(){return{orders:_.pluck(this.products,"id"),delivery_option:this.delivery_option,delivery_address:this.delivery_address,client:f.user.id,client_comment:this.client_comment,detail:this.detail,contact:this.contact}},k=function(){this.terms.setMargins(),this.day=this.terms.max}}]),angular.module("CalculatorOrders").value("terms",{data:[]}).value("delivery",{data:[]}).value("httpOptions",{headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"}}),angular.module("PrintlerUtils").controller("DemoFileUploadController",["$scope",function(a){var b=$("#api_key").val(),c=$("#maq_origin").val();a.options={url:"/maquettes/upload/",acceptFileTypes:/(\.|\/)(jpe?g|pdf|cdr|ai|psd|tiff|eps?)$/i,maxFileSize:1e8,autoUpload:!0,sequentialUploads:!0},a.queue=void 0===a.queue?[]:a.queue,a.$on("fileuploadprocessalways",function(a,b){b.files[b.index]}),a.$on("fileuploadsubmit",function(a,d){d.formData={api_key:b},c?(d.formData.maq_origin=c,d.formData.maq_type="prepress"):d.formData.maq_type="origin"}),a.$watch("is_files_reload",function(){a.queue=void 0===a.$parent.queue?[]:a.$parent.queue})}]).controller("RevisedMaquetteUploadController",["$scope",function(a){var b=$("#printhouse-api-key").val();a.get_url=function(){return"/maquettes/upload/?string_id="+a.string_id},a.options={url:"/maquettes/upload/",acceptFileTypes:/(\.|\/)(jpe?g|pdf|cdr|ai|psd|tiff|eps?)$/i,maxFileSize:1e8,autoUpload:!0,sequentialUploads:!0},a.queue=void 0===a.queue?[]:a.queue,a.set_string_id=function(b){a.string_id=b},a.$on("fileuploadsubmit",function(c,d){d.formData={api_key:b},d.formData.string_id=a.string_id,d.formData.maq_type="revised"})}]).controller("MaquetteInfoController",["$scope",function(a){a.messages={upload:"Загрузите макет для автоматической предварительной проверки.<br>Вы можете пропустить этот шаг, и согласовать макет с нами позже напрямую.",error:"<b>Макет не подходит к параметрам вашего изделия!</b><br>Ошибки указаны ниже.<br>Наведите на них для получения подробной иформации.<br>Вы можете проигнорировать ошибки и продолжить, наши специалисты свяжутся с Вами в ходе ручной правки макетов.",ok:"Похоже, что макет в порядке."},a.tooltips={pages_error:"Количество страниц из файлов, что вы загрузили, не совпадает с количеством страниц из ТЗ.",ratio_error:"Размеры страниц из файлов, что вы загрузили, не пропорциональны размеру изделия из ТЗ.",pages_ok:"Количество страниц из файлов, что вы загрузили, совпадает с количеством страниц из ТЗ.",ratio_ok:"Размеры страниц из загруженных файлов корректны."},a.curTooltip=null,a.errorMessage=function(){return a.curTooltip?a.tooltips[a.curTooltip]:a.messages.error},a.setTooltip=function(b,c){a.curTooltip=b+(c?"_ok":"_error")}}]).controller("FileDestroyController",["$scope","$http","$calculatorState",function(a,b,c){var d,e=a.file;e.$state=function(){return d},e.$destroy=function(){return d="pending",b({url:e.deleteUrl,method:e.deleteType}).then(function(){d="resolved",a.clear(e)},function(){d="rejected"})},e.$cancel||e._index||(e.$cancel=function(){a.clear(e)}),c.on(function(b){"working.pending.productInit"==b&&_.map(a.queue,function(b){a.clear(b)})})}]),angular.module("PrintlerUtils").directive("angularBootstrapSwitch",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d&&(d.$render=function(){b.val(d.$viewValue)},b.on("switchChange.bootstrapSwitch",function(b,c){a.$apply(function(){d.$setViewValue(c)})}))}}}),angular.module("PrintlerUtils").directive("applyUniform",["$timeout","$parse",function(a,b){return{restrict:"A",require:"ngModel",link:function(c,d,e,f){function g(){a(function(){$.uniform.update(d)},0)}d.uniform({useID:!1}),c.$watch(function(){return f.$modelValue},g),void 0!==e.ngDisabled&&c.$watch(b(e.ngDisabled),g),void 0!==e.ngValue&&c.$watch(b(e.ngValue),g)}}}]),angular.module("PrintlerUtils").directive("arrayInput",function(){return{templateUrl:"views/directives/arrayInput.html",scope:{arrayName:"@",manager:"@",argumentLabel:"@",measure:"@",model:"="},link:function(a,b,c){var d=function(b){if(_.isNumber(b))if(b>a.array.length){var c=_.times(b-a.array.length,function(){return""});a.array=a.array.concat(c)}else b<a.array.length&&(a.array=_.take(a.array,b))};a.array=JSON.parse(c.array),a.manager?$(document).on("change","#id_"+a.manager,function(){var b=$(this),c=parseInt(b.val());a.$apply(_.partial(d,c))}):a.model&&a.$watch("model",d)}}}),angular.module("PrintlerUtils").directive("confirmClick",function(){return{restrict:"A",scope:{action:"&confirmClick",message:"@"},link:function(a,b,c){b.bind("click",function(b){var c=a.message?a.message:"Точно хотите удалить?";window.confirm(c)&&a.$apply(a.$eval(a.action))})}}}),angular.module("PrintlerUtils").directive("datepickerPopup",function(){return{restrict:"EAC",require:"ngModel",link:function(a,b,c,d){d.$formatters.shift()}}}),angular.module("PrintlerUtils").directive("dependOn",function(){return function(a,b,c){var d=c.dependOn.split(","),e=function(){_.some(d,function(a){return $("#"+a).prop("checked")})?b.show():b.hide()};_.each(d,function(a){$("#"+a).on("change",e)}),e()}}),angular.module("PrintlerUtils").directive("detalization",["$filter",function(a){return{templateUrl:"views/directives/detalization.html",restrict:"E",scope:{name:"=",detail:"="},link:function(b,c,d){var e=a("paramValue");b.$watch("detail",function(){b.detail&&(b.title="",b.detail.title?b.title=b.detail.title:b.detail.machine?b.title=e(b.detail.machine,"machine"):b.detail.material?b.title=e(b.detail.material,"material"):b.detail.count?b.title=e(b.detail.count,"forms"):b.detail.blade_length&&(b.title=b.detail.blade_length),b.cost=b.detail.cost||b.detail.printing_cost,b.cost=e(b.cost?b.cost:"0.00","cost"),b.details=_.omit(b.detail,"title","cost","printing_cost","machine","material","count","blade_length","article"),_.keys(b.details).length>0&&(b.details.machine=b.detail.machine,b.title="Стоимость"))})}}}]),angular.module("PrintlerUtils").directive("dictInput",function(){return{templateUrl:"views/directives/dictInput.html",scope:{dictName:"@",manager:"@"},link:function(a,b,c){a.dictArray=_.pairs(JSON.parse(c.dict)),$(document).on("change","#id_"+a.manager,function(){var b=$(this),c=parseInt(b.val());a.$apply(function(){if(_.isNumber(c)){var b=a.dictArray.length;if(c>b){var d=_.times(c-b,function(){return["",""]});a.dictArray=a.dictArray.concat(d)}else c<b&&(a.dictArray=_.take(a.dictArray,c))}})})}}}),angular.module("PrintlerUtils").directive("drawChart",function(){return{restrict:"EA",template:"<div></div>",scope:{dataset:"=",options:"=",callback:"="},link:function(a,b,c){var d=null;a.dataset=a.dataset||[],a.options=a.options||{legend:{show:!1}};var e=$(b.children()[0]);e.css({width:c.width||"100%",height:c.height||"100%"});var f=function(){var b=$.plot(e,a.dataset,a.options);return a.callback&&a.callback(b),b},g=function(a){return d?(d.setData(a),d.setupGrid(),d.draw()):d=f()};a.$watch("dataset",g,!0),a.$watch("options",function(){return d=f()},!0)}}}),angular.module("PrintlerUtils").directive("dynamicName",["$parse",function(a){return{restrict:"A",priority:500,controller:["$scope","$element","$attrs",function(b,c,d){var e=a(d.dynamicName)(b);delete d.dynamicName,c.removeAttr("data-dynamic-name"),c.removeAttr("dynamic-name"),d.$set("name",e)}]}}]),angular.module("Printler").directive("fSelect",function(){return{restrict:"A",link:function(a,b){var c=b.find("select"),d=null;b.click(function(a){$(a.target).not("li")&&(b.hasClass("open")?b.removeClass("open"):b.addClass("open"))}).mouseleave(function(){d=setTimeout(function(){b.removeClass("open")},1500)}).mouseenter(function(){clearTimeout(d)}),b.on("click","li",function(a){a.stopPropagation(),b.removeClass("open");var d=$(this).data("value");c.val(d).change()})}}}),angular.module("PrintlerUtils").directive("factor",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){var e=c.factor;if(e&&d&&"false"!=e){d.$formatters.push(function(a){return+(a/e).toFixed(2)}),d.$parsers.push(function(a){return(c.factorMin||0==c.factorMin)&&f(a*e),c.factorMax&&g(a*e),a*e});var f=function(b){if(!_.isNumber(b))return b;var e=a.$eval(c.factorMin)||0;return b<e?d.$setValidity("factorMin",!1):d.$setValidity("factorMin",!0),b},g=function(b){if(!_.isNumber(b))return b;var e=a.$eval(c.factorMax)||1/0;b>e?d.$setValidity("factorMax",!1):d.$setValidity("factorMax",!0)}}}}}),angular.module("Printler").directive("focusWhen",function(){return{link:function(a,b,c){a.$watch(c.focusWhen,function(a){a&&b.focus()})}}}),angular.module("Printler").directive("followHoveredElement",function(){return function(a,b,c){$("body").on({mouseenter:function(){var c=$(this);b.offset({top:c.offset().top}),a.$apply(function(){a.setTip(c.children("td").first().children("span").html())})},mouseleave:function(){b.offset({top:b.parent().offset().top}),a.$apply(function(){a.setTip(a.defaultTip)})}},c.followHoveredElement)}}),angular.module("PrintlerUtils").directive("formFocus",function(a){return{link:function(a,b,c){a.$on("openform_"+c.name,function(){b.find("input, select, textarea")[0].focus()})}}}),angular.module("PrintlerUtils").directive("integerModel",function(){return{require:"?ngModel",link:function(a,b,c,d){function e(){d.$setViewValue(parseInt(b.val()))}d.$render=function(){b.val(d.$viewValue.toString())},b.on("blur keyup change",function(){a.$evalAsync(e)}),e()}}}),angular.module("PrintlerUtils").directive("ionRangeSlider",["$timeout",function(a){return{templateUrl:"views/directives/ionRangeSlider.html",restrict:"E",scope:{sliderName:"@name",min:"=",max:"=",value:"=",settings:"@"},link:function(b,c,d){var e=function(){a(function(){var a=$('ion-range-slider[name="'+b.sliderName+'"] span.irs-single')[0];$('ion-range-slider[name="'+b.sliderName+'"] .btn-ion-range-separate').css("left",a.offsetLeft+(a.offsetWidth||30)+1+"px")},0)},f=!1,g=_.extend(JSON.parse(b.settings),{from:b.value,min:b.min,max:b.max,step:1,onChange:function(a){f=!0,b.value=a.from,b.$apply()},onFinish:function(a){f=!1},prettify:function(a){return e(),a}}),h=c.children("input").first();h.ionRangeSlider(g);var i=h.data("ionRangeSlider");b.$watch("min",function(a){i.update({min:a,from:b.value}),e()}),b.$watch("max",function(a){i.update({max:a,from:b.value}),e()}),b.$watch("value",function(a){f||i.update({from:a})}),b.separateRange=function(){b.$parent.separateRange(b.$parent.$index)}}}}]),angular.module("PrintlerUtils").directive("laminators",function(){return{restrict:"A",link:function(a,b,c){var d=b.find(".form-group:gt(0)");a.laminators=[],a.add_laminat=function(){a.laminat.show=!0},a.delete_laminator=function(c){a.laminators[c].show=!1;var d=b.find(".form-group:eq("+(c+1)+")");d.find("input:first").val(""),d.find("input:last").val("")},$.each(d,function(b,c){var d=$(c).find(".control-label").text(),e=$(c).find("input:first").val(),f=$(c).find("input:last").val(),g=$(c).find("input:first").attr("id").split("_");g=g[3]+g[2];var h={name:d,show:""!=e&&""!=f,id:g};a.laminators.push(h)})}}}),angular.module("PrintlerUtils").directive("inputMask",function(){return{require:"ngModel",scope:{inputMask:"="},link:function(a,b,c,d){b.inputmask(_.extend({oncomplete:function(){d.$setValidity("mask",!0),a.$apply()},oncleared:function(){d.$setPristine(),d.$setValidity("mask",!0),a.$apply()}},a.inputMask)).on("input",function(){d.$setDirty(),d.$setValidity("mask",!1),d.$setViewValue(b.val()),a.$apply()})}}}).service("inputmask",function(){this.innIP={mask:"9",repeat:12},this.innUR={mask:"9",repeat:10},this.phone={mask:"+7 (999) 999-99-99"},this.kpp={mask:"9",repeat:9},this.rs={mask:"999-99-999-9-9999-9999999"},this.bic={mask:"049999999"},this.ogrnIP={mask:"9",repeat:15},this.ogrnUR={mask:"9",repeat:13},this.ks={mask:"9",repeat:20},this.isValid=$.inputmask.isValid,this.format=$.inputmask.format}),angular.module("PrintlerUtils").directive("multiRangeInput",["Range","scopeUtils","$compile","$timeout",function(a,b,c,d){return{templateUrl:"views/directives/multiRangeInput.html",transclude:!0,scope:{rangeName:"@",helpText:"@",measure:"@",measureBound:"@",boundsMeasure:"@",valuesRequired:"=",lowerBound:"@",upperBound:"@",tip:"@"},link:function(e,f,g,h,i){var j=function(a){var b=angular.element(e[a+"Bound"]),d=b.val();b.attr("ng-model",a),c(b)(e),e[a]=parseFloat(d)};j("lower"),j("upper"),$('.open-range[range-name="'+e.rangeName+'"]').on("click",function(){f.find("#modal_"+e.rangeName).modal("show")});var k=angular.element(e.upperBound);k.val();k.attr("ng-model","upper"),c(k)(e),b.bindToParent("rangeModel",g.rangeModel,e);var l=e.range=new a(e.rangeModel,!0,!0,!0);if(l.last().end===1/0)throw new a.Error("Infinite bounds are not allowed for multiranges");var m=e.slist=_.pluck(l.data(),"begin");e.$watch("lower",function(b){var c=parseFloat(b);if(!_.isNumber(c)||c<0||c>parseFloat(e.upper))throw new a.Error("Mess with lower and upper multirange bounds");$(".lower-"+e.rangeName).text(c);var d=l.getIndex(c);d>-1&&(l.deleteAll(0,d-1),m.splice(0,d)),l.first().begin=c,m[0]=Math.max(c,m[0])}),e.$watch("upper",function(b){var c=parseFloat(b);if($(".upper-"+e.rangeName).text(c),!_.isNumber(c)||c<parseFloat(e.lower))throw new a.Error("Mess with lower and upper multirange bounds");var d=l.getIndex(c);d>-1&&(l.deleteAll(d+1),m.splice(d+1)),l.last().end=c,m[m.length-1]=Math.min(c,m[m.length-1])}),e.separateRange=function(a){l.separate(a,m[a]),m.splice(a,1,l.get(a).begin,l.get(a+1).begin),$(".tooltip").remove(),d(function(){$(".tooltips").tooltip()},0)},e.mergeRanges=function(a){l.delete(a),m.splice(a,1),$(".tooltip").remove(),d(function(){$(".tooltips").tooltip()},0)},i()}}}]),angular.module("Printler").controller("MultiRangeModalController",["$scope",function(a){a.init=function(b){a=a.$parent}}]),angular.module("PrintlerUtils").directive("ngWith",["scopeUtils",function(a){function b(a){return"("==a||"["==a||"{"==a}function c(a){return")"==a||"]"==a||"}"==a}function d(a){for(var d=-1,e=0,f=[],g=0;g<a.length;g++)b(a[g])?e++:c(a[g])?e--:","==a[g]&&0==e&&(f.push(a.substring(d+1,g)),d=g);return f.push(a.substring(d+1)),f}return{scope:!0,link:function(b,c,e){var f=d(e.ngWith);_.each(f,function(c){var d=c.split(" as ");a.bindToParent(d[1],d[0],b)})}}}]),angular.module("PrintlerUtils").directive("numericInput",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(a){return parseFloat(a);
})}}}),angular.module("PrintlerUtils").directive("objectList",["$parse","$geolocation","scopeUtils",function(a,b,c){return{restrict:"E",templateUrl:"views/directives/objectList.html",scope:{itemTitle:"@",listName:"@",max:"@",min:"@",listFields:"=fields",listFieldsOrder:"=fieldsOrder",hints:"=",factors:"="},link:function(a,d,e){if(a.fields="string"==typeof a.listFields?JSON.parse(a.listFields):a.listFields,a.fieldsOrder="string"==typeof a.listFieldsOrder?JSON.parse(a.listFieldsOrder):a.listFieldsOrder,c.bindToParent("list",e.list,a),a.addItem=function(){function b(a){return"hidden"==a.type?_.cloneDeep(a.default)||"":""}if(!a.list||!a.max||a.list.length!==a.max){var c=_.object(_.map(_.filter(_.pairs(a.fields),function(a){return"annotation"!=a[1].type}),function(a){return[a[0],b(a[1])]}));a.list||(a.list=[]),a.list.push(c)}},a.removeItem=function(b){a.list.length!==a.min&&a.list.splice(b,1)},a.list.length<parseInt(a.min)){a.list=[];for(var f=0;f<a.min;++f)a.addItem()}a.getLocation=b.getLocation}}}]),angular.module("PrintlerUtils").directive("ordersMaquetteDownload",["toastr",function(a){return{templateUrl:"views/directives/ordersDownload.html",scope:{product:"=ordersMaquetteDownload",downloadClick:"&",url:"@",headers:"="},link:function(b,c,d){var e=["pdf","jpg","ai","cdr","tiff","psd"];b.formats=e.join(", "),e=_.map(e,function(a){return"jpg"==a?"jpe?g":a}),b.options={url:b.url,acceptFileTypes:new RegExp("(.|/)("+e.join("|")+"?)$","i"),maxFileSize:1e8,autoUpload:!0,sequentialUploads:!0,headers:b.headers},b.$on("fileuploadadd",function(a,c){b.downloadClick()}),b.$on("fileuploadprocessfail",function(b,c){a.error("Формат файла не поддерживается"),f(c.files)}),b.$on("fileuploadfail",function(b,c){a.error("Ошибка при загрузке файлов, попробуйте еще раз"),f(c.files)}),b.$on("fileuploaddone",function(a,c){b.product.files.push({id:c.result.id,path:c.result.maquette,name:c.files[0].name})});var f=function(a){b.$$childHead.clear(a)}}}}]),angular.module("PrintlerUtils").directive("rangeInput",["Range","scopeUtils",function(a,b){return{templateUrl:"views/directives/rangeInput.html",scope:{rangeName:"@",helpText:"@",measure:"@",boundsMeasure:"@",valuesRequired:"=",tip:"@",factors:"&"},link:function(c,d,e){b.bindToParent("rangeData",e.rangeModel,c),c.factors=c.factors()||{bounds:1,value:1},_.isNull(c.rangeData)&&(c.rangeData=[{begin:c.factors.bounds,end:1/0,value:null}]);var f=c.range=new a(c.rangeData,!1,!1,!0);c.isLast=function(a){return a===f.size()-1},c.addRange=function(){f.pushBack(),c.lastFocused=!0},c.getMaxEnd=function(a){return a==f.size()-1?f.isRightFixed()?f.last().end:1/0:f.get(a+1).end-1}}}}]),angular.module("PrintlerUtils").directive("savingForm",function(){var a=function(a){return parseFloat(a.replace(",","."))},b=function(b){b.find("[input-factor]").each(function(b,c){var d=$(c).attr("input-factor");if("false"!=d){var d=a(d),e=$(c).find("input");e.val(a(e.val())/d)}})},c=function(b){b.find("[input-factor]").each(function(b,c){var d=$(c).attr("input-factor");if("false"!=d){var d=a(d),e=$(c).find("input");e.val(a(e.val())*d)}})};return function(a,d,e){var f=e.name;b(d),d.state_form({onChange:function(){a[f].$setDirty()}}),d.on("submit",function(){c(d),a[f].$setPristine()}),window.onbeforeunload=function(){if(a[f].$dirty)return"Не сохранённые данные будут потеряны."}}}).directive("buttonWithoutSavingForm",function(){return function(a,b,c){b.on("click",function(){window.onbeforeunload=null})}}),angular.module("PrintlerUtils").directive("smartInput",["$timeout",function(a){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){d.$render=function(){b.val(d.$modelValue),b.select2({tags:d.$modelValue,maximumInputLength:20}),b.select2("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){b.select2("onSortStart")},update:function(){b.select2("onSortEnd")}})},b.on("change",function(){d.$setViewValue(b.val().split(","))})}}}]),angular.module("PrintlerUtils").directive("stopBubbling",function(){return function(a,b,c){b.on("click",function(a){a.stopPropagation()})}}),angular.module("PrintlerUtils").directive("updateWith",function(){return{require:"ngModel",scope:{model:"=ngModel",bind:"&updateWith"},link:function(a){a.$watch(a.bind,function(b){""!=b&&(a.model=angular.copy(b))},!0)}}}),angular.module("PrintlerUtils").factory("Interpolation",["Matrices",function(a){function b(a){return h=a.parameters,i=a.price_values,j=h.length,c(0),c(0),{parameters:h,price_values:i}}function c(a){if(a==j)return void d();for(var b=0;b<h[a].values.length;b++)k.push(b),c(a+1),k.pop()}function d(){var b=a.getValue(i,k);if(!b.fixed)for(var c=0;c<k.length;c++){for(var d,e=_.clone(k),f=_.clone(k);e[c]>=0&&(d=a.getValue(i,e),0==d.value);)e[c]-=1;if(!(e[c]<0)){for(;f[c]<h[c].values.length&&(d=a.getValue(i,f),0==d.value);)f[c]+=1;if(f[c]!=h[c].values.length){var j=a.getValue(i,e).value,l=a.getValue(i,f).value,m=g(h[c].values[e[c]],j,h[c].values[f[c]],l,h[c].values[k[c]]);if(0==m&&(m=g(e[c],j,f[c],l,k[c])),m>0)return void a.modifyValue(i,k,function(a){return a.fixed=!1,a.value=m,a})}}}}function e(a){return _.isFinite(a)&&a%1!=0}function f(a){return Number.isInteger(a)||e(a)?a:-1}function g(a,b,c,d,e){return e=f(e),a=f(a),c=f(c),e==-1||a==-1||c==-1?0:e>=c?d:e<=a?b:parseInt(b+(d-b)/(c-a)*(e-a))}var h,i,j,k=[];return{run:b}}]),angular.module("PrintlerUtils").factory("Matrices",function(){function a(b){if(b<2)return[];for(var c=[],d=0;d<b-1;d++)c.push([d,b-1]);return a(b-1).concat(c)}function b(a,c){var d=c[0];if(1===a)return _.times(d,Math.random);var e=_.tail(c);return _.times(d,function(c){return b(a-1,e)})}function c(a){return!_.isArray(a)||_.isEmpty(a)?0:c(a[0])+1}function d(a){if(!_.isArray(a))return[];var b=Math.floor(Math.random()*(a.length-1));return[b].concat(d(a[b]))}function e(a){return n(a,d(a))}function f(a,b){return _.isArray(a[0])?_.chain(a).map(_.partial(f,_,b)).filter(_.negate(_.isEmpty)).value():_.filter(a,b)}function g(a,b){function c(a,b,d){return _.isArray(a[0])?_.map(a,function(e,f){return c(a[f],b,d.concat([f]))}):_.map(a,function(a,c){return b(a,d.concat([c]))})}return c(a,b,[])}function h(a,b){return 0===b?a.length:h(a[0],b-1)}function i(a,b){return _.isArray(a)?_.sum(_.map(a,_.partial(i,_,b))):~~b(a)}function j(a,b,d){function e(a){for(var c=[],d=0,e=0;e<a;e++)e!=b[d]?c.push(e):d++;return c}function f(a,c,e,g){return _.isArray(a)?b[e]!=c?f(a[_.head(g)],c+1,e,_.tail(g)):f(a[d[e]],c+1,e+1,g):a}function g(b,c){var d=_.head(b),e=h(a,d),f=[];if(1==b.length)for(var i=0;i<e;i++)f.push(j(c.concat([i])));else for(var k=_.tail(b),i=0;i<e;i++)f.push(g(k,c.concat([i])));return f}if(_.isEmpty(b))return a;b=_.sortBy(b);var i=c(a),j=_.partial(f,a,0,0),k=e(i);return g(k,[])}function k(a,b){function c(a){return function(){return _.cloneDeep(a)}}if(!_.isArray(a[0])){for(var d=0;d<a.length;d++)a[d]=_.times(b,c(a[d]));return a}for(var d=0;d<a.length;d++)a[d]=k(a[d],b);return a}function l(a,b){if(!_.isArray(a))throw new Error("Cannot delete not existing or only level");if(b<=0)return a[0];for(var c=0;c<a.length;c++)a[c]=l(a[c],b-1);return a}function m(a,b,c,d){if(b<0||!_.isArray(a))throw new Error("Incorrect layer number");return 0===b?(d=_.isUndefined(d)?function(){return _.cloneDeep(_.last(a))}:d,_.resize(a,c,d)):_.map(a,function(a){return m(a,b-1,c,d)})}function n(a,b){if(_.isEmpty(b))return a;if(!_.isArray(a))throw new Error("Invalid index list");return n(a[_.head(b)],_.tail(b))}function o(a,b,c){return p(a,b,function(a){return a=c})}function p(a,b,c){if(_.isEmpty(b))return a=c(a);if(!_.isArray(a))throw new Error("Invalid index list");var d=_.head(b);return a[d]=p(a[d],_.tail(b),c),a}function q(a){if(!_.isArray(a))return Lazy([[]]);var b=q(a[0]),c=b.map(function(a){return[0].concat(a)});if(1==a.length)return c;var d=b.map(function(b){return[a.length-1].concat(b)});return d.reduce(function(a,b){return a.concat([b])},c)}var r=_.partialRight(i,_.constant(!0));return{getLayer:j,allPairsToN:a,randomMatrix:b,getDimension:c,getLayerLength:h,getSize:r,countValues:i,appendLevel:k,deleteLevel:l,resizeLayer:m,getRandomPoint:d,getRandomValue:e,filterMatrix:f,mapMatrix:g,getValue:n,setValue:o,modifyValue:p,getCorners:q}}),angular.module("PrintlerUtils").factory("$promiseUtils",["$q",function(a){function b(a){var b=this,d=null,f=null,g=!1;"http"===a?this.transformer=function(a){return a.data}:this.transformer=a||_.identity,this.resolveOnce=function(a,h){return null!==d?c(d):((null==f||g)&&(g=!1,f=a.apply(null,h).finally(function(){g=!0})),e(f,function(a){return d=b.transformer(a),c(d)}))},this.result=function(){return d}}var c=function(b){var c=a.defer();return c.resolve(b),c.promise},d=function(b){var c=a.defer();return c.reject(b),c.promise},e=function(a,b){return a.then(b)},f=function(a){if(0==a.length)return c([]);var b=_.head(a),d=_.tail(a);return e(b,function(a){return e(f(d),function(b){return c([a].concat(b))})})},g=function(a){return function(){return e(f(Array.prototype.slice.call(arguments)),function(b){return c(a.apply(null,b))})}},h=function(b){var c=_.drop(arguments),d=a.defer();return _.defer(function(){try{d.resolve(b.apply(null,c))}catch(a){d.reject(a)}}),d.promise},i=function(b){var d={};return function(){var e=Array.prototype.slice.call(arguments);JSON.stringify(e);return d[e]?c(d[e]):d[e]=b.apply(null,e).then(function(a){return d[e]=null,a},function(b){return d[e]=void 0,a.reject(b)})}};return{result:c,fail:d,bind:e,sequence:f,liftP:g,runAsync:h,throttle:i,OncePromise:b}}]),angular.module("PrintlerUtils").factory("Range",function(){function a(a){this.name="RangeError",this.message=a}function b(b,d,e,f){function g(a){return _.isArray(a)&&_.every(a,function(a){return _.isPlainObject(a)&&a.hasOwnProperty("begin")&&_.isNumber(a.begin)&&a.hasOwnProperty("end")&&_.isNumber(a.end)&&a.hasOwnProperty("value")})}function h(a){if(a[0].begin>a[0].end)return!1;for(var b=1;b<a.length;b++)if(a[b].begin!=a[b-1].end+1||a[b].begin>a[b].end)return!1;return!0}function i(a){return g(a)&&h(a)}function j(a){a.watch("end",function(a,b,d){return!this[c]&&this.next&&b!==d&&_.isNumber(d)&&(this[c]=!0,this.next.begin=d+1,this[c]=!1),d}),a.watch("begin",function(a,b,d){return!this[c]&&this.prev&&b!==d&&_.isNumber(d)&&(this[c]=!0,this.prev.end=d-1,this[c]=!1),d})}function k(a,b,d){var e={enumerable:!1,configurable:!1,writable:!0};Object.defineProperty(a,c,_.assign({},e,{value:!1})),Object.defineProperty(a,"prev",_.assign({},e,{value:b})),Object.defineProperty(a,"next",_.assign({},e,{value:d})),j(a)}function l(a,c){var d=b[a-1]||null,e=b[a]||null;k(c,d,e),_.set(d,"next",c),_.set(e,"prev",c),b.splice(a,0,c)}function m(a){var c=b[a].prev,d=b[a].next;return _.set(c,"next",d),_.set(d,"prev",c),b.splice(a,1)[0]}function n(b,c,d,e){if(!e&&!this.isInBounds(b,c))throw new a("separateRange(): invalid separating position");var f=this.get(b);d=d||_.cloneDeep(f.value);var g={begin:f.begin,end:c,value:f.value},h={begin:c+1||void 0,end:f.end,value:d};m(b),l(b,g),l(b+1,h)}if(!i(b))throw new a("constructor: invalid data");f||(b=_.cloneDeep(b));for(var o=0;o<b.length;o++){var p=b[o-1]||null,q=b[o+1]||null;k(b[o],p,q)}this.data=function(){return b},this.get=function(a){return b[a]},this.size=function(){return b.length},this.empty=function(){return 0===b.length},this.isLeftFixed=function(){return d},this.isRightFixed=function(){return e},this.first=_.partial(_.first,b),this.last=_.partial(_.last,b),this.leftBound=function(){return this.first().begin},this.rightBound=function(){return this.last().end},this.isInBounds=function(a,b){var c=this.get(a);return c.begin<=b&&c.end>b},this.isValid=_.partial(i,b),this.separate=function(a,b,c){return n.call(this,a,b,c,!1)},this.pushBack=function(a){var c=this.last();a=a||_.cloneDeep(c.value),e?n.call(this,b.length-1,void 0,a,!0):l(b.length,{begin:c.end+1,end:void 0,value:a})},this.delete=function(a){var c=this.size(),f=m(a);return 0===a&&d?this.first().begin=f.begin:a===c-1&&e?this.last().end=f.end:a>0&&a<b.length&&(b[a].begin=f.begin),f},this.deleteAll=function(a,c){_.isUndefined(c)&&(c=b.length-1);for(var d=a;d<=c;d++)this.delete(a)},this.popBack=function(){return this.delete(this.size()-1)},this.getIndex=function(c){if(!this.isValid())throw new a("trying to search position in invalid range");if(c<this.leftBound()||c>this.rightBound())return-1;var d,e=0,f=b.length-1;if(f===1/0&&(f-=1,c>=this.last().begin))return b.length-1;for(;e<f;){d=(e+f)/2|0;var g=this.get(d);if(g.begin<=c&&g.end>=c)return d;c<g.begin?f=d:e=d+1}return e},0===this.leftBound()&&(d=!0),this.rightBound()===1/0&&(e=!0)}var c="$$__PTRL_RANGE_CYCLE_WATCH_SYMBOL__$$";return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,b.Error=a,b}),angular.module("PrintlerUtils").factory("select2Printler",["$timeout",function(a){return function(b){var c=function(a,b){return b.replace("#{"+a+"}","").replace("#{/"+a+"}","")},d=function(a){var b={};return _.each(["id","hint","text"],function(d){var e=a.match(new RegExp("#\\{"+d+"\\}.*#\\{\\/"+d+"\\}"));e.length>0&&(b[d]=c(d,e[0]))}),b.text||(b.text=a),b},e=function(c,e,f){var g=d(e.text),h=b.attr("id");return g.hint&&c&&a(function(){$("[select2popover='"+c+h+g.id+"']").popover({content:g.hint,trigger:"hover",placement:"right",delay:0,animation:!1,container:"body"}),b.on("select2-close",function(){$(".popover").remove()}),$("[select2popover='"+c+h+g.id+"']").on("mouseleave",function(){$(".popover").remove()})},100),"<div select2popover='"+c+h+g.id+"'>"+g.text+"</div>"},f=_.partial(e,!0),g=_.partial(e,!1);this.options={minimumResultsForSearch:-1,formatResult:f,formatSelection:g}}}]),angular.module("PrintlerUtils").factory("$socket",["$rootScope",function(a){return function(b,c){var d,e={},f=function(a,b){e[a]&&e[a].fire(b)},g=function(a){var b=JSON.parse(a.data);f(b.event,b)};this.on=function(a,b){d&&(e[a]||(e[a]=$.Callbacks()),e[a].add(b))},this.off=function(a,b){d&&e[a]&&e[a].remove(b)},this.disconect=function(){d&&(d.close(),_.each(e,function(a,b){b instanceof $.Callbacks&&b.empty()}),a.$broadcast("disconectSocket"))};try{d=new SockJS(b),d.onopen=function(){d.send(c)},d.onmessage=g,a.$broadcast("initSocket")}catch(a){}}}]),angular.module("PrintlerUtils").factory("$imagePreloader",["$q","$rootScope",function(a,b){function c(b){this.imageLocations=b,this.images=[],this.imageCount=_.size(this.imageLocations),this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=a.defer(),this.promise=this.deferred.promise}return c.preloadImages=function(a){var b=new c(a);return b.load()},c.prototype={constructor:c,isInitiated:function(){return this.state!==this.states.PENDING},isRejected:function(){return this.state===this.states.REJECTED},isResolved:function(){return this.state===this.states.RESOLVED},load:function(){return this.isInitiated()?this.promise:(this.state=this.states.LOADING,_.each(this.imageLocations,this.loadImageLocation,this),this.promise)},handleImageError:function(a){this.errorCount++,this.isRejected()||(this.state=this.states.REJECTED,this.deferred.reject(a))},handleImageLoad:function(a){this.loadCount++,this.isRejected()||(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),image:a}),this.images.push(a),this.loadCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.images)))},loadImageLocation:function(a,c){var d=this,e=$(new Image).load(function(a){b.$apply(function(){d.handleImageLoad(a.target),d=e=a=null})}).error(function(a){b.$apply(function(){d.handleImageError(a.target),d=e=a=null})}).prop("src",a);$.data(e,"index",c)}},c}]),angular.module("PrintlerUtils").service("scopeUtils",["$rootScope","$parse",function(a,b){this.parseMore=function(a,c){var d=b(a),e=_.wrap(d,function(a,b,c){return c=_.merge({},c,{Infinity:1/0,NaN:NaN}),a(b,c)});return e.literal=d.literal,e.constant=d.constant,e.assign=d.assign,e},this.bindTwoWay=function(a,b,c,d){var e=this.parseMore(a),f=this.parseMore(c);_.isFunction(f.assign)&&(f.assign(d,e(b)),b.$watch(e,function(a){f.assign(d,a)},!0)),_.isFunction(e.assign)&&d.$watch(f,function(a){e.assign(b,a)},!0)},this.bindToParent=function(a,b,c){this.bindTwoWay(b,c.$parent,a,c)},this.pushFromParent=function(a,b){this.bindToParent(a,a,b)}}]),angular.module("PrintlerUtils").service("yesno",["$q","$modal",function(a,b){this.confirmation=function(a,c){return a=a||{},c=c||{},b.open({templateUrl:c.templateUrl||"views/helpers/yesno.html",controller:"YesNoController",backdrop:void 0===c.backdrop||c.backdrop,windowClass:(c.windowClass||"")+" yes-no-modal-content",size:c.size||"sm",resolve:{options:function(){return a}}}).result}}]).controller("YesNoController",["$scope","options","$modalInstance",function(a,b,c){a.options=b,a.params={},a.message=b.text||"Все несохранённые данные будут потеряны",a.yesbtn=void 0===b.yesbtn||b.yesbtn,a.nobtn=void 0===b.nobtn||b.nobtn,a.notext=void 0===b.notext||b.notext,a.yesbtntext=b.yesbtntext||"Да, я уверен",a.nobtntext=b.nobtntext||"Нет",a.yes=function(){c.close(_.isEmpty(a.params)?"yes":a.params)},a.no=function(){c.dismiss(_.isEmpty(a.params)?"close":a.params)}}]),angular.module("PrintlerFilters").filter("cut",["$filter",function(a){return function(a,b,c,d){if(!a)return"";if(c=parseInt(c,10),!c)return a;if(a.length<=c)return a;if(a=a.substr(0,c),b){var e=a.lastIndexOf(" ");e!=-1&&(a=a.substr(0,e))}return a+(d||" …")}}]),angular.module("PrintlerFilters").filter("dateFormat",["$filter",function(a){var b={just:"только что",minutes:["минута","минуты","минут"],hours:["час","часа","часов"],days:["день","дня","дней"],years:["год","года","лет"]},c=function(a,b){var c=a%100,d=a%10;return c>10&&c<20?b[2]:d>1&&d<5?b[1]:1==d?b[0]:b[2]},d=function(a,d){return a.toString()+" "+c(a,b[d])};return function(a){var c=new Date,e=(c-a)/1e3;if(e<60)return b.just;var f=e/60;if(f<60){var g=Math.floor(f);return d(g,"minutes")}var h=f/60;if(h<24){var i=Math.floor(h);return d(i,"hours")}var j=h/24;if(j<365){var k=Math.floor(j);return d(k,"days")}var l=j/365,m=Math.floor(l);return d(m,"years")}}]),angular.module("PrintlerFilters").filter("fileName",["$filter",function(a){return function(a,b){var c=a.split("/");if(c=c[c.length-1],c.length>b){var d=c.split(".");return d.length>1?c.substring(0,b)+"...."+d[d.length-1]:c.substring(0,b)+"..."}return c}}]),angular.module("PrintlerFilters").filter("filterKey",["$filter",function(a){return function(b,c){return _.pick(b,a("filter")(_.keys(b),c))}}]),angular.module("PrintlerFilters").filter("filterValue",["$filter",function(a){return function(b,c){var d=_.map(b,function(a,b){return{key:b,val:a}}),e=_.filter(d,function(b){return!_.isEmpty(a("filter")([b.val],c))});return _.pick(b,_.pluck(e,"key"))}}]),angular.module("PrintlerFilters").filter("i18n",function(){var a={general:{product:"Продукт",front:"Лицевая сторона",back:"Оборотная сторона",custom:"свой",other:"другая",block:"Блок",block1:"Блок (часть 1)",block2:"Блок (часть 2)",block3:"Блок (часть 3)",block4:"Блок (часть 4)",block5:"Блок (часть 5)",cover:"Обложка",pad:"Подложка",add_cover:"Добавить обложку",add_pad:"Добавить подложку",common:"Общее",C:"Cyan",M:"Magenta",Y:"Yellow",K:"blacK",no:"нет",yes:"да",counting:"Идет подсчет...",price_is:"Стоимость:",try_later:"Попробуйте позже",not_valid:"Проверьте правильность введенных данных",glossy:"Глянец",matted:"Мат",delivery:"Доставка",takeaway:"Самовывоз",take_away:"Самовывоз",portrait:"Сверху",landscape:"Сбоку",holes:{no:"нет",one:"отверстие",several:"отверстия",many:"отверстий"},corners:{no:"нет",one:"угол",several:"угла",many:"углов"},price:{one:"рубль",several:"рубля",many:"рублей"},items:{one:"штука",several:"штуки",many:"штук"},products:{one:"изделие",several:"изделия",many:"изделий"},days:{one:"день",several:"дня",many:"дней"},months:{one:"месяц",several:"месяца",many:"месяцев"},sms:{one:"сообщение",several:"сообщения",many:"сообщений"},maquette:{one:"макет",several:"макета",many:"макетов"},pages:{one:"страница",several:"страницы",many:"страниц"},maquette_pages:{one:"полоса",several:"полосы",many:"полос"},rpages:{one:"страницу",several:"страницы",many:"страниц"},colors:{no:"пустая",one:"цвет",several:"цвета",many:"цветов"},files:{one:"файл",several:"файла",many:"файлов"},orders:{one:"заказ",several:"заказа",many:"заказов"},clients:{one:"клиент показан",several:"клиента показано",many:"клиентов показано"}},calc_response:{product_part:"Часть изделия",paper_material:"Бумага (наименование)",in_format:"Формат исходный",out_format:"Формат требуемый",in_circulation:"Дано",out_circulation:"Получить",cuts_per_sheet:"Доля резки (количество ударов резака)",tech_waste:"Тех. отход",count_printing_sheets:"Разных печатных листов",itself:"Печать с/с",circulation:"Тираж",products_count:"Тираж",section_count:"Количество секций",brace_type:"Тип скобы",product_format:"Формат изделия",paper_format:"Формат листа",size_side_perforation:"Размер стороны перфорации",size_side_binding:"Размер стороны скрепления",color_spring:"Цвет пружины",step_spring:"Шаг пружины",count_in_packing:"Количество в упаковке",chrom:"Цветность л+о",forms_count:"Количество форм",allocation_matrix:"Раскладка",sides_count:"Количество сторон",surface:"Покрытие",laminate_type:"Тип ламината",roll:"Рулонный",batch:"Пакетный",laminate_material:"Ламинат (наименование)",screen_films:"Трафаретные пленки",varnish_material:"УФ-лак (наименование)",packing_count:"Количество упаковок",circulation_weight:"Вес тиража, кг",sheets_count:"Количество страниц",title_spring:"Пружина (наименование)",white:"белый",black:"черный",red:"красный",orange:"оранжевый",yellow:"желтый",green:"зеленый",blue:"голубой",purple:"пурпурный",simple:"обычная",file:"файловая",folding_count:"Количество фальцев",hit_counts:"Количество ударов",vd_varnishing_lo:"ВД-лак (л+о)",of_varnishing_lo:"Офсетный лак (л+о)","glossy+0":"глянц+0","matted+0":"мат+0","glossy+glossy":"глянц+глянц","matted+matted":"мат+мат",new:"Новый",from_client:"Заказчика",spreads_per_block:"Количество разворотов",printing:"Печать",spreads_distribution:"Распределение разворотов",combined_count:"Комбинированных фальцев",film:"Пленка",uf_varnish:"УФ-лак",products_on_stamp:"Продуктов на штампе",stamp_format:"Формат штампа",stamping:"Тиснение",foil:"Фольга",foil0:"Фольга",foil1:"Фольга",foil_stamping:"Тиснение фольгой",relief_stamping:"Конгревное тиснение",foil_relief_stamping:"Конгревное тиснение фольгой",blade:"Лезвие",stamp:"Штамп",forms:"Печатные формы",spring:"Пружина",loops_count:"Кол-во петель",spring_type:"Тип пружины",paint:"Краска и химия",paper:"Бумага",vd_varnish:"ВД-лак",of_varnish:"Офсетный лак",laminate:"Ламинат",cutting:"Резка",shape_cutting:"Вырубка",hotmelt_binding:"Скрепление на термоклей",pre_cutting:"Предварительная резка",folding:"Фальцовка",hand_folding:"Ручная фальцовка",lamination:"Ламинация",vd_varnishing:"ВД-лакирование",of_varnishing:"Офсетное лакирование",uf_varnishing:"УФ-лакирование",uff_varnishing:"Сплошное УФ-лакирование",ufp_varnishing:"Выборочное УФ-лакирование",sheet_counting:"Подсчет листов",selection:"Подбор",hand_selection:"Ручной подбор",hand_binding:"Ручное скрепление",spring_binding:"Скрепление на пружину",brace_binding:"Скрепление на скобу",pva_binding:"Скрепление на ПВА-клей",packing:"Упаковка",hand_creasing:"Ручная биговка",creasing:"Биговка",perforation:"Перфорация",boring:"Сверление",rounding_corners:"Скругление углов",cutting_sheet_format:"Формат листа",itself_printing:'Печать "само на себя"',trimming:"Подрезка",twin_cutting:"Резка двойника",piles_count:"Количество стопок",machine:"Машина",cost:"Стоимость",printing_cost:"Стоимость печати",printing_cost_src:"Расчетная стоимость печати",printing_time:"Время печати",fitting_printing_time:"Время приладки",spreads_on_sheet:"Разворотов на печатном листе",worksheet_runs:"Кол-во прогонов печатных листов",fitting_vd_time:"Время приладки ВД-лака",fitting_vd_cost:"Цена приладки ВД-лака",films:"Плёнка",roll_length:"Длина рулона",fitting_roll_length:"Длина рулона на приладку",Print:"Печать",FinalCut:"Финальная резка",Gluing:"Склейка",AddPockets:"Добавления карманов",AddCringlesCustom:"Добавление люверсов с пользовательскими настройками",AddCringlesCorners:"Добавление люверсов по углам",AddCringlesCornersCenter:"Добавление люверсов по углам и центру",CutCorners:"Подрезка углов",banner_cast:"баннер литой",banner_laminated:"баннер ламинированный",self_adhesive_transparent:"самоклейка прозрачная",self_adhesive_white:"самоклейка белая",self_adhesive_perforated:"самоклейка перфорированная",self_adhesive_transport:"самоклейка транспортная",paper_blue_back:"бумага Blue back",canvas_artificial:"холст натуральный",canvas_natural:"холст искусственный",spread_format:"формат разворота",count_spreads:"количество разворотов",orientation:"ориентация",products_on_width:"продуктов по ширине",product_on_height:"продуктов по высоте",material_width:"ширина рулона (мм)",resolution:"качество печати",type_of_cut:"тип резки",lapping:"нахлёст (мм)",gluing_type:"тип клея",pockets_diameter:"диаметр кармана",step:"шаг (мм)",cringles_white:"размер белого поля (мм)",fitting:"приладка",waste:"отход",width:"ширина (мм)",height:"высота (мм)",material:"материал",exact:"точная",fast:"быстрая",parallel:"параллельно",perpendicular:"перпендикулярно",solvent:"сольвентные",ecosolvent:"экосольвентные",water:"водные",pigment:"пигментные",latex:"латексные"},sides_short:{front:"Лицо",back:"Оборот"},printingTypes:{auto:"Авто-выбор",digital:"Цифровая",offset:"Офсетная",screen:"Трафаретная (шелкография)"},varnishing:{vd:"ВД-лак",of:"Офсетный лак",uff:"Сплошной УФ-лак",ufp:"Выборочный УФ-лак",no:"Без лака"},lamination:{glossy:"Глянец",matted:"Мат",no:"Без ламинации"},lamination_detailed:{glossy:"Глян. ламинат",matted:"Мат. ламинат",no:"Без ламинации"},hotstamping:{no:"Без тиснения",stamping:"Тиснение",foil_stamping:"Тиснение фольгой",relief_stamping:"Конгревное тиснение",foil_relief_stamping:"Конгревное тиснение с фольгой"},materials:{paper:"Мел. бумага",offset:"Офсет. бумага",carton:"Картон","self-adhesive":"Самоклейка",self_adhesive:"Самоклейка",carton_1:"1-стор. картон",carton_2:"2-стор. картон",design:"Дизайнерская бумага",permanent:"Постоянный",removable:"Съемный"},iframe_chromaticity:{4:"Полноцвет",1:"Черно-белая печать",0:"Дизайнерские настройки цвета",no:"Без печати"},chromaticity:{0:"другая"},color:{white:"белый",black:"черный",red:"красный",orange:"оранжевый",yellow:"желтый",green:"зеленый",blue:"голубой",purple:"пурпурный",gold:"золотой",silver:"серебряный",bronze:"бронзовый",holographic:"голографическая","":"другой"},purposes:{street:"Интерьерная печать",interior:"Широкоформатная печать"},qualitys:{360:"360dpi - эконом качество",720:"720dpi - стандарт качество",1080:"1080dpi - премиум-качество"},"wide-material-type":{banner_cast:"баннер литой",banner_laminated:"баннер ламинированный",self_adhesive_transparent:"самоклейка прозрачная",self_adhesive_white:"самоклейка белая",self_adhesive_perforated:"самоклейка перфорированная",self_adhesive_transport:"самоклейка транспортная",paper:"бумага",paper_blue_back:"бумага Blue back",canvas_artificial:"холст натуральный",canvas_natural:"холст искусственный"},"wide-material-light-type":{unimportant:"неважно",backlight:"backlight",frontlight:"frontlight",blocklight:"blocklight"},surface:{unimportant:"неважно",matted:"матовое",glossy:"глянцевое"},direction:{horizontal:"горизонтальная",vertical:"вертикальная"},"cutting-type":{fast:"быстрая",exact:"точная"},"cringles-types":{no:"нет",corners:"Люверсы только по углам",corner_and_center:"Люверсы по углам и по центру",custom:"Самостоятельно расставить люверсы или карманы"},cabinet:{try_later:'<a href="#" class="form-submit dotted">Показать ошибки.</a>',price_is:'<a href="#" class="form-submit dotted">Подробный результат</a>',not_valid:'<a href="#" class="form-submit dotted">Показать ошибки.</a>'},termTypes:{singlepage:"Листовые изделия",folded:"Фальцуемые изделия",brace_binded:"Скрепляемые на скобу",spring_binded:"Скрепляемые на пружину",kubarik:"Кубарик",hotmelt:"Скрепляемые на термоклей",stamping_product:"Вырубное изделие"},iframeTabs:{changeProductContent:"Изделие",generalOptionsContent:"Общее",blockOptionsContent:"Блок",coverOptionsContent:"Обложка",padOptionsContent:"Подложка",deliveryOptionsContent:"Доставка",termsOptionsContent:"Сроки",maquettesLoaderContent:"Макет"},iframeTabsDesc:{changeProductContent:"Выберите изделие",generalOptionsContent:"Общие параметры изделия",blockOptionsContent:"Параметры блока",coverOptionsContent:"Параметры обложки",padOptionsContent:"Параметры подложки",deliveryOptionsContent:"Доставка",termsOptionsContent:"Сроки",maquettesLoaderContent:"Загрузка макета"},products:{visiting_card:"Визитка",leaflet:"Листовка",blank:"Бланк",postcard:"Открытка",flyer:"Флаер",sticker:"Наклейка",poster:"Плакат",label:"Этикетка",stamping_product:"Вырубное изделие",booklet_1:"Буклет (1 сгиб)",booklet_2:"Буклет (2 сгибa)",booklet_3:"Буклет (3 сгибa)",eurobooklet:"Евробуклет",notebook_spring:"Блокнот на пружине",booklet_hotmelt:"Брошюра (термоклей)",copybook:"Тетрадь",booklet_brace:"Брошюра на скобе",booklet_spring:"Брошюра на пружине",print_sheet:"Печатный лист"},profile:{fullName:"Имя",phone:"Телефон"},validation:{required:"Обязательное поле",passes_not_match:"Пароли не совпадают"},maquettes:{clever_scale:'"Умное" растяжение',rotate_clever_scale:'"Умное" растяжение с поворотом',scale:"Обычное растяжение",rotate_scale:"Обычное растяжение с поворотом",singlepage:"Листовое изделие",multipage:"Многостраничное изделие",fold:"Изделие со сгибом",white_edges:"Белые поля",scretch_the_edge:"Растянуть края",original:"Оставить как есть",scaled_2:"Растяжение краёв",scaled_4:"Двойное растяжение краёв"},maquettes_help:{white_edges:"По краям изображения создано дополнительное белое поле. Это поле сохранится и на готовом изделии",scaled_2:"Края изображения (примерно 2 px) немного растянуты и из них создано обрезное поле. Этот вариант хорошо подходит для однородного фона. Обязательно внимательно изучите края изображения с помощью экранной линзы и убедитесь, что результат вас устраивает!",scaled_4:"Края изображения (примерно 4 px) растянуты и из них создано обрезное поле. Этот вариант хорошо подходит для однородного фона. Обязательно внимательно изучите края изображения с помощью экранной линзы и убедитесь, что результат вас устраивает!"},order_errors:{email_is_present:"E-mail уже занят. Выберите другой e-mail."},input_errors:{phone:"Пожалуйста, укажите корректный номер",mask:"%{field} не соответствует маске ввода.",invalid:"%{field} - проверте правильность ввода",required:"%{field} обязательно для заполнения",number:"%{field} должно быть числом",number_min:"%{field} должно быть больше %{min}",number_max:"%{field} должно быть меньше %{max}",number_min_max:"%{field} должно быть больше %{min} и меньше %{max}",number_step:"%{field} должно соответствовать шагу %{step}",fio:"Представьтесь, пожалуйста"},inputs:{"inn-ip":"ИНН индивидуального предпринимателя","inn-ur":"ИНН юридического лица",phone:"Номер телефона",kpp:"КПП",rs:"Расчетный счет",bik:"БИК","ogrn-ip":"ОГРН индивидуального предпринимателя","ogrn-ur":"ОГРН юридического лица",ks:"Креспонденсткий счет",skype:"Skype",email:"Email",client_name:"Имя и фамилия",client_legal_name:"Название",client_legal_address:"Адрес",client_password:"Пароль",client_password_repeat:"Пароль"},maquette_upload_messages:{"Maximum number of files exceeded":"Превышен максимальный размер файлов","File type not allowed":"Формат файла недопустим","File is too large":"Файл слишком огромен","File is too small":"Файл слишком мал"},currencies:{RUB:"рубли",USD:"доллары",GBP:"фунты стерлингов",EUR:"евро"},clients:{email:"Email",skype:"Skype",phone:"Телефон",address:"Адрес",other:"Другое",call:"Звонок",letter:"Письмо",sms:"СМС"},orders:{COORDINATION:"Согласование",MAQUETTE_CHECK:"Проверка макета",PRODUCTION:"Производство",SHIPPING:"Ожидает отгрузки",ERROR:"Проблема",READY:"Готово"},printing_type:{auto:"автовыбор",digital:"цифровая печать",offset:"оффсетная печать",screen:"шелкография"}};return function(b,c,d){c=c||"general";var e=function(b,c){return a[b][c].no||a[b][c].many||a.general[c].no||a.general[c].many||c;
};if("no"===d||0===d)return e(c,b);if(!isNaN(d)){var f=parseInt(d/10);return d-=10*f,1!=f&&1==d?a[c][b].one||a.general[b].one||b:1!=f&&d<5&&0!=d?a[c][b].several||a.general[b].several||b:a[c][b].many||a.general[b].many||b}return a[c]?"object"!=typeof a[c][b]&&"object"!=typeof a.general[b]||"string"==typeof a[c][b]?a[c][b]||a.general[b]||b:e(c,b):a.general[b]||b}}),angular.module("PrintlerFilters").filter("isExist",function(){return function(a){return!!a&&"no"!=a||0==a}}),angular.module("PrintlerFilters").filter("json5",function(){function a(b){return _.isArray(b)||_.isPlainObject(b)?_.isArray(b)?_.map(b,a):_.reduce(b,function(b,c,d){return 0!==d.indexOf("$$")&&(b[d]=a(c)),b},{}):b}return function(b){return JSON5.stringify(a(b))}}),angular.module("PrintlerFilters").filter("paramValue",function(){return function(a,b,c){if("undefined"==typeof a)return"";if(c)return parseFloat(parseFloat(a).toFixed(2))+" "+c;if(b.indexOf("cost")>-1)return"<strong>"+parseFloat(parseFloat(a).toFixed(2))+' <span class="rub">c</span></strong>';switch(b){case"machine":var d=a||a;return d.id==-1?"<strong><a href='"+d.url+"' target='_blank'>"+d.name+"</a></strong>":"<strong><a href='/settings/technopark/machines/"+d.url+"/"+d.id+"' target='_blank'>"+d.name+"</a></strong>";case"material":return"<a href="+a.url+" target='_blank'>"+a.title+"</a>";case"worksheet_runs":return a.toString();case"itself_printing":return"yes"==a?"Да":"Нет";case"cutting_sheet_format":case"format":return a[0]+" x "+a[1]+" мм";case"forms":return a+" шт.";case"roll_length":return a+" <strong>мм</strong>";case"fitting_roll_length":return a+" <strong>мм</strong>";default:return a.toString()}}}),angular.module("PrintlerFilters").filter("product_format",function(){return function(a){return a.slice(0,2).join("x")}}),angular.module("PrintlerFilters").filter("range",["$filter",function(a){return function(a,b){return a=_.range(b)}}]),angular.module("PrintlerFilters").filter("compact",["$filter",function(a){return function(a){return _.compact(a)}}]),angular.module("PrintlerFilters").filter("tr",function(){var a={"Maximum number of files exceeded":"Превышен максимальный размер файлов","File type not allowed":"Формат файла недопустим","File is too large":"Файл слишком огромен","File is too small":"Файл слишком мал"};return function(b){return a[b]}}),angular.module("PrintlerFilters").filter("_",function(){return function(a,b){return _[b].apply(_,a)}}),angular.module("GoogleGeoLocation").service("$geolocation",["$http",function(a){function b(b,c){return a.get("/settings/technopark/ajax/geo-proxy/",{params:{address:b,sensor:!1}}).then(c)}this.getLocation=function(a){return b(a,function(a){var b=[];return angular.forEach(a.data.results,function(a){b.push(a.formatted_address)}),b})}}]),angular.module("PrintlerDependencies").factory("Machina",function(){return machina.Fsm}),angular.module("PrintlerDependencies").factory("MultiOrder",[function(){return function(a,b){b.load_orders=function(){return b.all("orders").getList().then(function(a){b.orders=a})},b.customSave=function(){return b.id?b.put():b.post()};var c=[],d={route:b.route,parentResource:null,id:b.id},e="orders";return _.each(b.orders,function(b){c.push(a.restangularizeElement(d,b,e))}),b.orders=a.restangularizeCollection(d,c,e),b}}]),angular.module("PrintlerDependencies").factory("Order",["$filter",function(a){return function(b){return b.customSave=function(){return b.id?b.put():b.post()},b.get_format=function(){var a=b.calc_data.tech_card;return a.format[0]+"x"+a.format[1]},b.get_product=function(){var c=b.calc_data.tech_card,d=b.calc_data.form_data;return a("i18n")(d.product_slug,"products")+" "+c.circulation+"шт. "+b.get_format()+"мм"},b.load_comments=function(){return b.all("comments").getList().then(function(a){b.comments=a})},b.new_comment=function(a){return b.all("comments").post(a)},b}}]),angular.module("PrintlerDependencies").factory("User",[function(){return function(a){return a.get_full_name=function(){return((a.first_name||"")+" "+(a.last_name||"")).trim()},a.full_name=function(){var b=a.get_full_name();return 0==b.length?a.email:b},a}}]),angular.module("PrintlerDependencies").factory("$depsDriver",["$timeout",function(a){function b(){function b(a){return a.replace(/^[a-zA-Z_]+\./,"")}function c(a,b){var c=n.$eval(a);if(!angular.equals(c,b)){a=a.split(".");var d=n;for(var e in a)if(e==a.length-1)d[a[e]]=angular.copy(b);else if(d=d[a[e]],!d)return}}function d(b){0==_.size(o.resolvingParams)&&(q(),o.resolvingCheckTimeout=a(function(){r(),o.resolvingParams={}},2e3)),void 0==o.resolvingParams[b]?o.resolvingParams[b]=1:o.resolvingParams[b]++}function e(b){a(function(){void 0!=o.resolvingParams[b]&&(o.resolvingParams[b]--,0==o.resolvingParams[b]&&delete o.resolvingParams[b],0==_.size(o.resolvingParams)&&(a.cancel(o.resolvingCheckTimeout),r()))})}function f(a,b){for(var c in m)m[c]();b&&(a=i(a)),k(),_.each(a,function(a,b){m.push(n.$watch(b,function(c,f){if(o.resolvingEnabled)try{d(b);var i=c.toString(),j=!1;for(var k in a)if(g(k,i)){var l=a[k],m=_.filter(_.keys(l),function(a){return/^options\./.test(a)}),p=_.filter(_.keys(l),function(a){return/^params\./.test(a)}),q=function(a){h(l[a],a,c,f)};_.each(m,q),_.each(p,q),j=!0}if(!j&&"$default"in a&&_.each(a.$default,function(a,b){h(a,b,c,f)}),"$exec"in a)return void n.$eval(a.$exec);e(b)}catch(a){e(b)}},!0))}),o.curDeps=a}function g(a,b){var c=a.split(";"),d=!0;for(var e in c){var f=c[e].split(":"),g=f[0],h=n.$eval(f[1]||null);switch(g){case b:d=!0;break;case"$":d=b==h;break;case"$not":d=d&&b!=h;break;case"$gt":d=d&&b>h;break;case"$gte":d=d&&b>=h;break;case"$lt":d=d&&b<h;break;case"$lte":d=d&&b<=h;break;case"$in":d=d&&_.hasEqual(h,b);break;case"$notIn":d=d&&!_.hasEqual(h,b);break;case"$any":d=d&&!0;break;default:d=d&&!1}}return d}function h(a,d,e,f){function g(a,b){if(_.isObject(a)){var c;return _.isArray(a)?(c=[],_.each(a,function(a,b){c.push(g(a,b))})):(c={},_.each(a,function(a,b){c[b]=g(a,b)})),c}return _.isString(a)&&(/\$val|\$oldval|\$default|\$parse/.test(a)||_.hasEqual(["$if","$then"],b))?(0==a.indexOf("$parse")&&(a=a.split(":")[1]),n.$eval(a)):a}var h=d.substr(0,d.indexOf(".")),i=b(d),k=o.defaultPrefix+("options"==h?".options.":".defaults.");n.$val=e,n.$oldval=f,n.$default=n.$eval(k+i);var l=g(a,null);if(_.isObject(l))if("$if"in l)if(l.$if)l=l.$then||l.set;else{if(!("$else"in l))return;l=l.$else}else"set"in l&&(l=l.set);c(d,l),"params"==h&&j(d)}function i(a,b,c){function d(a,b,c){var d="block"==b?"cover":"block",e="front"==c?"back":"front";return _.isString(a)?a.replace(/\[sec\]/g,b).replace(/\[side\]/g,c).replace(/\[othersec\]/g,d).replace(/\[otherside\]/g,e):a}return b=b||null,c=c||null,_.isString(a)?d(a,b,c):_.isObject(a)?(_.each(a,function(a,e,f){if(!_.isString(e))return void(f[e]=i(angular.copy(a),b,c));var g=e.indexOf("[sec]")>-1,h=e.indexOf("[side]")>-1,j=_.filter(["block","cover","pad"],function(a){return b==a||g&&null==b}),k=_.filter(["front","back"],function(a){return c==a||h&&null==c});0==j.length&&(j=[null]),0==k.length&&(k=[null]),_.each(cartesianProductOf(j,k),function(b){var c=d(e,b[0],b[1]);c!=e&&c in f||(f[c]=i(angular.copy(a),b[0],b[1]))}),(g||h||e.indexOf("[otherside]")>-1||e.indexOf("[othersec]")>-1)&&delete f[e]}),a):a}function j(a){var d=b(a),e=n.$eval("options."+d),f=n.$eval("params."+d);if(d.indexOf("density")!=-1,void 0==e)return!0;if(_.isArray(f)){var g=!0;if(2==f.length&&"string"==typeof f[0]&&_.isObject(f[1]))_.contains(["1","0","4","no"],f[0])?_.each(["C","M","Y","K"],function(a){""!=f[1][a]&&1!=f[1][a]&&0!=f[1][a]&&(g=!1)}):g=!1;else{var h=_.intersection(f,e);_.isEqual(h,f)||(c("params."+d,h),g=!1)}return g}if(!_.hasEqual(e,f)){var i=angular.copy(n.$eval(o.defaultPrefix+".defaults."+d));if(_.indexOf(e,i)==-1){var j=e&&e.length>0?e[0]:"";d.indexOf("density")!=-1,c("params."+d,j)}else c("params."+d,i);return!1}return!0}function k(){function a(b,c){return _.reduce(b,function(b,d,e){return _.isPlainObject(d)?b.concat(a(d,c+e+".")):_.isArray(d)?b.concat([c+e]):b},[])}for(var b in p)p[b]();var c=a(n.options,"options.");_.each(c,function(a){p.push(n.$watch(a,function(){o.resolvingEnabled&&j(a)}))})}function l(a){var d={"[sec][side]":a},e=_.uniq(_.values(i(d)));_.each(o.curDeps,function(a){_.each(a,function(a){for(var b in a)_.contains(e,b)&&delete a[b]})}),_.each(e,function(a){var d=a.substr(0,a.indexOf(".")),e=o.defaultPrefix+("options"==d?".options.":".defaults."),f=n.$eval(e+b(a));c(a,f)})}var m=[],n=null,o={resolvingEnabled:!0,resolvingParams:{},resolvingCheckTimeout:null,defaultPrefix:""},p=[],q=function(){},r=function(){};this.apply=f,this.preparse=i,this.finishParamResolving=e,this.setFree=l,this.onResolveStart=function(a){q=a},this.onResolveFinish=function(a){r=a},this.enableResolving=function(){o.resolvingEnabled=!0},this.disableResolving=function(){o.resolvingEnabled=!1},this.setScope=function(a){n=a},this.getScope=function(){return n},this.setDefaultPrefix=function(a){o.defaultPrefix=a}}var c={};return function(a){return _.isUndefined(a)?new b:_.has(c,a)?c[a]:c[a]=new b}}]),angular.module("PrintlerDependencies").provider("AccountsRestangular",function(){var a,b={};return{withConfig:function(a){b=a},$get:["Restangular","User",function(c,d){return a||(a=c.withConfig(b),a.extendModel("users",d),a.load_users=function(b){var b=b||{};return a.all("users").getList(b)}),a}]}}),angular.module("PrintlerDependencies").provider("MultiOrdersRestangular",function(){var a,b={};return{withConfig:function(a){b=a},$get:["Restangular","Order","MultiOrder","$filter",function(c,d,e,f){return a||(a=c.withConfig(b),a.extendModel("orders",d),a.extendModel("multi_orders",_.partial(e,a)),a.load_multi_orders=function(b){return a.all("multi_orders").getList(b)},a.addResponseInterceptor(function(a,b,c,d,e){if("getList"==b&&"multi_orders"==c){if(_.isArray(a))return a;var f=a.results;return f.count=a.count,f}return a})),a}]}}),angular.module("PrintlerDependencies").service("$depsFetcher",["$httpQueue","$promiseUtils","$depsDriver","urls",function(a,b,c,d){var e=c(),f=function(a){return e.preparse(a.data)},g=new b.OncePromise(f),h=new b.OncePromise(f);this.getDefaultDependencies=function(b){return a.getOnce(g,b,d["get-default-dependencies-ajax"])},this.getWideprintDeps=function(b){return a.getOnce(h,b,"/wideprint/dependencies")},this.defaultDeps=g.result,this.wideDeps=h.result}]),angular.module("HttpAsyncQueue").factory("$httpQueue",["$http","$q",function(a,b){function c(c,d){function e(a,b){function c(){i[a](b),g.shift()}return g[0]?(j.id==g[0].id?c():g[j.id-g[0].id-1].then(c).catch(function(a){a.canceled||c()}),j):null}if(!c)return a(d);"undefined"==typeof f[c]&&(f[c]=[]);var g=f[c],h=a(d),i=b.defer(),j=i.promise;g.push(j);var k=g.length-1;return j.id=k?g[k-1].id+1:0,j.deferred=i,h.then(function(a){e("resolve",a)},function(a){e("reject",a)}),j.success=function(a){return j.then(function(b){a(b.data,b.status,b.headers)}),j},j.error=function(a){return j.then(null,function(b){a(b.data,b.status,b.headers)}),j},j}function d(a){_.each(arguments,function(a){c[a]=function(b,d,e){return c(b,angular.extend(e||{},{method:a,url:d}))},c[a+"Once"]=function(b,d,e,f){return c.once(b,d,angular.extend(f||{},{method:a,url:e}))}})}function e(a){_.each(arguments,function(a){c[a]=function(b,d,e,f){return c(b,angular.extend(f||{},{method:a,url:d,data:e}))},c[a+"Once"]=function(b,d,e,f,g){return c.once(b,d,angular.extend(g||{},{method:a,url:e,data:f}))}})}var f={};return c.clear=function(a){function b(a){for(var b in f[a])f[a][b].deferred.reject({canceled:!0});f[a]=[]}if(a)b(a);else{for(var c in f)b(c);f={}}},c.once=function(a,b,d){return a.resolveOnce(c,[b,d])},d("get","delete","head","jsonp"),e("post","put"),c}]);
//# sourceMappingURL=widget2App.min.map