!function(){window.Printler={},window.Printler.Frame=function(){this.frameWindow=void 0,this.hostDomain=void 0,this.script=void 0,this.apiKey=void 0,this.noStart=!1,this.isStart=!1,this.isLoading=!1},window.Printler.Frame.prototype.initFrame=function(a){if(this.script=this.findScript(a),!this.script)return!1;this.apiKey=this.script.getAttribute("api-key");var b=document.createElement("a");return b.href=this.script.getAttribute("src"),this.hostDomain=b.host||"printler.pro",this.noStart=!0,this.prepareFrame(this.hostDomain,this.apiKey,a),!0},window.Printler.Frame.prototype.prepareFrame=function(a,b,c){a=a||"printler.pro",b=b?"/?api_key="+b:"",c=c?"_"+c:"",this.frameWindow=document.createElement("iframe"),this.frameWindow.id="printler-calc-iframe"+c,this.frameWindow.setAttribute("style","position:fixed; z-index:30000; top:0; left:0;height:45px; width:100%; background-color:rgba(0, 0, 0, 0.0); display:none"),this.frameWindow.setAttribute("frameBorder","0"),this.frameWindow.setAttribute("scrolling","yes"),this.frameWindow.setAttribute("src","http://"+a+"/cabinet/iframe2"+c+b)},window.Printler.Frame.prototype.addFrame=function(){document.body.style.position="relative",document.body.style.overflow="visible",this.isLoading=!0,this.addEvent(this.frameWindow,"load",function(){this.isLoading=!1,this.isStart=!0}.bind(this)),document.body.insertBefore(this.frameWindow,document.body.children[0])},window.Printler.Frame.prototype.iframeClose=function(){this.frameWindow.style.display="none",document.body.style.marginTop="0px"},window.Printler.Frame.prototype.iframeFull=function(){this.frameWindow.style.display="block",this.frameWindow.style.height="100%",document.body.style.marginTop="45px",this.frameWindow.setAttribute("scrolling","yes")},window.Printler.Frame.prototype.headerOnly=function(){this.frameWindow.style.display="block",this.frameWindow.style.height="45px",document.body.style.marginTop="45px",this.frameWindow.setAttribute("scrolling","no")},window.Printler.Frame.prototype.findScript=function(a){for(var b=document.getElementsByTagName("script"),c=0;c<b.length;c++)if(b[c].getAttribute("frame-type")==a&&0==b[c].id.indexOf("printler-api-script"))return b[c]},window.Printler.Frame.prototype.addEvent=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,function(){c.apply(a,arguments)})}}(),function(){window.Printler.API=function(){window.Printler.Frame.apply(this,arguments),this.api_calls={},this.api_count=1,this.api_run=!1,this.events={}},window.Printler.API.prototype=Object.create(window.Printler.Frame.prototype),window.Printler.Frame.prototype.initAPI=function(){this.addEvent(window,"message",this.fromIframe.bind(this)),this.openFunctions={},this.openFunctions.iframeClose=this.iframeClose.bind(this),this.openFunctions.iframeFull=this.iframeFull.bind(this),this.openFunctions.headerOnly=this.headerOnly.bind(this)},window.Printler.API.prototype.toIframe=function(a,b){var c=this.frameWindow.contentWindow;c.postMessage(JSON.stringify(a),"*")},window.Printler.API.prototype.fromIframe=function(a){if(a.origin.indexOf(this.hostDomain)>=0){var b=a.data;("string"==typeof b||b instanceof String)&&(b=JSON.parse(b));var c=b.data||{};"callAPIfunc"==b.name&&this.callCallback(c.id,c.data),"event"==b.name?this.callEvent(c.eventName,c.data):this.openFunctions[b.name]&&this.openFunctions[b.name](c.data)}},window.Printler.API.prototype.command=function(a,b){var c=[[a,{}]];"object"==typeof a&&a instanceof Array&&(c="object"==typeof a[0]&&a[0]instanceof Array?a:[a]);var d=this.api_count,e=void 0;this.api_calls[d-1]&&(e=d-1,this.api_calls[e].next=this.api_count);for(var f=0;f<c.length;f++)this.api_calls[this.api_count]={command:c[f]},this.api_calls[this.api_count].next=f+1==c.length?void 0:this.api_count+1,this.api_calls[this.api_count].callback=f+1==c.length?b:void 0,this.api_count++;0!=e&&e||this.callCommands(d)},window.Printler.API.prototype.callCommands=function(a){this.api_run||(this.api_run=!0,this.callCommand(a))},window.Printler.API.prototype.callCommand=function(a){this.toIframe({name:this.api_calls[a].command[0],data:{call:this.api_calls[a].command[1],id:a}})},window.Printler.API.prototype.callEvent=function(a,b){if(this.events[a])for(var c=0;c<this.events[a].length;c++)this.events[a][c](b)},window.Printler.API.prototype.onEvent=function(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),this.events[a].length-1},window.Printler.API.prototype.offEvent=function(a,b){this.events[a].splice(b,1)},window.Printler.API.prototype.callCallback=function(a,b){this.api_calls[a]&&(this.api_calls[a].next?this.callCommand(this.api_calls[a].next):this.api_run=!1,this.api_calls[a].callback&&this.api_calls[a].callback(b),delete this.api_calls[a])}}(),function(){window.Printler.StandartWidget=function(){if(window.Printler.API.apply(this,arguments),this.initFrame()){var a=function(a,b,c){var d=new XMLHttpRequest,e={};return d.open(a,b,!0),d.onreadystatechange=function(){4==d.readyState&&200==d.status&&(e=JSON.parse(d.responseText),c(e))},d.send(null),d},b=function(){var b=this;a("GET","http://"+this.hostDomain+"/cabinet/validate/?api_key="+this.apiKey,function(a){a.apiKeyValid&&b.addFrame()})};this.addEvent(this.frameWindow,"load",function(){this.initAPI()}.bind(this)),b.call(this)}},window.Printler.StandartWidget.prototype=Object.create(window.Printler.API.prototype),window.PrintlerStandartWidget=new window.Printler.StandartWidget}();
//# sourceMappingURL=api.printler2.min.map