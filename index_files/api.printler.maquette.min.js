!function(){window.Printler={},window.Printler.Frame=function(){this.frameWindow=void 0,this.hostDomain=void 0,this.script=void 0,this.apiKey=void 0,this.noStart=!1,this.isStart=!1,this.isLoading=!1},window.Printler.Frame.prototype.initFrame=function(a){if(this.script=this.findScript(a),!this.script)return!1;this.apiKey=this.script.getAttribute("api-key");var b=document.createElement("a");return b.href=this.script.getAttribute("src"),this.hostDomain=b.host||"printler.pro",this.noStart=!0,this.prepareFrame(this.hostDomain,this.apiKey,a),!0},window.Printler.Frame.prototype.prepareFrame=function(a,b,c){a=a||"printler.pro",b=b?"/?api_key="+b:"",c=c?"_"+c:"",this.frameWindow=document.createElement("iframe"),this.frameWindow.id="printler-calc-iframe"+c,this.frameWindow.setAttribute("style","position:fixed; z-index:30000; top:0; left:0;height:45px; width:100%; background-color:rgba(0, 0, 0, 0.0); display:none"),this.frameWindow.setAttribute("frameBorder","0"),this.frameWindow.setAttribute("scrolling","yes"),this.frameWindow.setAttribute("src","http://"+a+"/cabinet/iframe2"+c+b)},window.Printler.Frame.prototype.addFrame=function(){document.body.style.position="relative",document.body.style.overflow="visible",this.isLoading=!0,this.addEvent(this.frameWindow,"load",function(){this.isLoading=!1,this.isStart=!0}.bind(this)),document.body.insertBefore(this.frameWindow,document.body.children[0])},window.Printler.Frame.prototype.iframeClose=function(){this.frameWindow.style.display="none",document.body.style.marginTop="0px"},window.Printler.Frame.prototype.iframeFull=function(){this.frameWindow.style.display="block",this.frameWindow.style.height="100%",document.body.style.marginTop="45px",this.frameWindow.setAttribute("scrolling","yes")},window.Printler.Frame.prototype.headerOnly=function(){this.frameWindow.style.display="block",this.frameWindow.style.height="45px",document.body.style.marginTop="45px",this.frameWindow.setAttribute("scrolling","no")},window.Printler.Frame.prototype.findScript=function(a){for(var b=document.getElementsByTagName("script"),c=0;c<b.length;c++)if(b[c].getAttribute("frame-type")==a&&0==b[c].id.indexOf("printler-api-script"))return b[c]},window.Printler.Frame.prototype.addEvent=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,function(){c.apply(a,arguments)})}}(),function(){window.Printler.API=function(){window.Printler.Frame.apply(this,arguments),this.api_calls={},this.api_count=1,this.api_run=!1,this.events={}},window.Printler.API.prototype=Object.create(window.Printler.Frame.prototype),window.Printler.Frame.prototype.initAPI=function(){this.addEvent(window,"message",this.fromIframe.bind(this)),this.openFunctions={},this.openFunctions.iframeClose=this.iframeClose.bind(this),this.openFunctions.iframeFull=this.iframeFull.bind(this),this.openFunctions.headerOnly=this.headerOnly.bind(this)},window.Printler.API.prototype.toIframe=function(a,b){var c=this.frameWindow.contentWindow;c.postMessage(JSON.stringify(a),"*")},window.Printler.API.prototype.fromIframe=function(a){if(a.origin.indexOf(this.hostDomain)>=0){var b=a.data;("string"==typeof b||b instanceof String)&&(b=JSON.parse(b));var c=b.data||{};"callAPIfunc"==b.name&&this.callCallback(c.id,c.data),"event"==b.name?this.callEvent(c.eventName,c.data):this.openFunctions[b.name]&&this.openFunctions[b.name](c.data)}},window.Printler.API.prototype.command=function(a,b){var c=[[a,{}]];"object"==typeof a&&a instanceof Array&&(c="object"==typeof a[0]&&a[0]instanceof Array?a:[a]);var d=this.api_count,e=void 0;this.api_calls[d-1]&&(e=d-1,this.api_calls[e].next=this.api_count);for(var f=0;f<c.length;f++)this.api_calls[this.api_count]={command:c[f]},this.api_calls[this.api_count].next=f+1==c.length?void 0:this.api_count+1,this.api_calls[this.api_count].callback=f+1==c.length?b:void 0,this.api_count++;0!=e&&e||this.callCommands(d)},window.Printler.API.prototype.callCommands=function(a){this.api_run||(this.api_run=!0,this.callCommand(a))},window.Printler.API.prototype.callCommand=function(a){this.toIframe({name:this.api_calls[a].command[0],data:{call:this.api_calls[a].command[1],id:a}})},window.Printler.API.prototype.callEvent=function(a,b){if(this.events[a])for(var c=0;c<this.events[a].length;c++)this.events[a][c](b)},window.Printler.API.prototype.onEvent=function(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),this.events[a].length-1},window.Printler.API.prototype.offEvent=function(a,b){this.events[a].splice(b,1)},window.Printler.API.prototype.callCallback=function(a,b){this.api_calls[a]&&(this.api_calls[a].next?this.callCommand(this.api_calls[a].next):this.api_run=!1,this.api_calls[a].callback&&this.api_calls[a].callback(b),delete this.api_calls[a])}}(),function(){window.Printler.MaquetteWidget=function(){window.Printler.API.apply(this,arguments),this.initFrame("maquette")&&(this.startCommands=[["configuration",{"widget2.isFull":!1}],["configuration",{"widget2.fullscreen":!0}],["closed",{}]],this.maquetteButtons=[],this.maquetteEvents={},this.hasHidden=this.script.getAttribute("hidden-inputs"),this.on=function(a,b){this.maquetteEvents[a]=b}.bind(this),this.addEvent(window,"load",function(){this.findButtons(),this.noStart||this.start()}.bind(this)))},window.Printler.MaquetteWidget.prototype=Object.create(window.Printler.API.prototype),window.Printler.MaquetteWidget.prototype.start=function(){this.addEvent(this.frameWindow,"load",function(){this.initAPI(),this.command(this.startCommands)}.bind(this)),this.addFrame()},window.Printler.MaquetteWidget.prototype.findButtons=function(){for(var b=document.getElementsByClassName("printler-maquette-button"),c=0;c<b.length;c++){for(var d=b[c],e=d.getAttribute("printler-input-id"),f=!1,g=0;g<this.maquetteButtons.length;g++)if(e==this.maquetteButtons[g].id){f=!0;break}if(!f){var h=a(d);h.id?this.addMaquetteButton(h):this.addGalleryButton(h),this.maquetteButtons.push(h)}}},window.Printler.MaquetteWidget.prototype.addGalleryButton=function(a){this.addEvent(a.element,"click",function(){this.isStart?this.command("maquettes.gallery"):(this.startCommands.push(["maquettes.gallery",{}]),this.start())}.bind(this))},window.Printler.MaquetteWidget.prototype.addMaquetteButton=function(a){b.call(this,a);var f=c(a);a.command=f?["maquettes.create",f]:["maquettes.product",{}],d(a),e.call(this,a);var g=function(){a.is_active=!0,this.isStart?this.command([["configuration",{"widget2.maquette.galleryLocked":!0}],a.command],function(){this.iframeFull()}.bind(this)):this.isLoading||(this.startCommands.push(["configuration",{"widget2.maquette.galleryLocked":!0}]),this.startCommands.push(a.command),this.start())}.bind(this);this.addEvent(a.element,"click",g)};var a=function(a){return{element:a,id:a.getAttribute("printler-input-id"),name:a.getAttribute("printler-input-name"),required:a.getAttribute("printler-input-required"),ok_text:a.getAttribute("printler-ok-text"),ok_class:a.getAttribute("printler-ok-class"),bad_class:a.getAttribute("printler-bad-class"),bad_text:a.getAttribute("printler-bad-text"),count:a.getAttribute("printler-count"),width:a.getAttribute("printler-width"),height:a.getAttribute("printler-height"),chromaticity:a.getAttribute("printler-chromaticity"),hidden_input:void 0,after_approve:void 0,is_active:!1,command:void 0}},b=function(a){a.hidden_input=document.createElement("input"),a.hidden_input.id=a.id,a.hidden_input.name=a.name,a.hidden_input.setAttribute("type","hidden"),a.required&&a.hidden_input.setAttribute("required",""),this.hasHidden&&a.element.parentNode.insertBefore(a.hidden_input,a.element)},c=function(a){return!!(a.count&&a.width&&a.height)&&{chromaticity:a.chromaticity,pages_count:a.count,format_width:a.width,format_height:a.height}},d=function(a){a.bad_text&&(a.element.textContent=a.bad_text),a.bad_class&&f(a.element,a.bad_class),a.after_approve=function(b){a.element.textContent=a.ok_text||"Макет загружен и проверен",a.bad_class&&g(a.element,a.bad_class),a.ok_class&&f(a.element,a.ok_class),a.after_approve=function(){}}},e=function(a){this.onEvent("open",function(b){this.maquetteEvents.open&&a.is_active&&this.maquetteEvents.open({id:a.id})}.bind(this)),this.onEvent("close",function(b){this.maquetteEvents.close&&a.is_active&&this.maquetteEvents.close({id:a.id}),a.is_active=!1}.bind(this)),this.onEvent("fileLoad",function(b){this.maquetteEvents.fileLoad&&a.is_active&&this.maquetteEvents.fileLoad({id:a.id})}.bind(this)),this.onEvent("maquetteCreate",function(b){a.maquette_id=b.create}.bind(this)),this.onEvent("maquetteApprove",function(b){this.maquetteEvents.maquetteApprove&&a.is_active&&this.maquetteEvents.maquetteApprove({id:a.id,url:b.approve.url,info:b.approve.info}),a.after_approve(b.approve),a.command=["maquettes.final",{id:a.maquette_id}]}.bind(this))},f=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");c.test(a.className)||(a.className=(a.className+" "+b).replace(/\s+/g," ").replace(/(^ | $)/g,""))},g=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")};window.PrintlerMaquetteWidget=new window.Printler.MaquetteWidget}();
//# sourceMappingURL=api.printler.maquette.min.map